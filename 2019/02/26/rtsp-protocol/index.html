<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="RTSP 协议">
<meta property="og:type" content="article">
<meta property="og:title" content="rtsp 协议">
<meta property="og:url" content="http://yoursite.com/2019/02/26/rtsp-protocol/index.html">
<meta property="og:site_name" content="IT日记">
<meta property="og:description" content="RTSP 协议">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5031276-092df4f7341d4b37.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/404/format/webp">
<meta property="article:published_time" content="2019-02-26T06:34:59.000Z">
<meta property="article:modified_time" content="2020-03-04T03:00:48.907Z">
<meta property="article:author" content="Breeze.Temple">
<meta property="article:tag" content="network">
<meta property="article:tag" content="http">
<meta property="article:tag" content="rtsp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/5031276-092df4f7341d4b37.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/404/format/webp">

<link rel="canonical" href="http://yoursite.com/2019/02/26/rtsp-protocol/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>rtsp 协议 | IT日记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IT日记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Life is Now.</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/rtsp-protocol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Breeze.Temple">
      <meta itemprop="description" content="Breeze.Temple">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT日记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          rtsp 协议
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-02-26 14:34:59" itemprop="dateCreated datePublished" datetime="2019-02-26T14:34:59+08:00">2019-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-04 11:00:48" itemprop="dateModified" datetime="2020-03-04T11:00:48+08:00">2020-03-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/RTSP/" itemprop="url" rel="index">
                    <span itemprop="name">RTSP</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>12 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a href="https://www.jianshu.com/p/4e3925f98e84" target="_blank" rel="noopener">RTSP 协议</a></p>
<a id="more"></a>


<h2 id="RTSP-简介"><a href="#RTSP-简介" class="headerlink" title="RTSP 简介"></a>RTSP 简介</h2><p><strong>RTSP</strong>（Real Time Streaming Protocol）是由 Real Network 和 Netscape 共同提出的如何有效地在 IP 网络上传输流媒体数据的应用层协议。RTSP 对流媒体提供了诸如暂停，快进等控制，而它本身并不传输数据，RTSP 的作用相当于流媒体服务器的<strong>远程控制</strong>。服务器端可以自行选择使用 TCP 或 UDP 来传送串流内容，它的语法和运作跟 HTTP 1.1 类似，但并不特别强调时间同步，所以比较能容忍网络延迟。</p>
<h2 id="RTSP-和-HTTP-RTP-RTCP-的关系"><a href="#RTSP-和-HTTP-RTP-RTCP-的关系" class="headerlink" title="RTSP 和 HTTP RTP(RTCP) 的关系"></a>RTSP 和 HTTP RTP(RTCP) 的关系</h2><h3 id="RTSP-和-HTTP"><a href="#RTSP-和-HTTP" class="headerlink" title="RTSP 和 HTTP"></a>RTSP 和 HTTP</h3><ul>
<li><strong>联系</strong>：两者都用纯文本来发送消息，且 rtsp 协议的语法也和 HTTP 类似。Rtsp 一开始这样设计，也是为了能够兼容使用以前写的 HTTP 协议分析代码 。</li>
<li><strong>区别</strong>：rtsp 是有状态的，不同的是 RTSP 的命令需要知道现在正处于一个什么状态，也就是说 rtsp 的命令总是<strong>按照顺序来发送</strong>，某个命令总在另外一个命令之前要发送。Rtsp 不管处于什么状态都<strong>不会断掉连接</strong>。而 http 则不保存状态，协议在发送一个命令以后，<strong>连接就会断开</strong>，且命令之间是<strong>没有依赖性</strong>。rtsp 协议使用 554 端口，http 使用 80 端口。</li>
</ul>
<h3 id="RTSP-和-RTP-RTCP"><a href="#RTSP-和-RTP-RTCP" class="headerlink" title="RTSP 和 RTP(RTCP)"></a>RTSP 和 RTP(RTCP)</h3><ul>
<li><strong>RTP</strong>：Realtime Transport Potocol 实时传输协议<br>RTP 提供时间标志，序列号以及其他能够保证在实时数据传输时处理时间的方法。</li>
<li><strong>RTCP</strong>：Realtime Transport Control Potocol 实时传输控制协议<br>RTCP 是 RTP 的控制部分，用来保证服务质量和成员管理。RTP 和 RTCP 是一起使用的。</li>
<li><strong>RTSP</strong>：RealTime Streaming Potocol 实时流协议<br>RTSP 具体数据传输交给 RTP, 提供对流的远程控制</li>
</ul>
<p>RTP 是基于 UDP 协议的， UDP 不用建立连接，效率更高；但允许丢包， 这就要求在重新组装媒体的时候多做些工作<br>RTP 只是包裹内容信息，而 RTCP 是交换控制信息的，Qos 是通过 RTCP 实现的<br>应用程序对应的是 play, seek, pause, stop 等命令，RTSP 则是处理这些命令，在 UDP 传输时并使用 RTP(RTCP) 来完成。如果是 TCP 连接则不会使用 RTP(RTCP)。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5031276-092df4f7341d4b37.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/404/format/webp" alt="img"></p>
<p>RTSP structure</p>
<p>RTSP 的 client 连接 server 通过 SDP（<a href="https://link.jianshu.com/?t=http://blog.chinaunix.net/uid-24372973-id-293651.html" target="_blank" rel="noopener">会话描述协议</a>）传递信息，详细请见：<a href="https://www.jianshu.com/p/4e3925f98e84#rtsp_msg" target="_blank" rel="noopener">RTSP 消息</a></p>
<h2 id="RTSP-消息"><a href="#RTSP-消息" class="headerlink" title="RTSP 消息"></a>RTSP 消息</h2><p>RTSP 的消息有两大类，一是请求消息 (request)，一是回应消息 (response)，两种消息的格式不同。<br><strong>请求消息格式</strong>：</p>
<blockquote>
<p>方法 URI RTSP 版本 CR LF<br>消息头 CR LF CR LF<br>消息体 CR LF</p>
</blockquote>
<p>方法包括：OPTIONS、SETUP、PLAY、TEARDOWN DESCRIBE<br>URI 是接收方（服务端）的地址，例如：<a href="https://link.jianshu.com/?t=rtsp://192.168.22.136:5000/v0" target="_blank" rel="noopener">rtsp://192.168.22.136:5000/v0</a><br>每行后面的 CR LF 表示回车换行，需要接收端有相应的解析，消息头需要有两个 CR LF。</p>
<pre><code>DESCRIBE rtsp://192.168.1.211 RTSP/1.0
CSeq: 1
Accept: application/sdp
User-Agent: magnus-fc</code></pre><p><strong>回应消息格式</strong>：</p>
<blockquote>
<p>RTSP 版本 状态码 解释 CR LF<br>消息头 CR LF CR LF<br>消息体 CR LF</p>
</blockquote>
<p>其中 RTSP 版本一般都是 RTSP/1.0，状态码是一个数值，200 表示成功，解释是与状态码对应的文本解释，详细请见：<a href="https://www.jianshu.com/p/4e3925f98e84#sdp_intro" target="_blank" rel="noopener">SDP 协议介绍。</a></p>
<pre><code>RTSP/1.0 200 OK
CSeq: 1
Server: GrandStream Rtsp Server V100R001
Content-Type: application/sdp
Content-length: 256
Content-Base: rtsp://192.168.1.211/0

v=0
o=StreamingServer 3331435948 1116907222000 IN IP4 192.168.1.211
s=h264.mp4
c=IN IP4 0.0.0.0
t=0 0
a=control:*
m=video 0 RTP/AVP 96
a=control:trackID=0
a=rtpmap:96 H264/90000
m=audio 0 RTP/AVP 97
a=control:trackID=1
a=rtpmap:97 G726-16/8000</code></pre><h2 id="简单的-rtsp-交互过程："><a href="#简单的-rtsp-交互过程：" class="headerlink" title="简单的 rtsp 交互过程："></a>简单的 rtsp 交互过程：</h2><p>C 表示 rtsp 客户端，S 表示 rtsp 服务端</p>
<blockquote>
<p>step1:<br>C-&gt;S:OPTION request // 询问 S 有哪些方法可用<br>S-&gt;C:OPTION response //S 回应信息中包括提供的所有可用方法</p>
</blockquote>
<blockquote>
<p>step2:<br>C-&gt;S:DESCRIBE request // 要求得到 S 提供的媒体初始化描述信息<br>S-&gt;C:DESCRIBE response //S 回应媒体初始化描述信息，主要是 sdp</p>
</blockquote>
<blockquote>
<p>step3:<br>C-&gt;S:SETUP request // 设置会话的属性，以及传输模式，提醒 S 建立会话<br>S-&gt;C:SETUP response //S 建立会话，返回会话标识符，以及会话相关信息</p>
</blockquote>
<blockquote>
<p>step4:<br>C-&gt;S:PLAY request //C 请求播放<br>S-&gt;C:PLAY response //S 回应该请求的信息</p>
</blockquote>
<blockquote>
<p>S-&gt;C: 发送流媒体数据</p>
</blockquote>
<blockquote>
<p>step5:<br>C-&gt;S:TEARDOWN request //C 请求关闭会话<br>S-&gt;C:TEARDOWN response //S 回应该请求</p>
</blockquote>
<h2 id="RTSP-中常用方法"><a href="#RTSP-中常用方法" class="headerlink" title="RTSP 中常用方法"></a>RTSP 中常用方法</h2><h3 id="OPTION"><a href="#OPTION" class="headerlink" title="OPTION"></a>OPTION</h3><p>得到服务器提供的可用方法</p>
<pre><code>OPTIONS rtsp://192.168.20.136:5000/xxx666 RTSP/1.0
CSeq: 1 // 每个消息都有序号来标记，第一个包通常是 option 请求消息
User-Agent: VLC media player (LIVE555 Streaming Media v2005.11.10)</code></pre><p>服务器的回应信息包括提供的一些方法，例如：</p>
<pre><code>RTSP/1.0 200 OK
Server: UServer 0.9.7_rc1
Cseq: 1 // 每个回应消息的 cseq 数值和请求消息的 cseq 相对应
Public: OPTIONS, DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE, SCALE,GET_PARAMETER // 服务器提供的可用的方法</code></pre><h3 id="DESCRIBE"><a href="#DESCRIBE" class="headerlink" title="DESCRIBE"></a>DESCRIBE</h3><p>C 向 S 发起 DESCRIBE 请求，为了得到会话描述信息 (SDP):</p>
<pre><code>DESCRIBE rtsp://192.168.20.136:5000/xxx666 RTSP/1.0
CSeq: 2
token:
Accept: application/sdp
User-Agent: VLC media player (LIVE555 Streaming Media v2005.11.10)</code></pre><p>服务器回应一些对此会话的描述信息 (<a href="https://www.jianshu.com/p/4e3925f98e84#sdp_intro" target="_blank" rel="noopener">sdp</a>):</p>
<pre><code>RTSP/1.0 200 OK
Server: UServer 0.9.7_rc1
Cseq: 2
x-prev-url: rtsp://192.168.20.136:5000
x-next-url: rtsp://192.168.20.136:5000
x-Accept-Retransmit: our-retransmit
x-Accept-Dynamic-Rate: 1
Cache-Control: must-revalidate
Last-Modified: Fri, 10 Nov 2006 12:34:38 GMT
Date: Fri, 10 Nov 2006 12:34:38 GMT
Expires: Fri, 10 Nov 2006 12:34:38 GMT
Content-Base: rtsp://192.168.20.136:5000/xxx666/
Content-Length: 344
Content-Type: application/sdp

v=0 // 以下都是 sdp 信息
o=OnewaveUServerNG 1451516402 1025358037 IN IP4 192.168.20.136
s=/xxx666
u=http:///
e=admin@
c=IN IP4 0.0.0.0
t=0 0
a=isma-compliance:1,1.0,1

a=range:npt=0-
m=video 0 RTP/AVP 96 //m 表示媒体描述，下面是对会话中视频通道的媒体描述
a=rtpmap:96 MP4V-ES/90000
a=fmtp:96 profile-level-id=245;config=000001B0F5000001B509000001000000012000C888B0E0E0FA62D089028307 a=control:trackID=0 //trackID＝0 表示视频流用的是通道 0</code></pre><h3 id="SETUP"><a href="#SETUP" class="headerlink" title="SETUP"></a>SETUP</h3><p>客户端提醒服务器建立会话，并确定传输模式：</p>
<pre><code>SETUP rtsp://192.168.20.136:5000/xxx666/trackID=0 RTSP/1.0
CSeq: 3
Transport: RTP/AVP/TCP;unicast;interleaved=0-1
User-Agent: VLC media player (LIVE555 Streaming Media v2005.11.10)
 //uri 中 带有 trackID＝0，表示对该通道进行设置。Transport 参数设置了传输模式，包的结构。接下来的数据包头部第二个字节位置就是 interleaved，它的值是每个通道都不同的，trackID＝0 的 interleaved 值有两个 0 或 1，0 表示 rtp 包，1 表示 rtcp 包，接收端根据 interleaved 的值来区别是哪种数据包。</code></pre><p>服务器回应信息：</p>
<pre><code>RTSP/1.0 200 OK
Server: UServer 0.9.7_rc1
Cseq: 3
Session: 6310936469860791894 // 服务器回应的会话标识符
Cache-Control: no-cache
Transport: RTP/AVP/TCP;unicast;interleaved=0-1;ssrc=6B8B4567</code></pre><h3 id="PLAY"><a href="#PLAY" class="headerlink" title="PLAY"></a>PLAY</h3><p>客户端发送播放请求：</p>
<pre><code>PLAY rtsp://192.168.20.136:5000/xxx666 RTSP/1.0
CSeq: 4
Session: 6310936469860791894
Range: npt=0.000- // 设置播放时间的范围
User-Agent: VLC media player (LIVE555 Streaming Media v2005.11.10)</code></pre><p>服务器回应信息：</p>
<pre><code>RTSP/1.0 200 OK
Server: UServer 0.9.7_rc1
Cseq: 4
Session: 6310936469860791894
Range: npt=0.000000-
RTP-Info: url=trackID=0;seq=17040;rtptime=1467265309
 //seq 和 rtptime 都是 rtp 包中的信息</code></pre><h3 id="TEARDOWN"><a href="#TEARDOWN" class="headerlink" title="TEARDOWN"></a>TEARDOWN</h3><p>客户端发起关闭请求：</p>
<pre><code>TEARDOWN rtsp://192.168.20.136:5000/xxx666 RTSP/1.0
CSeq: 5
Session: 6310936469860791894
User-Agent: VLC media player (LIVE555 Streaming Media v2005.11.10)</code></pre><p>服务器回应：</p>
<pre><code>RTSP/1.0 200 OK
Server: UServer 0.9.7_rc1
Cseq: 5
Session: 6310936469860791894</code></pre><h2 id="SDP-协议"><a href="#SDP-协议" class="headerlink" title="SDP 协议"></a>SDP 协议</h2><p>sdp 的格式：</p>
<pre><code>v=&lt;version&gt;
o=&lt;username&gt; &lt;session id&gt; &lt;version&gt; &lt;network type&gt; &lt;address type&gt; &lt;address&gt;
s=&lt;session name&gt;
i=&lt;session description&gt;
u=&lt;URI&gt;
e=&lt;email address&gt;
p=&lt;phone number&gt;
c=&lt;network type&gt; &lt;address type&gt; &lt;connection address&gt;
b=&lt;modifier&gt;:&lt;bandwidth-value&gt;
t=&lt;start time&gt; &lt;stop time&gt;
r=&lt;repeat interval&gt; &lt;active duration&gt; &lt;list of offsets from start-time&gt;
z=&lt;adjustment time&gt; &lt;offset&gt; &lt;adjustment time&gt; &lt;offset&gt; ....
k=&lt;method&gt;
k=&lt;method&gt;:&lt;encryption key&gt;
a=&lt;attribute&gt;
a=&lt;attribute&gt;:&lt;value&gt;
m=&lt;media&gt; &lt;port&gt; &lt;transport&gt; &lt;fmt list&gt;</code></pre><blockquote>
<p>v = （协议版本）<br>o = （所有者 / 创建者和会话标识符）<br>s = （会话名称）<br>i = * （会话信息）<br>u = * （URI 描述）<br>e = * （Email 地址）<br>p = * （电话号码）<br>c = * （连接信息）<br>b = * （带宽信息）<br>z = * （时间区域调整）<br>k = * （加密密钥）<br>a = * （0 个或多个会话属性行）</p>
</blockquote>
<ul>
<li>时间描述：<br>t = （会话活动时间）<br>r = * （0 或多次重复次数）</li>
<li>媒体描述：<br>m = （媒体名称和传输地址）<br>i = * （媒体标题）<br>c = * （连接信息 — 如果包含在会话层则该字段可选）<br>b = * （带宽信息）<br>k = * （加密密钥）<br>a = * （0 个或多个媒体属性行）</li>
</ul>
<p>SDP 一会话描述协议一描述 SAP、SIP 和 RTSR 会话的协议，是一种文件描述协议，是由服务器生成的描述媒体文件编码信息以及所在服务器的链接等的信息。在多媒体会话 中 sDP 传送有关媒体流的信息，使会话描述的参人方加人会话。SDP 主要用于 Intemet 网中，但也可以在其它网络环境下使用。SDP 十分通用，可描述其它网络环境中的会话，但主要用 于 Intemet 中。在 Intemet 环境下，SDP 有两个主要目的：一是表明会话存在，二是传送足够信息给接收方，以便能加人、参加该会话。SDP 所传达的信息包括：会话名称和目的，会话 活动时间，组成会话媒体种类，接收这些媒体的控制信息（如地址、端口、格式、带宽和会议管理人员资料等）。</p>
<p>总结：在 RTSP 交互过程中，只要在客户端发出 Describe 请求的时候，服务端回应的时候会有 SDP 消息发出，用 SDP 来描述会话情况和内容，方便客户端能够加入该会话。</p>
<h2 id="RTSP-基于-libcurl-代码实现"><a href="#RTSP-基于-libcurl-代码实现" class="headerlink" title="RTSP 基于 libcurl 代码实现"></a>RTSP 基于 libcurl 代码实现</h2><pre><code>/*
 * Copyright (c) 2011, Jim Hollinger
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *   * Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   * Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *   * Neither the name of Jim Hollinger nor the names of its contributors
 *     may be used to endorse or promote products derived from this
 *     software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
/* &lt;DESC&gt;
 * A basic RTSP transfer
 * &lt;/DESC&gt;
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;curl/curl.h&gt;

#if defined (WIN32)
#include &lt;conio.h&gt;  /* _getch() */
#else
#include &lt;termios.h&gt;
#include &lt;unistd.h&gt;

#define VERSION_STR  &quot;V1.0&quot;

/* error handling macros */
#define my_curl_easy_setopt(A, B, C)                             \
  res = curl_easy_setopt((A), (B), (C));                         \
  if(!res)                                                       \
    fprintf(stderr, &quot;curl_easy_setopt(%s, %s, %s) failed: %d\n&quot;, \
            #A, #B, #C, res);

#define my_curl_easy_perform(A)                                     \
  res = curl_easy_perform(A);                                       \
  if(!res)                                                          \
    fprintf(stderr, &quot;curl_easy_perform(%s) failed: %d\n&quot;, #A, res);

static int _getch(void)
{
  struct termios oldt, newt;
  int ch;
  tcgetattr(STDIN_FILENO, &amp;oldt);
  newt = oldt;
  newt.c_lflag &amp;= ~( ICANON | ECHO);
  tcsetattr(STDIN_FILENO, TCSANOW, &amp;newt);
  ch = getchar();
  tcsetattr(STDIN_FILENO, TCSANOW, &amp;oldt);
  return ch;
}
#endif

/* send RTSP OPTIONS request */
static void rtsp_options(CURL *curl, const char *uri)
{
  CURLcode res = CURLE_OK;
  printf(&quot;\nRTSP: OPTIONS %s\n&quot;, uri);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_STREAM_URI, uri);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_REQUEST, (long)CURL_RTSPREQ_OPTIONS);
  my_curl_easy_perform(curl);
}

/* send RTSP DESCRIBE request and write sdp response to a file */
static void rtsp_describe(CURL *curl, const char *uri,
                          const char *sdp_filename)
{
  CURLcode res = CURLE_OK;
  FILE *sdp_fp = fopen(sdp_filename, &quot;wb&quot;);
  printf(&quot;\nRTSP: DESCRIBE %s\n&quot;, uri);
  if(sdp_fp == NULL) {
    fprintf(stderr, &quot;Could not open &#39;%s&#39; for writing\n&quot;, sdp_filename);
    sdp_fp = stdout;
  }
  else {
    printf(&quot;Writing SDP to &#39;%s&#39;\n&quot;, sdp_filename);
  }
  my_curl_easy_setopt(curl, CURLOPT_WRITEDATA, sdp_fp);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_REQUEST, (long)CURL_RTSPREQ_DESCRIBE);
  my_curl_easy_perform(curl);
  my_curl_easy_setopt(curl, CURLOPT_WRITEDATA, stdout);
  if(sdp_fp != stdout) {
    fclose(sdp_fp);
  }
}

/* send RTSP SETUP request */
static void rtsp_setup(CURL *curl, const char *uri, const char *transport)
{
  CURLcode res = CURLE_OK;
  printf(&quot;\nRTSP: SETUP %s\n&quot;, uri);
  printf(&quot;      TRANSPORT %s\n&quot;, transport);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_STREAM_URI, uri);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_TRANSPORT, transport);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_REQUEST, (long)CURL_RTSPREQ_SETUP);
  my_curl_easy_perform(curl);
}

/* send RTSP PLAY request */
static void rtsp_play(CURL *curl, const char *uri, const char *range)
{
  CURLcode res = CURLE_OK;
  printf(&quot;\nRTSP: PLAY %s\n&quot;, uri);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_STREAM_URI, uri);
  my_curl_easy_setopt(curl, CURLOPT_RANGE, range);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_REQUEST, (long)CURL_RTSPREQ_PLAY);
  my_curl_easy_perform(curl);
}

/* send RTSP TEARDOWN request */
static void rtsp_teardown(CURL *curl, const char *uri)
{
  CURLcode res = CURLE_OK;
  printf(&quot;\nRTSP: TEARDOWN %s\n&quot;, uri);
  my_curl_easy_setopt(curl, CURLOPT_RTSP_REQUEST, (long)CURL_RTSPREQ_TEARDOWN);
  my_curl_easy_perform(curl);
}

/* convert url into an sdp filename */
static void get_sdp_filename(const char *url, char *sdp_filename,
                             size_t namelen)
{
  const char *s = strrchr(url, &#39;/&#39;);
  strcpy(sdp_filename, &quot;video.sdp&quot;);
  if(s != NULL) {
    s++;
    if(s[0] != &#39;\0&#39;) {
      snprintf(sdp_filename, namelen, &quot;%s.sdp&quot;, s);
    }
  }
}

/* scan sdp file for media control attribute */
static void get_media_control_attribute(const char *sdp_filename,
                                        char *control)
{
  int max_len = 256;
  char *s = malloc(max_len);
  FILE *sdp_fp = fopen(sdp_filename, &quot;rb&quot;);
  control[0] = &#39;\0&#39;;
  if(sdp_fp != NULL) {
    while(fgets(s, max_len - 2, sdp_fp) != NULL) {
      sscanf(s, &quot; a = control: %s&quot;, control);
    }
    fclose(sdp_fp);
  }
  free(s);
}

/* main app */
int main(int argc, char * const argv[])
{
#if 1
  const char *transport = &quot;RTP/AVP;unicast;client_port=1234-1235&quot;;  /* UDP */
#else
  /* TCP */
  const char *transport = &quot;RTP/AVP/TCP;unicast;client_port=1234-1235&quot;;
#endif
  const char *range = &quot;0.000-&quot;;
  int rc = EXIT_SUCCESS;
  char *base_name = NULL;

  printf(&quot;\nRTSP request %s\n&quot;, VERSION_STR);
  printf(&quot;    Project web site: http://code.google.com/p/rtsprequest/\n&quot;);
  printf(&quot;    Requires curl V7.20 or greater\n\n&quot;);

  /* check command line */
  if((argc != 2) &amp;&amp; (argc != 3)) {
    base_name = strrchr(argv[0], &#39;/&#39;);
    if(base_name == NULL) {
      base_name = strrchr(argv[0], &#39;\\&#39;);
    }
    if(base_name == NULL) {
      base_name = argv[0];
    }
    else {
      base_name++;
    }
    printf(&quot;Usage:   %s url [transport]\n&quot;, base_name);
    printf(&quot;         url of video server\n&quot;);
    printf(&quot;         transport (optional) specifier for media stream&quot;
           &quot; protocol\n&quot;);
    printf(&quot;         default transport: %s\n&quot;, transport);
    printf(&quot;Example: %s rtsp://192.168.0.2/media/video1\n\n&quot;, base_name);
    rc = EXIT_FAILURE;
  }
  else {
    const char *url = argv[1];
    char *uri = malloc(strlen(url) + 32);
    char *sdp_filename = malloc(strlen(url) + 32);
    char *control = malloc(strlen(url) + 32);
    CURLcode res;
    get_sdp_filename(url, sdp_filename, strlen(url) + 32);
    if(argc == 3) {
      transport = argv[2];
    }

    /* initialize curl */
    res = curl_global_init(CURL_GLOBAL_ALL);
    if(res == CURLE_OK) {
      curl_version_info_data *data = curl_version_info(CURLVERSION_NOW);
      CURL *curl;
      fprintf(stderr, &quot;    curl V%s loaded\n&quot;, data-&gt;version);

      /* initialize this curl session */
      curl = curl_easy_init();
      if(curl != NULL) {
        my_curl_easy_setopt(curl, CURLOPT_VERBOSE, 0L);
        my_curl_easy_setopt(curl, CURLOPT_NOPROGRESS, 1L);
        my_curl_easy_setopt(curl, CURLOPT_HEADERDATA, stdout);
        my_curl_easy_setopt(curl, CURLOPT_URL, url);

        /* request server options */
        snprintf(uri, strlen(url) + 32, &quot;%s&quot;, url);
        rtsp_options(curl, uri);

        /* request session description and write response to sdp file */
        rtsp_describe(curl, uri, sdp_filename);

        /* get media control attribute from sdp file */
        get_media_control_attribute(sdp_filename, control);

        /* setup media stream */
        snprintf(uri, strlen(url) + 32, &quot;%s/%s&quot;, url, control);
        rtsp_setup(curl, uri, transport);

        /* start playing media stream */
        snprintf(uri, strlen(url) + 32, &quot;%s/&quot;, url);
        rtsp_play(curl, uri, range);
        printf(&quot;Playing video, press any key to stop ...&quot;);
        _getch();
        printf(&quot;\n&quot;);

        /* teardown session */
        rtsp_teardown(curl, uri);

        /* cleanup */
        curl_easy_cleanup(curl);
        curl = NULL;
      }
      else {
        fprintf(stderr, &quot;curl_easy_init() failed\n&quot;);
      }
      curl_global_cleanup();
    }
    else {
      fprintf(stderr, &quot;curl_global_init(%s) failed: %d\n&quot;,
              &quot;CURL_GLOBAL_ALL&quot;, res);
    }
    free(control);
    free(sdp_filename);
    free(uri);
  }

  return rc;
}</code></pre><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol>
<li><a href="https://www.jianshu.com/p/4e3925f98e84" target="_blank" rel="noopener">RTSP 协议</a></li>
<li><a href="https://blog.csdn.net/bytxl/article/details/50400987" target="_blank" rel="noopener">RTCP 协议详解</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/network/" rel="tag"># network</a>
              <a href="/tags/http/" rel="tag"># http</a>
              <a href="/tags/rtsp/" rel="tag"># rtsp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/02/25/dlan-introduction/" rel="next" title="DLNA 协议分析及应用">
                  <i class="fa fa-chevron-left"></i> DLNA 协议分析及应用
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/02/26/sat2ip-protocol/" rel="prev" title="SAT>IP 协议简介">
                  SAT>IP 协议简介 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RTSP-简介"><span class="nav-number">1.</span> <span class="nav-text">RTSP 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTSP-和-HTTP-RTP-RTCP-的关系"><span class="nav-number">2.</span> <span class="nav-text">RTSP 和 HTTP RTP(RTCP) 的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RTSP-和-HTTP"><span class="nav-number">2.1.</span> <span class="nav-text">RTSP 和 HTTP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RTSP-和-RTP-RTCP"><span class="nav-number">2.2.</span> <span class="nav-text">RTSP 和 RTP(RTCP)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTSP-消息"><span class="nav-number">3.</span> <span class="nav-text">RTSP 消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单的-rtsp-交互过程："><span class="nav-number">4.</span> <span class="nav-text">简单的 rtsp 交互过程：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTSP-中常用方法"><span class="nav-number">5.</span> <span class="nav-text">RTSP 中常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OPTION"><span class="nav-number">5.1.</span> <span class="nav-text">OPTION</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DESCRIBE"><span class="nav-number">5.2.</span> <span class="nav-text">DESCRIBE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SETUP"><span class="nav-number">5.3.</span> <span class="nav-text">SETUP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PLAY"><span class="nav-number">5.4.</span> <span class="nav-text">PLAY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TEARDOWN"><span class="nav-number">5.5.</span> <span class="nav-text">TEARDOWN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SDP-协议"><span class="nav-number">6.</span> <span class="nav-text">SDP 协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTSP-基于-libcurl-代码实现"><span class="nav-number">7.</span> <span class="nav-text">RTSP 基于 libcurl 代码实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ref"><span class="nav-number">8.</span> <span class="nav-text">Ref</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Breeze.Temple"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Breeze.Temple</p>
  <div class="site-description" itemprop="description">Breeze.Temple</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">433</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">457</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/breezetemple" title="GitHub &rarr; https://github.com/breezetemple" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bitbucket.org" title="BitBucket &rarr; https://bitbucket.org" rel="noopener" target="_blank"><i class="fa fa-fw fa-bitbucket"></i>BitBucket</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://breezetemple.github.io/" title="http://breezetemple.github.io/" rel="noopener" target="_blank">Breeze.Temple's HomePage</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Breeze.Temple</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">1.2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">17:37</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>














  

  


  <link rel="stylesheet" href="/js/highlight/styles/solarized-dark.css">
  <script src="/js/highlight/highlight.pack.js"></script>
  <script type="text/javascript">
      $(function() {
          hljs.initHighlighting();
      });
  </script>

</body>
</html>

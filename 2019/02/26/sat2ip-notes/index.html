<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="针对文档 satip_specification_version_1_2_2 笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="SAT&gt;IP 协议笔记">
<meta property="og:url" content="http://yoursite.com/2019/02/26/sat2ip-notes/index.html">
<meta property="og:site_name" content="IT日记">
<meta property="og:description" content="针对文档 satip_specification_version_1_2_2 笔记">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-02-26T06:49:28.000Z">
<meta property="article:modified_time" content="2020-07-23T03:12:23.071Z">
<meta property="article:author" content="Breeze.Temple">
<meta property="article:tag" content="upnp">
<meta property="article:tag" content="sat2ip">
<meta property="article:tag" content="ssdp">
<meta property="article:tag" content="rtsp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2019/02/26/sat2ip-notes/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>SAT>IP 协议笔记 | IT日记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IT日记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Life is Now.</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/sat2ip-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Breeze.Temple">
      <meta itemprop="description" content="Breeze.Temple">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT日记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SAT>IP 协议笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-02-26 14:49:28" itemprop="dateCreated datePublished" datetime="2019-02-26T14:49:28+08:00">2019-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-23 11:12:23" itemprop="dateModified" datetime="2020-07-23T11:12:23+08:00">2020-07-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/UPnP/" itemprop="url" rel="index">
                    <span itemprop="name">UPnP</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>17 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>针对文档 <a href="http://www.satip.info/sites/satip/files/resource/satip_specification_version_1_2_2.pdf" target="_blank" rel="noopener">satip_specification_version_1_2_2</a> 笔记</p>
<a id="more"></a>


<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><code>SAT&gt;IP</code> 规范是一份通信协议，不是设备规范。在 <code>SAT&gt;IP</code> 规范下存在两种角色</p>
<ul>
<li><code>SAT&gt;IP</code> Server</li>
<li><code>SAT&gt;IP</code> Client</li>
</ul>
<p>一个具体的设备可以是其中一个角色，或者两者兼具。</p>
<p><code>SAT&gt;IP</code> 协议提供了一种标准化的方式，使客户端可以通过网络来访问 sat 上的实时流</p>
<p><code>SAT&gt;IP</code> 协议实现了卫星接收端与播放端分离，卫星接收端被放在远端服务器上， <code>SAT&gt;IP</code> 协议提供控制协议，Clients 可以远程控制</p>
<p>从而扩展了卫星接收端的范围</p>
<p><code>SAT&gt;IP</code> 是一种客户端驱动的架构。客户端向服务器发送请求。服务器执行这些请求和向客户转发直播电视节目。</p>
<h3 id="SAT-gt-IP-Clients"><a href="#SAT-gt-IP-Clients" class="headerlink" title="SAT&gt;IP Clients"></a><code>SAT&gt;IP Clients</code></h3><p><code>SAT&gt;IP Clients</code> 通过发送请求完成获取 channel list 和播放指定节目功能</p>
<ul>
<li>具有网络连接能力的 STB</li>
<li>NAS</li>
<li>Smartphones</li>
<li>PCs</li>
<li>etc.</li>
</ul>
<h3 id="SAT-gt-IP-Servers"><a href="#SAT-gt-IP-Servers" class="headerlink" title="SAT&gt;IP Servers"></a><code>SAT&gt;IP Servers</code></h3><p><code>SAT&gt;IP Servers</code> 处理 <code>SAT&gt;IP Clients</code> 的请求并将电视直播节目转发给 <code>SAT&gt;IP Clients</code></p>
<p>从简单到复杂</p>
<ul>
<li>IP Adapters / Multiswitches</li>
<li>Master STBs</li>
<li>IP LNBs</li>
<li>MDU(Multi Dwelling Unit) 多用户居住单元</li>
</ul>
<h3 id="网络拓扑结构"><a href="#网络拓扑结构" class="headerlink" title="网络拓扑结构"></a>网络拓扑结构</h3><p>以 <code>SAT&gt;IP Servers</code> 能力来完成对 Clients 的支持</p>
<p>可以是单卫星 - 单 Tuner/ 多卫星 - 多 Tuner</p>
<p>即可以是单个家庭场景中工作，也可以是宾馆等大型社区场景下工作</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>描述几种常用的场景</p>
<h3 id="IP-Adapter-IP-Multiswitch"><a href="#IP-Adapter-IP-Multiswitch" class="headerlink" title="IP Adapter / IP Multiswitch"></a>IP Adapter / IP Multiswitch</h3><p>将卫星信号转换为 IP 数据，同时可以按照 <code>SAT&gt;IP</code> 协议处理 Client 发送的控制命令</p>
<p>一般会有多个卫星信号输入用来为多客户端提供并发支持</p>
<p>例如：<a href="https://unitrongroup.com/en/products/CAT/SIP/MSW/9830.html" target="_blank" rel="noopener">Johansson SAT&gt;IP Multiswitch 9830</a></p>
<p>支持 4 路卫星信号输入，支持 2×8 信号输出，通过网口，支持 8 路独立收看电视节目</p>
<p>内部集成 multiswitch/disqec 等控制</p>
<h3 id="IP-LNB"><a href="#IP-LNB" class="headerlink" title="IP LNB"></a>IP LNB</h3><p><a href="http://www.satip.info/sites/satip/files/files/GB%20-%20Product%20info%20%5BTriax%20SAT-IP-LNB%5D%2005-2016%20-1.pdf" target="_blank" rel="noopener">Triax SAT&gt;IP LNB unit</a></p>
<p>Common features:</p>
<ul>
<li>8 x Full Band H/V DVB-S/S2 tuners</li>
<li>Unlimited number of transponders from position</li>
<li>Supports 8 x SAT&gt;IP clients (one each tuner)</li>
<li>SAT&gt;IP via Gigabit Ethernet RJ45 connector output</li>
<li>Up to 900 Mbps transport stream bandwidth</li>
<li>Separate H and V Full Band SAT-IF outputs</li>
<li>Powered via 802.3@rev 2012 PoE type 1, class 2</li>
<li>No DiSEqC, 22kHz or FSK required or supported</li>
<li>Transparently supports FTA as well as CAS services</li>
<li>Die-cast housing</li>
<li>Power consumption &lt;7.5W</li>
</ul>
<p>新的 LNA 设备，使用 <code>POE</code> 供电，可以支持作为 <code>SAT&gt;IP Server</code> 输出 IP 数据</p>
<h3 id="Master-STBs"><a href="#Master-STBs" class="headerlink" title="Master STBs"></a>Master STBs</h3><p>通过在传统 STB 上开发 <code>SAT&gt;IP Server</code> 完成扩展，主要讨论的内容</p>
<h3 id="SMATV-Satellite-Master-Antenna-Television-MDU-Multi-Dwelling-Units"><a href="#SMATV-Satellite-Master-Antenna-Television-MDU-Multi-Dwelling-Units" class="headerlink" title="SMATV(Satellite Master Antenna Television) / MDU(Multi-Dwelling Units)"></a>SMATV(Satellite Master Antenna Television) / MDU(Multi-Dwelling Units)</h3><p>是指电视程序到安装在一个公寓大楼，宾馆或其它中心位置的卫星共享天线的传输，在那里它为电视观众私人组服务。</p>
<p>组网</p>
<h2 id="协议规范"><a href="#协议规范" class="headerlink" title="协议规范"></a>协议规范</h2><p><code>SAT&gt;IP</code> 是在已有协议基础上的扩展，主要依赖于以下协议</p>
<ul>
<li>UPnP for Addressing, Discovery and Description</li>
<li>RTSP or HTTP for Control</li>
<li>RTP or HTTP for Media Transport</li>
</ul>
<p>协议栈组织形式：</p>
<p>与 <code>DLNA</code> 的关系</p>
<p>使用了 <code>UPnP/DLNA</code> 架构的子集和协议</p>
<ul>
<li>UPnP Device Architecture 1.1</li>
<li>DLNA Networked Device Interoperability Guidelines</li>
</ul>
<p><code>SAT&gt;IP</code> 设备可以扩展为 <code>DLNA</code> 设备，另外客户端可以通用，例如 VLC 均通过 <code>UPnP</code> 来访问</p>
<p>阶段</p>
<ul>
<li>Addressing</li>
<li>Discovery</li>
<li>Description</li>
<li>Control</li>
<li>Media Transport</li>
</ul>
<h3 id="Addressing"><a href="#Addressing" class="headerlink" title="Addressing"></a>Addressing</h3><p>先决条件，一切通信的基础，按照 <code>UPnP</code> 规范提供两个选项</p>
<ul>
<li>DHCP</li>
<li>Auto-IP</li>
</ul>
<h3 id="Discovery"><a href="#Discovery" class="headerlink" title="Discovery"></a>Discovery</h3><ul>
<li>Server 发送通知给其他的 Servers 和 Clients</li>
<li>Clients 搜索可用的 Servers</li>
</ul>
<p><code>SSDP</code> 全称是 Simple Service Discover Protocol 简单服务发现协议，这个协议是 <code>UPnP</code> 的核心，在 <code>UPnP</code> 中定义了一组协议框架，其中有控制点，根设备等概念， <code>UPnP</code> 设备通过 <code>SSDP</code> 协议与根设备（用户设备）进行交互。<br><code>SSDP</code> 是应用层协议，使用 <code>HTTPU</code> 和 <code>HTTPMU</code> 规范，基于 <code>UDP</code> 端口进行通信。</p>
<ul>
<li>SAT&gt;IP server is a UPnP Device and a UPnP Control Point</li>
<li>SAT&gt;IP client is a UPnP Control Point</li>
</ul>
<p>Unique Resource Name (URN) in UPnP:</p>
<pre><code>urn:ses-com:device:SatIPServer:1</code></pre><p>UUID</p>
<pre><code>4B-2B-2B-2B-6B
Example of a UUID string:
“2fac1234-31f8-11b4-a222-08002b34c003”</code></pre><h4 id="Server-Advertisements-服务器通知"><a href="#Server-Advertisements-服务器通知" class="headerlink" title="Server Advertisements 服务器通知"></a>Server Advertisements 服务器通知</h4><p>SSDP 使用一个固定的组播地址 <code>239.255.255.250</code> 和 UDP 端口号 1900 来监听其他设备的请求。</p>
<p>根据 <code>UPnP</code> 对 <code>UPnP root devices</code> 的要求， <code>SAT&gt;IP servers</code> 入网时会对 <code>SSDP</code> 地址 <code>239.255.255.250:1900</code> 多播三个不同的 <code>NOTIFY ssdp:alive</code> 消息</p>
<pre><code>  12     strcpy(nt[0], &quot;::upnp:rootdevice&quot;);
  11     sprintf(nt[1], &quot;::uuid:%s&quot;, uuid);
  10     strcpy(nt[2], &quot;::urn:ses-com:device:SatIPServer:1&quot;);
   9
   8     if (s-&gt;type != TYPE_UDP)
   7         return 0;
   6
   5     LOGM(&quot;ssdp_discovery: bootid: %d deviceid: %d http: %s&quot;, opts.bootid,
   4          opts.device_id, opts.http_host);
   3
   2     for (i = 0; i &lt; 3; i++)
   1     {
1494         sprintf(buf, reply, opts.disc_host, opts.http_host, opts.xml_path,
   1                 nt[i] + 2, app_name, version, uuid, i == 1 ? &quot;&quot; : nt[i],
   2                 opts.bootid, opts.device_id);
   3         salen = sizeof(ssdp_sa);
   4         LOGM(&quot;Discovery packet %d:\n%s&quot;, i + 1, buf);
   5         int wb = sendto(s-&gt;sock, buf, strlen(buf), MSG_NOSIGNAL, (const struct sockaddr *)&amp;ssdp_sa, salen);
   6         if (wb != strlen(buf))
   7             LOG(&quot;incomplete ssdp_discovery: wrote %d out of %d: error %d: %s&quot;, wb, strlen(buf), errno, strerror(errno));
   8     }</code></pre><pre><code>NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
CACHE-CONTROL: max-age=1800
LOCATION: http://&lt;SatIPServer_IP_Address&gt;/&lt;description&gt;.xml
NT: &lt;notification type&gt;
NTS: ssdp:alive
SERVER: OS/version UPnP/1.1 product/version
USN: &lt;unique service name&gt;
BOOTID.UPNP.ORG: &lt;bootID&gt;
CONFIGID.UPNP.ORG: &lt;configID&gt;
SEARCHPORT.UPNP.ORG: &lt;searchPort&gt;
DEVICEID.SES.COM: &lt;DEVICEID&gt;
&lt;CRLF&gt;</code></pre><ul>
<li><code>NTS</code> 为 <code>ssdp:alive</code> 或 <code>ssdp:byebye</code></li>
<li><code>NT</code> 三种，the root device, its device uuid and the urn</li>
</ul>
<p>Example Announcement of a <code>SAT&gt;IP</code> server joining the network:</p>
<pre><code>NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
CACHE-CONTROL: max-age=1800
LOCATION: http://192.168.178.21/desc.xml
NT: upnp:rootdevice
NTS: ssdp:alive
SERVER: Linux/1.0 UPnP/1.1 IDL4K/1.0
USN: uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c::upnp:rootdevice
BOOTID.UPNP.ORG: 2318
CONFIGID.UPNP.ORG: 0
DEVICEID.SES.COM: 1

NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
CACHE-CONTROL: max-age=1800
LOCATION: http://192.168.178.21/desc.xml
NT: uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c
NTS: ssdp:alive
SERVER: Linux/1.0 UPnP/1.1 IDL4K/1.0
USN: uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c
BOOTID.UPNP.ORG: 2318
CONFIGID.UPNP.ORG: 0
DEVICEID.SES.COM: 1

NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
CACHE-CONTROL: max-age=1800
LOCATION: http://192.168.178.21/desc.xml
NT: urn:ses-com:device:SatIPServer:1
NTS: ssdp:alive
SERVER: Linux/1.0 UPnP/1.1 IDL4K/1.0
USN: uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c::urn:ses-com:device:SatIPServer:1
BOOTID.UPNP.ORG: 2318
CONFIGID.UPNP.ORG: 0
DEVICEID.SES.COM: 1</code></pre><p><code>SAT&gt;IP server</code> 离开网络时需要发送 <code>ssdp:byebye</code>，不包含 <code>CACHE-CONTROL, LOCATION, SERVER and DEVICEID.SES.COM</code> 字段</p>
<pre><code>NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
NT: upnp:rootdevice
NTS: ssdp:byebye
USN: uuid:5a0c857b-add1-42d0-8673-b5ca60df4a63::upnp:rootdevice
BOOTID.UPNP.ORG: 2
CONFIGID.UPNP.ORG: 0

NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
NT: uuid:5a0c857b-add1-42d0-8673-b5ca60df4a63
NTS: ssdp:byebye
USN: uuid:5a0c857b-add1-42d0-8673-b5ca60df4a63
BOOTID.UPNP.ORG: 2
CONFIGID.UPNP.ORG: 0

NOTIFY * HTTP/1.1
HOST: 239.255.255.250:1900
NT: urn:ses-com:device:SatIPServer:1
NTS: ssdp:byebye
USN: uuid:5a0c857b-add1-42d0-8673-b5ca60df4a63::urn:ses-com:device:SatIPServer:1
BOOTID.UPNP.ORG: 2
CONFIGID.UPNP.ORG: 0</code></pre><h4 id="DEVICE-ID-Negotiation-设备-ID-协商"><a href="#DEVICE-ID-Negotiation-设备-ID-协商" class="headerlink" title="DEVICE ID Negotiation 设备 ID 协商"></a>DEVICE ID Negotiation 设备 ID 协商</h4><p>每个在网的 <code>SAT&gt;IP Server</code> 都有一个唯一不冲突的 <code>DEVICE ID</code>，这个值存储于非易失区域</p>
<p>协商流程如下：</p>
<ol>
<li>设备冷启动之后，从 <code>non-volatile memory</code> 读出 <code>DEVICE ID</code> 值，然后作为 <code>announcement NOTIFY messages ssdp:alive</code> 参数多播发送</li>
<li>其他在网的 servers 会监听这些公告，如果 <code>DEVICE ID</code> 不存在冲突，不做任何反应；如果存在冲突，需要在 1s 以内，发送单播 <code>M-SEARCH message ssdp:disvocer</code> 到冲突的 server</li>
<li>入网 server 发送 200 ok 来确认，注意 <code>EXT</code> 字段</li>
<li>入网 server 发送 <code>ssdp:byebye</code>，可选项</li>
<li>入网 server 生成新的 <code>DEVICE ID</code>，一般是 <code>+1</code>，然后发送 <code>announcement NOTIFY messages ssdp:alive</code></li>
<li>5s 超时时间内未收到 <code>ssdp:discover</code> 表示没有冲突，使用新的 <code>DEVICE ID</code> 作为新的并存储</li>
</ol>
<p>流程如下：</p>
<p>multicast 地址？??</p>
<pre><code>239. &lt;DEVICEID&gt; . &lt;0-254&gt; . &lt;0-254&gt;</code></pre><p>如果一个 <code>SAT&gt;IP server</code> <code>DEVICEID=3</code>，那么地址为 <code>239.3.x.x</code></p>
<h4 id="Client-Search-Requests"><a href="#Client-Search-Requests" class="headerlink" title="Client Search Requests"></a>Client Search Requests</h4><p><code>client</code> 多播 <code>M-SEARCH ssdp:discover</code> 来发现在网 servers，由于 <code>udp</code> 的不可靠性，建议发送三次，间隔 100ms</p>
<p>Example Search Request of a <code>SAT&gt;IP</code> Client and Server Response:</p>
<pre><code>#In order to discover servers on the network a client sends a multicast M-SEARCH ssdp:discover message to 239.255.255.250 Port 1900

M-SEARCH * HTTP/1.1
HOST: 239.255.255.250:1900
ST: urn:ses-com:device:SatIPServer:1
MAN: &quot;ssdp:discover&quot;
MX: 2

#Servers respond in unicast UDP to IP address and port where request came from

HTTP/1.1 200 OK
CACHE-CONTROL: max-age=1800
DATE: Sat Jan 1 00:01:50 2000
EXT:
LOCATION: http://192.168.178.21/desc.xml
SERVER: Linux/1.0 UPnP/1.1 IDL4K/1.0
ST: urn:ses-com:device:SatIPServer:1
USN: uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c::urn:ses-com:device:SatIPServer:1
BOOTID.UPNP.ORG: 2399
CONFIGID.UPNP.ORG: 0</code></pre><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>通过 <code>xml</code> 文件向网络上其他 <code>UPnP Control Points</code> 提供更多信息，这个文件的路径是在 <code>Discovery</code> 阶段获取的， <code>LOCATION</code> 字段指出</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;root xmlns=&quot;urn:schemas-upnp-org:device-1-0&quot; configId=&quot;configuration number&quot;&gt;
&lt;specVersion&gt;
&lt;major&gt;1&lt;/major&gt;
&lt;minor&gt;1&lt;/minor&gt;
&lt;/specVersion&gt;
&lt;device&gt;
&lt;deviceType&gt;urn:ses-com:device:SatIPServer:1&lt;/deviceType&gt;
&lt;friendlyName&gt;short user-friendly title&lt;/friendlyName&gt;
&lt;manufacturer&gt;manufacturer name&lt;/manufacturer&gt;
&lt;manufacturerURL&gt;URL to manufacturer site&lt;/manufacturerURL&gt;
&lt;modelDescription&gt;long user-friendly title&lt;/modelDescription&gt;
&lt;modelName&gt;model name&lt;/modelName&gt;
&lt;modelNumber&gt;model number&lt;/modelNumber&gt;
&lt;modelURL&gt;URL to model site&lt;/modelURL&gt;
&lt;serialNumber&gt;manufacturer&#39;s serial number&lt;/serialNumber&gt;
&lt;UDN&gt;uuid:UUID&lt;/UDN&gt;
&lt;UPC&gt;Universal Product Code&lt;/UPC&gt;
&lt;iconList&gt;
&lt;icon&gt;
&lt;mimetype&gt;image/format&lt;/mimetype&gt;
&lt;width&gt;horizontal pixels&lt;/width&gt;
&lt;height&gt;vertical pixels&lt;/height&gt;
&lt;depth&gt;color depth&lt;/depth&gt;
&lt;url&gt;URL to icon&lt;/url&gt;
&lt;/icon&gt;
&lt;/iconList&gt;
&lt;presentationURL&gt;URL for presentation&lt;/presentationURL&gt;
&lt;/device&gt;
&lt;/root&gt;</code></pre>
<p><code>configid=</code> 值必须与 <code>discovery</code> 阶段的 <code>CONFIGID.UPNP.ORG</code> 相同</p>
<p>必须提供两张 JPEG 和两张 PNG 图标，小的尺寸为 <code>48×48</code>，大的为 <code>120×120</code></p>
<p><code>&lt;satip:X_SATIPCAP&gt;</code> 用来描述支持的前端类型及数量，放在 <code>&lt;device&gt;</code> 元素的尾部</p>
<pre><code>&lt;satip:X_SATIPCAP xmlns:satip=&quot;urn:ses-com:satip&quot;&gt;DVBS2-8,DVBT-4&lt;/satip:X_SATIPCAP&gt;</code></pre><p><code>SA&gt;IP server</code> 提供 <code>channel list</code></p>
<pre><code>&lt;satip:X_SATIPM3U xmlns:satip=&quot;urn:ses-com:satip&quot;&gt;/channellist.m3u&lt;/satip:X_SATIPM3U&gt;
&lt;satip:X_SATIPM3U xmlns:satip=&quot;urn:ses-com:satip&quot;&gt;http://www.example.com/channellist.m3u&lt;/satip:X_SATIPM3U&gt;</code></pre><pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;root xmlns=&quot;urn:schemas-upnp-org:device-1-0&quot; configId=&quot;0&quot;&gt;
&lt;specVersion&gt;
&lt;major&gt;1&lt;/major&gt;
&lt;minor&gt;1&lt;/minor&gt;
&lt;/specVersion&gt;
&lt;device&gt;
&lt;deviceType&gt;urn:ses-com:device:SatIPServer:1&lt;/deviceType&gt;
&lt;friendlyName&gt;SATIPBOX&lt;/friendlyName&gt;
&lt;manufacturer&gt;Manufacturer&lt;/manufacturer&gt;
&lt;manufacturerURL&gt;http://www.manufacturer.com&lt;/manufacturerURL&gt;
&lt;modelDescription&gt;SATIPBOX 500 4.0&lt;/modelDescription&gt;
&lt;modelName&gt;SATIPBOX&lt;/modelName&gt;
&lt;modelNumber&gt;1.0&lt;/modelNumber&gt;
&lt;modelURL&gt;http://www.manufacturer.com/satipbox&lt;/modelURL&gt;
&lt;serialNumber&gt;1S81A31231000007&lt;/serialNumber&gt;
&lt;UDN&gt;uuid:50c958a8-e839-4b96-b7ae-8f9d989e136c&lt;/UDN&gt;
&lt;iconList&gt;
&lt;icon&gt;
&lt;mimetype&gt;image/png&lt;/mimetype&gt;
&lt;width&gt;48&lt;/width&gt;
&lt;height&gt;48&lt;/height&gt;
&lt;depth&gt;24&lt;/depth&gt;
&lt;url&gt;/icons/sm.png&lt;/url&gt;
&lt;/icon&gt;
&lt;icon&gt;
&lt;mimetype&gt;image/png&lt;/mimetype&gt;
&lt;width&gt;120&lt;/width&gt;
&lt;height&gt;120&lt;/height&gt;
&lt;depth&gt;24&lt;/depth&gt;
&lt;url&gt;/icons/lr.png&lt;/url&gt;
&lt;/icon&gt;
&lt;icon&gt;
&lt;mimetype&gt;image/jpeg&lt;/mimetype&gt;
&lt;width&gt;48&lt;/width&gt;
&lt;height&gt;48&lt;/height&gt;
&lt;depth&gt;24&lt;/depth&gt;
&lt;url&gt;/icons/sm.jpg&lt;/url&gt;
&lt;/icon&gt;
&lt;icon&gt;
&lt;mimetype&gt;image/jpeg&lt;/mimetype&gt;
&lt;width&gt;120&lt;/width&gt;
&lt;height&gt;120&lt;/height&gt;
&lt;depth&gt;24&lt;/depth&gt;
&lt;url&gt;/icons/lr.jpg&lt;/url&gt;
&lt;/icon&gt;
&lt;/iconList&gt;
&lt;presentationURL&gt;/index.htm&lt;/presentationURL&gt;
&lt;satip:X_SATIPCAP xmlns:satip=&quot;urn:ses-com:satip&quot;&gt;DVBS2-8,DVBT-4&lt;/satip:X_SATIPCAP&gt;
&lt;satip:X_SATIPM3U xmlns:satip=&quot;urn:ses-com:satip&quot;&gt;/channellist.m3u&lt;/satip:X_SATIPM3U&gt;
&lt;/device&gt;
&lt;/root&gt;</code></pre>
<h3 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h3><p><code>control</code> 使用协议 <code>RTSP</code> 或 <code>HTTP</code></p>
<ul>
<li>RTP(Real Time Transport Protocol)</li>
<li>RTCP(Real Time Contorl Protocol)</li>
<li>RTSP（Real Time Streaming Protocol）</li>
</ul>
<h4 id="RTSP"><a href="#RTSP" class="headerlink" title="RTSP"></a>RTSP</h4><p>HTTP 与 RTSP 相比，HTTP 请求由客户机发出，服务器作出响应；使用 RTSP 时，客户机和服务器都可以发出请求，即 RTSP 可以是双向的。</p>
<p>RTSP 是一个基于文本的协议，它与 HTTP 十分相似。在 RTSP 中，保留了几乎所有的 HTTP 符号以及相关定义。所以，RTSP 十分利于扩展，并且容易使用程序进行解析。</p>
<p>RTSP 虽然可以用来获取实时流，但是协议中并没有定义传输实时流的方式。它通过与其它的传输机制配合，例如 RTP，进行实时流传输。在 RTSP 中，我们可以在 SETUP 方法中设置一些参数，以选择是用 TCP 还是用 UDP 作为 RTP 的底层传输协议。</p>
<p>RTSP 通过以会话 (Session) 的方式描述一个连接的生命周期。会话 (Session) 通过 RTSP 客户端使用 RTSP 的 SETUP 方法建立，然后 RTSP 客户端可以通过 PLAY、PAUSE、RECORD 等方法 (Method) 来控制实时流的播放、暂停以及回放等。当不再需要实时流的时候，RTSP 客户端通过 TEARDOWN 方法 (Method) 来结束这个会话 (Session)。</p>
<ol>
<li><a href="https://www.jianshu.com/p/4e3925f98e84" target="_blank" rel="noopener">RTSP 协议</a></li>
<li><a href="https://blog.csdn.net/shining100/article/details/6030818" target="_blank" rel="noopener">RTSP 简介以及常用方法使用实例</a></li>
</ol>
<p><code>SAT&gt;IP Clients</code> 使用 <code>RTSP TCP</code> 与 <code>SAT&gt;IP Servers</code> 建立 <code>RTSP sessions</code> （RTSP 会话），以 <code>RTSP SETUP</code> 起始，以 <code>RTSP TEARDOWN</code> 结束， <code>session number</code> 由 <code>server</code> 分配唯一标识</p>
<p><code>SAT&gt;IP</code> 使用标准 <code>RTSP</code> 端口号 <code>554</code></p>
<p><code>RTSP</code> 与 <code>TCP</code> 关系</p>
<p>RTSP 会话通常跨越多个 TCP 连接（例如，每个 TCP 连接一个请求 - 响应）。但是，RTSP 会话也可以由单个 TCP 连接组成（持久模式）包括几个 RTSP 请求 - 响应对。</p>
<p>如图所示：</p>
<p>以下两种情况需要关闭 <code>TCP connection</code></p>
<ol>
<li>通过连接管理的所有 <code>RTSP</code> 会话都已超时</li>
<li>响应上一次 RTSP 会话的会话级 TEARDOWN 请求后 10 秒</li>
</ol>
<h4 id="SETUP"><a href="#SETUP" class="headerlink" title="SETUP"></a>SETUP</h4><p><code>SAT&gt;IP</code> 发送 <code>RTSP SETUP</code> 请求来建立新的会话，包括如下内容</p>
<ul>
<li><code>RTSP URI</code> 查询字符串 <code>TS 流参数</code>，位于第一行</li>
<li><code>RTSP SETUP</code> 头中携带 <code>TS</code> 传输参数（unicast/multicast, ports, etc.）</li>
</ul>
<p>如果会话建立成功，返回 <code>200 OK</code> 消息，内容如下</p>
<ul>
<li><code>RTSP session number</code></li>
<li>实际的 <code>TS</code> 传输参数，例如 <code>IP</code> 目标地址和端口</li>
<li>唯一标识 <code>TS</code> 媒体流的 <code>streamID</code></li>
</ul>
<p>服务器和客户端之间的每个 RTSP 会话由随机生成的会话号 <code>session number</code> 标识。</p>
<p><code>streamID</code> 唯一标识 <code>TS 媒体流对象</code>，客户端使用 <code>streamID</code> 来引用在 <code>SETUP</code> 设置的 <code>TS 流</code></p>
<p>新建会话并定义媒体流参数的客户端是这个流的所有者</p>
<blockquote>
<p>The client which sets up the session and defines the parameters of the media stream is the owner of the stream.</p>
</blockquote>
<p>Unicast Transport Delivery Example:</p>
<pre><code>Request  SETUP rtsp://192.168.128.5/?src=1&amp;fe=1&amp;freq=12402&amp;pol=v&amp;msys=dvbs&amp;sr=27500&amp;fec=34&amp;pids=0,16,
         50,104,166,1707 RTSP/1.0
         CSeq: 1
         Transport: RTP/AVP;unicast;client_port=1400-1401
         &lt;CRLF&gt;

Response RTSP/1.0 200 OK
         CSeq: 1
         Session: 12345678;timeout=60
         Transport: RTP/AVP;unicast;client_port=1400-1401
         com.ses.streamID: 1
         &lt;CRLF&gt;</code></pre><ul>
<li><code>Cseq</code> 每个 <code>request</code> - <code>response</code> 必须一致</li>
<li><code>Session</code> 包括 <code>session id</code> 和 <code>time out</code></li>
<li><code>com.ses.streamID</code> 为 <code>streamID</code></li>
<li><code>Transport</code> 指示使用的传输协议及参数</li>
</ul>
<pre><code>RTP/AVP;unicast;client_port=&lt;client RTP port&gt;-&lt;client RTCP port&gt;
RTP/AVP;multicast;destination=&lt;IP multicast address&gt;;port=&lt;RTP port&gt;-&lt;RTCP port&gt;;ttl=&lt;ttl&gt;
RTP/AVP;multicast
RTP/AVP;multicast;ttl=&lt;ttl&gt;
RTP/AVP;multicast;port=&lt;RTP port&gt;-&lt;RTCP port&gt;
RTP/AVP;multicast;port=&lt;RTP port&gt;-&lt;RTCP port&gt;;ttl=&lt;ttl&gt;
RTP/AVP;multicast;destination=&lt;IP multicast address&gt;
RTP/AVP;multicast;destination=&lt;IP multicast address&gt;;ttl=&lt;ttl&gt;
RTP/AVP;multicast;destination=&lt;IP multicast address&gt;;port=&lt;RTP port&gt;-&lt;RTCP port&gt;
RTP/AVP;multicast;destination=&lt;IP multicast address&gt;;port=&lt;RTP port&gt;-&lt;RTCP port&gt;;ttl=&lt;ttl&gt;</code></pre><ul>
<li><code>RTP/AVP</code>，表示流传输格式。在 <code>SAT&gt;IP</code> 中仅支持 <code>RTP/AVP</code></li>
<li><code>unicast | multicast</code>，单播 / 多播</li>
<li><code>destination</code>，多播下的选项，指示 <code>TS</code> 发送目标地址</li>
<li><code>client_port</code>，单播选项，指示 <code>RTP/RTCP</code> 端口</li>
<li><code>port</code>，多播选项，指示 <code>RTP/RTCP</code> 端口</li>
<li><code>ttl</code>，多播选项，指示 <code>time-to-live</code></li>
</ul>
<p>注意事项：</p>
<ol>
<li><code>RTP</code> 端口为偶数，而 <code>RTCP</code> 为 <code>+1</code> 的奇数</li>
<li>单播和多播端口不一样</li>
</ol>
<pre><code>For unicast:
client_port= &lt;client RTP port&gt; - &lt;client RTCP port&gt;
server_port= &lt;server RTP port&gt; - &lt;server RTCP port&gt;

For multicast:
port= &lt;RTP port&gt; - &lt;RTCP port&gt;</code></pre><p><strong>Joining an existing stream without becoming stream owner??</strong></p>
<pre><code>SETUP rtsp://192.168.178.57:554/?src=1&amp;fe=1&amp;freq=10744&amp;pol=h&amp;ro=0.35&amp;msys=dvbs&amp;mtype=qpsk&amp;plts=off&amp;sr=22000&amp;fec=56&amp;pids=0,400,401,402 RTSP/1.0
CSeq:1
Transport: RTP/AVP;multicast
Connection:close

RTSP/1.0 200 OK
Session:21dbf7c5873c9ff;timeout=30
com.ses.streamID:8
Transport:RTP/AVP;multicast;destination=239.0.0.3;port=1500-1501;ttl=2
CSeq:1</code></pre><pre><code>SETUP rtsp://192.168.178.57:554/?src=1&amp;fe=1&amp;freq=10744&amp;pol=h&amp;ro=0.35&amp;msys=dvbs&amp;mtype=qpsk&amp;plts=off&amp;sr=22000&amp;fec=56&amp;pids=0,400,401,402 RTSP/1.0
CSeq:1
Transport: RTP/AVP;multicast
Connection:close

RTSP/1.0 200 OK
Session:222626d35aa05f4;timeout=30
com.ses.streamID:17
Transport:RTP/AVP;multicast;destination=239.0.0.8;port=1500-1501;ttl=2
CSeq:1</code></pre><p><strong>Example RTSP SETUP messages</strong></p>
<h4 id="PLAY"><a href="#PLAY" class="headerlink" title="PLAY"></a>PLAY</h4><ul>
<li>单播，使用 <code>streamID</code> 发送 <code>RTSP PLAY</code></li>
<li>多播，两个选择，其一与单播相同；另外一个是向组播组 <code>multicast group</code> 发送 <code>IGMPv3 membership report</code></li>
</ul>
<p>发送 <code>PLAY</code> 消息后开始传输 <code>RTP/RTCP</code> 数据</p>
<ul>
<li>如果前端设置正确，TS 流正确传输</li>
<li>如果前端不正确，丢失信号或者 PID 设置不正确，每 100ms 发送一个 RTP 空包</li>
</ul>
<p><code>PLAY</code> 消息常用来切换节目</p>
<p><code>SAT&gt;IP server</code> 输出取决于服务器状态和多媒体流拥有者状态</p>
<blockquote>
<p>The SAT&gt;IP server output depends on the server state (resulting from the sequence of RTSP and/or IGMP methods invoked by a client) and the state of the media stream owner.</p>
</blockquote>
<p><strong>Server Stream Output State Machine</strong></p>
<h4 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h4><p><code>RTSP</code> 会话建立之后需要发送 <code>OPTIONS</code> 来维持会话，服务器也需要依靠 <code>OPTIONS</code> 来确认那些 <code>clients</code> 存在</p>
<p><strong>Examples</strong></p>
<pre><code>Request&gt;
OPTIONS rtsp://192.168.178.57:554/ RTSP/1.0
CSeq:5
Session:2180f601c42957d
Connection:close

Response&gt;
RTSP/1.0 200 OK
Public:OPTIONS,SETUP,PLAY,TEARDOWN,DESCRIBE
CSeq:5
Session:2180f601c42957d</code></pre><h4 id="修改媒体流"><a href="#修改媒体流" class="headerlink" title="修改媒体流"></a>修改媒体流</h4><p><code>TS</code> 流只能由它的拥有者修改，通常调用 <code>RTSP PLAY</code> 来修改。</p>
<p>某些情况下需要修改 <code>Transport</code> 参数，这时需要使用 <code>in-session SETUP</code></p>
<pre><code>Request&gt;
PLAY rtsp://192.168.178.57:554/stream=5?src=1&amp;fe=1&amp;freq=12603&amp;pol=h&amp;ro=0.35&amp;msys=dvbs&amp;mtype=qpsk&amp;plts=off&amp;sr=22000
&amp;fec=56&amp;pids=0,1290,2290,6290,7290 RTSP/1.0
CSeq:8
Session:21a15c02c1ee244
Connection:close

Response&gt;
RTSP/1.0 200 OK
RTP-Info:url=rtsp://192.168.178.57/stream=5;seq=22857
CSeq:8
Session:21a15c02c1ee244</code></pre><h4 id="加入一个存在的流"><a href="#加入一个存在的流" class="headerlink" title="加入一个存在的流"></a>加入一个存在的流</h4><p><code>clients</code> 可以加入一个其他 <code>client</code> 拥有的 ts 流</p>
<ul>
<li>使用指定 <code>streamID</code> 调用 <code>SETUP</code> 和 <code>PLAY</code> 来建立新会话</li>
<li>发送 <code>IGMPv3 membership report</code></li>
</ul>
<p>使用多播 / 单播取决于 <code>owner</code> 初始化选择的 <code>transport</code> 类型</p>
<pre><code>Request&gt;
SETUP rtsp://192.168.128.192:554/stream=27 RTSP/1.0
CSeq:1
Transport: RTP/AVP;unicast;client_port=42494-42495
Connection:close

Response&gt;
RTSP/1.0 200 OK
Session:43ae7c353e77bc;timeout=60
com.ses.streamID:27
Transport:RTP/AVP;unicast;destination=192.168.128.100;client_port=42494-42495
CSeq:1</code></pre><h4 id="DESCRIBE"><a href="#DESCRIBE" class="headerlink" title="DESCRIBE"></a>DESCRIBE</h4><p><code>RTSP DESCRIBE</code> 为了获取 <code>SDP</code> (Session Description Protocol)</p>
<p>会话描述信息，提供 <code>server</code> 上多媒体描述，必须有至少一个 <code>session</code> 已经建立，否则返回 <code>404</code> 错误</p>
<pre><code>Request&gt;
DESCRIBE rtsp://192.168.128.5/
CSeq: 5
Accept: application/sdp
&lt;CRLF&gt;

Response&gt;
RTSP/1.0 200 OK
CSeq: 5
Content-Type: application/sdp
Content-Base: rtsp://192.168.128.5/
Content-Length: 724
&lt;CRLF&gt;
v=0
o=- 5678901234 7890123456 IN IP4 192.168.128.5
s=SatIPServer:1 4
t=0 0
m=video 5004 RTP/AVP 33
c=IN IP4 239.0.0.8/5
a=control:stream=0
a=fmtp:33 ver=1.0;src=1;tuner=1,240,1,7,12402,v,dvbs,,,,27500,34;pids=0,16,56,112,168,1709
a=inactive
m=video 5006 RTP/AVP 33
c=IN IP4 239.0.0.9/5
a=control:stream=1
a=fmtp:33 ver=1.0;src=1;tuner=1,240,1,7,12402,v,dvbs,,,,27500,34;pids=0,16,50,104,166,1707
a=sendonly
m=video 0 RTP/AVP 33
c=IN IP4 0.0.0.0
a=control:stream=2
a=fmtp:33 ver=1.0;src=1;tuner=1,240,1,7,12402,v,dvbs,,,,27500,34;pids=all
a=sendonly
m=video 5010 RTP/AVP 33
c=IN IP4 239.0.0.11/5
a=control:stream=3
a=fmtp:33 ver=1.0;src=2;tuner=2,221,1,6,11758,h,dvbs2,8psk,off,25,27500,56;pids=all
a=sendonly</code></pre><ul>
<li>v = （协议版本）</li>
<li>o = （所有者 / 创建者和会话标识符）<session-id> <session-version> IN for internet and the IP address of the server.</li>
<li>s = （会话名称）SatIPServer:1 <frontends></li>
<li>i = * （会话信息）</li>
<li>u = * （URI 描述）</li>
<li>e = * （Email 地址）</li>
<li>p = * （电话号码）</li>
<li>c = * （连接信息）多播地址 /TTL 单播设置为 0.0.0.0</li>
<li>b = * （带宽信息）</li>
<li>z = * （时间区域调整）</li>
<li>k = * （加密密钥）</li>
<li>a = * （0 个或多个会话属性行）control:stream=<streamID></li>
<li>t = （会话活动时间）</li>
<li>r = * （0 或多次重复次数）</li>
<li>m = （媒体名称和传输地址）the media type, port, protocol 33: SAT&gt;IP 类型</li>
<li>i = * （媒体标题）</li>
<li>c = * （连接信息 — 如果包含在会话层则该字段可选）</li>
<li>b = * （带宽信息）</li>
<li>k = * （加密密钥）</li>
<li>a = * （0 个或多个媒体属性行）</li>
</ul>
<pre><code>Session Level:
s=SatIPServer:1 &lt;frontends&gt;

Media level:
a=control:stream=&lt;streamID&gt;
a=fmtp:33 ver=&lt;major&gt;.&lt;minor&gt;;src=&lt;srcID&gt;;tuner=&lt;feID&gt;,&lt;level&gt;,&lt;lock&gt;,&lt;quality&gt;,&lt;frequency&gt;,&lt;pol
arisation&gt;,&lt;system&gt;,&lt;type&gt;,&lt;pilots&gt;,&lt;roll_off&gt;,&lt;symbol_rate&gt;,&lt;fec_inner&gt;;pids=&lt;pid0&gt;,...,&lt;pidn&gt;</code></pre><h4 id="TEARDOWN"><a href="#TEARDOWN" class="headerlink" title="TEARDOWN"></a>TEARDOWN</h4><p>关闭会话</p>
<pre><code>Request&gt;
TEARDOWN rtsp://192.168.178.57:554/stream=2 RTSP/1.0
CSeq:5
Session:2166e663b4be550
Connection: close

Response&gt;
RTSP/1.0 200 OK
Content-Length:0
CSeq:5
Session:2166e663b4be550</code></pre><h4 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h4><pre><code></code></pre><p><code>RTSP 状态机</code></p>
<h4 id="Uniform-Resource-Identifier-URI"><a href="#Uniform-Resource-Identifier-URI" class="headerlink" title="Uniform Resource Identifier URI"></a>Uniform Resource Identifier URI</h4><h4 id="信号选择"><a href="#信号选择" class="headerlink" title="信号选择"></a>信号选择</h4><h4 id="RTSP-序列图"><a href="#RTSP-序列图" class="headerlink" title="RTSP 序列图"></a>RTSP 序列图</h4><h4 id="RTCP-Announcements"><a href="#RTCP-Announcements" class="headerlink" title="RTCP Announcements"></a>RTCP Announcements</h4><p><code>RTP</code> 传送的多媒体流都伴随着 <code>RTCP</code> 通知流，携带关于该特定 TS 媒体流的 SAT&gt;IP 配置的信息以及实时信息。</p>
<p>实时信息包括以下信息，更新速度 5/s。当信号不可用是需要发送空包</p>
<ul>
<li>信号锁定</li>
<li>信号强度</li>
<li>信号质量</li>
</ul>
<p>负载格式如下</p>
<pre><code>ver=&lt;major&gt;.&lt;minor&gt;;src=&lt;srcID&gt;;tuner=&lt;feID&gt;,&lt;level&gt;,&lt;lock&gt;,&lt;quality&gt;,&lt;frequency&gt;,&lt;polarisation&gt;,
&lt;system&gt;,&lt;type&gt;,&lt;pilots&gt;,&lt;roll_off&gt;,&lt;symbol_rate&gt;,&lt;fec_inner&gt;;pids=&lt;pid0&gt;,...,&lt;pidn&gt;

ver=1.0;src=1;tuner=1,240,1,7,12402,v,dvbs,,,,27500,34;pids=0,16,56,112,168,1709</code></pre><h3 id="Media-Transport"><a href="#Media-Transport" class="headerlink" title="Media Transport"></a>Media Transport</h3><h4 id="RTP"><a href="#RTP" class="headerlink" title="RTP"></a>RTP</h4><p><code>RTP</code> 一个包可以封装 7 个 <code>TS</code> 包</p>
<h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><h3 id="Dynamic-vs-Static-Server-Operation"><a href="#Dynamic-vs-Static-Server-Operation" class="headerlink" title="Dynamic vs Static Server Operation"></a>Dynamic vs Static Server Operation</h3><h4 id="Dynamic"><a href="#Dynamic" class="headerlink" title="Dynamic"></a>Dynamic</h4><h4 id="Static"><a href="#Static" class="headerlink" title="Static"></a>Static</h4><h3 id="Client-指南"><a href="#Client-指南" class="headerlink" title="Client 指南"></a>Client 指南</h3><p>包括 <code>RTSP Client</code> 和 <code>IGMP Client</code></p>
<h4 id="Client-Setup-and-Configuration-Settings"><a href="#Client-Setup-and-Configuration-Settings" class="headerlink" title="Client Setup and Configuration Settings"></a>Client Setup and Configuration Settings</h4><ol>
<li><code>SAT&gt;IP clients</code> 自动检测 <code>SAT&gt;IP servers</code><ol>
<li>监听 <code>SSDP NOTIFY</code></li>
<li>发送 <code>SSDP M-SEARCH</code></li>
</ol>
</li>
<li>自动绑定 <code>SAT&gt;IP servers</code></li>
<li>手动绑定到指定 <code>SAT&gt;IP servers</code></li>
<li>手动配置 <code>SAT&gt;IP servers</code> 地址</li>
<li>指定前端</li>
<li>配置天线</li>
</ol>
<h4 id="Service-Discovery"><a href="#Service-Discovery" class="headerlink" title="Service Discovery"></a>Service Discovery</h4><p><code>SAT&gt;IP</code> 规范不要求特定的服务发现机制，有两种</p>
<ol>
<li>Standard DVB Service Discovery，解析标准 DVB PSI/SI 表，解析慢，建议预置 service list</li>
<li>Discovery based on Service Lists</li>
</ol>
<p>第二种方式称为 <code>thin clients</code>，离线或在线服务器获取某一颗或几颗卫星的 services</p>
<p>客户端中应该添加选项以指定 <code>m3u list</code> 位置</p>
<pre><code>http://sat-ip_server/channel_file.m3u</code></pre><h4 id="切换节目"><a href="#切换节目" class="headerlink" title="切换节目"></a>切换节目</h4><p><code>channel list</code> 获取参照 <code>vlc</code> 代码 <code>upnp.cpp:int MediaServerList::Callback( Upnp_EventType event_type, UpnpEventPtr p_event )</code></p>
<p><strong>M3U playlist format (Unicast Streams)</strong></p>
<pre><code>#EXTM3U
#EXTINF:0,13. BBC World
rtsp://192.168.1.202/?src=1&amp;freq=11597&amp;pol=v&amp;msys=dvbs&amp;mtype=qpsk&amp;sr=22000&amp;fec=56&amp;pids=0,16,17,92,163,1858
#EXTINF:0,14. Sky News
rtsp://192.168.1.202/?src=1&amp;freq=12604&amp;pol=h&amp;msys=dvbs&amp;mtype=qpsk&amp;sr=22000&amp;fec=56&amp;pids=0,1290,2290,7290,6290,5290
#EXTINF:0,15. France24
rtsp://192.168.1.202/stream=18</code></pre><p><strong>M3U playlist format (Multicast Streams)</strong></p>
<pre><code>#EXTM3U
#EXTINF:0,1. TF1
rtp://232.0.1.17:8200
#EXTINF:0,2. France 2
rtp://232.0.1.1:8200
#EXTINF:0,3. France 3
rtp://232.0.1.2:8200</code></pre><h3 id="STB-作为-simpler-SAT-gt-IP-Servers"><a href="#STB-作为-simpler-SAT-gt-IP-Servers" class="headerlink" title="STB 作为 simpler SAT&gt;IP Servers"></a>STB 作为 simpler SAT&gt;IP Servers</h3><p>省略 <code>IGMP</code>、 <code>HTTP</code> 等</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/upnp/" rel="tag"># upnp</a>
              <a href="/tags/sat2ip/" rel="tag"># sat2ip</a>
              <a href="/tags/ssdp/" rel="tag"># ssdp</a>
              <a href="/tags/rtsp/" rel="tag"># rtsp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/02/26/sat2ip-protocol/" rel="next" title="SAT>IP 协议简介">
                  <i class="fa fa-chevron-left"></i> SAT>IP 协议简介
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/02/26/open-source-project-minisatip-analysis/" rel="prev" title="SAT2IP 开源工程分析">
                  SAT2IP 开源工程分析 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SAT-gt-IP-Clients"><span class="nav-number">1.1.</span> <span class="nav-text">SAT&gt;IP Clients</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SAT-gt-IP-Servers"><span class="nav-number">1.2.</span> <span class="nav-text">SAT&gt;IP Servers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络拓扑结构"><span class="nav-number">1.3.</span> <span class="nav-text">网络拓扑结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用场景"><span class="nav-number">2.</span> <span class="nav-text">使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-Adapter-IP-Multiswitch"><span class="nav-number">2.1.</span> <span class="nav-text">IP Adapter &#x2F; IP Multiswitch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-LNB"><span class="nav-number">2.2.</span> <span class="nav-text">IP LNB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Master-STBs"><span class="nav-number">2.3.</span> <span class="nav-text">Master STBs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SMATV-Satellite-Master-Antenna-Television-MDU-Multi-Dwelling-Units"><span class="nav-number">2.4.</span> <span class="nav-text">SMATV(Satellite Master Antenna Television) &#x2F; MDU(Multi-Dwelling Units)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#协议规范"><span class="nav-number">3.</span> <span class="nav-text">协议规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Addressing"><span class="nav-number">3.1.</span> <span class="nav-text">Addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discovery"><span class="nav-number">3.2.</span> <span class="nav-text">Discovery</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Server-Advertisements-服务器通知"><span class="nav-number">3.2.1.</span> <span class="nav-text">Server Advertisements 服务器通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DEVICE-ID-Negotiation-设备-ID-协商"><span class="nav-number">3.2.2.</span> <span class="nav-text">DEVICE ID Negotiation 设备 ID 协商</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Client-Search-Requests"><span class="nav-number">3.2.3.</span> <span class="nav-text">Client Search Requests</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Description"><span class="nav-number">3.3.</span> <span class="nav-text">Description</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Control"><span class="nav-number">3.4.</span> <span class="nav-text">Control</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RTSP"><span class="nav-number">3.4.1.</span> <span class="nav-text">RTSP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SETUP"><span class="nav-number">3.4.2.</span> <span class="nav-text">SETUP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PLAY"><span class="nav-number">3.4.3.</span> <span class="nav-text">PLAY</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OPTIONS"><span class="nav-number">3.4.4.</span> <span class="nav-text">OPTIONS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改媒体流"><span class="nav-number">3.4.5.</span> <span class="nav-text">修改媒体流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加入一个存在的流"><span class="nav-number">3.4.6.</span> <span class="nav-text">加入一个存在的流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DESCRIBE"><span class="nav-number">3.4.7.</span> <span class="nav-text">DESCRIBE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TEARDOWN"><span class="nav-number">3.4.8.</span> <span class="nav-text">TEARDOWN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#汇总"><span class="nav-number">3.4.9.</span> <span class="nav-text">汇总</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Uniform-Resource-Identifier-URI"><span class="nav-number">3.4.10.</span> <span class="nav-text">Uniform Resource Identifier URI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#信号选择"><span class="nav-number">3.4.11.</span> <span class="nav-text">信号选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RTSP-序列图"><span class="nav-number">3.4.12.</span> <span class="nav-text">RTSP 序列图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RTCP-Announcements"><span class="nav-number">3.4.13.</span> <span class="nav-text">RTCP Announcements</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Media-Transport"><span class="nav-number">3.5.</span> <span class="nav-text">Media Transport</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RTP"><span class="nav-number">3.5.1.</span> <span class="nav-text">RTP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP"><span class="nav-number">3.5.2.</span> <span class="nav-text">HTTP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamic-vs-Static-Server-Operation"><span class="nav-number">3.6.</span> <span class="nav-text">Dynamic vs Static Server Operation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynamic"><span class="nav-number">3.6.1.</span> <span class="nav-text">Dynamic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Static"><span class="nav-number">3.6.2.</span> <span class="nav-text">Static</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client-指南"><span class="nav-number">3.7.</span> <span class="nav-text">Client 指南</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Client-Setup-and-Configuration-Settings"><span class="nav-number">3.7.1.</span> <span class="nav-text">Client Setup and Configuration Settings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Discovery"><span class="nav-number">3.7.2.</span> <span class="nav-text">Service Discovery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#切换节目"><span class="nav-number">3.7.3.</span> <span class="nav-text">切换节目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#STB-作为-simpler-SAT-gt-IP-Servers"><span class="nav-number">3.8.</span> <span class="nav-text">STB 作为 simpler SAT&gt;IP Servers</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Breeze.Temple"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Breeze.Temple</p>
  <div class="site-description" itemprop="description">Breeze.Temple</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">453</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">487</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/breezetemple" title="GitHub &rarr; https://github.com/breezetemple" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bitbucket.org" title="BitBucket &rarr; https://bitbucket.org" rel="noopener" target="_blank"><i class="fa fa-fw fa-bitbucket"></i>BitBucket</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://breezetemple.github.io/" title="http://breezetemple.github.io/" rel="noopener" target="_blank">Breeze.Temple's HomePage</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Breeze.Temple</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">1.2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">18:26</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>














  

  


  <link rel="stylesheet" href="/js/highlight/styles/solarized-dark.css">
  <script src="/js/highlight/highlight.pack.js"></script>
  <script type="text/javascript">
      $(function() {
          hljs.initHighlighting();
      });
  </script>

</body>
</html>

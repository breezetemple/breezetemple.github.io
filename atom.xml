<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>IT日记</title>
  
  <subtitle>Life is Now.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-07-28T06:00:46.614Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Breeze.Temple</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>嵌入式内对齐及相关位运算</title>
    <link href="http://yoursite.com/2021/07/28/memory-alignment/"/>
    <id>http://yoursite.com/2021/07/28/memory-alignment/</id>
    <published>2021-07-28T02:48:49.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>嵌入式内存对齐及位运算解析</p><a id="more"></a><h2 id="内存对齐"><a href="#内存对齐" class="headerlink" title="内存对齐"></a>内存对齐</h2><p><a href="https://murphypei.github.io/blog/2020/04/memory-align" target="_blank" rel="noopener">浅谈内存对齐</a><br><a href="https://blog.csdn.net/vector03/article/details/40977679?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-3.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-3.control" target="_blank" rel="noopener">位运算</a><br><a href="https://embeddedartistry.com/blog/2017/02/22/generating-aligned-memory/" target="_blank" rel="noopener">Generating Aligned Memory</a></p><h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p><code>gcc</code> 修饰 <code>__attribute__((aligned(32)))</code></p><h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>各种内存分配算法保证，为了保证内存对齐，<code>malloc</code>时需要申请比所要求的内存大的容量，这样可以<strong>向下</strong>寻找一个保证是对齐大小的整倍数的内存地址</p><p>如果 <code>n</code> 为以2为底的m (m &gt; 0, m = 1, 2, 3, …)次幂指数,当以 <code>n</code> 为对齐边界时,称 <code>n – 1</code> 为该对齐边界的对齐掩码(align mask).</p><pre><code class="c">#define is_align(A, n) ((A) &amp; ((n) - 1) == 0)</code></pre><p>对齐方式：</p><ul><li>上对齐 align up / round up</li><li>下对齐 align down / round down</li></ul><pre><code class="c">#define align_down(A, n) ((A) &amp; ~((n) - 1)) # 舍弃对齐低位#define align_up(A, n) (((A) + ((n) - 1)) &amp; !((n) - 1)) # + (n) - 1 跳到下个区间，然后 align down 对齐 </code></pre><p>计算内存对齐偏移量：</p><pre><code class="c">#define align_offset(A, n) (((A) &amp; ((n) - 1) == 0) ? 0 : \   ((n) - (A) &amp; ((n) - 1)) &amp; ((n) - 1)) </code></pre><p><strong>DLMalloc</strong></p><pre><code class="c">/* The bit mask value corresponding to MALLOC_ALIGNMENT */#define CHUNK_ALIGN_MASK    (MALLOC_ALIGNMENT - SIZE_T_ONE)/* True if address a has acceptable alignment */#define is_aligned(A)       (((size_t)((A)) &amp; (CHUNK_ALIGN_MASK)) == 0)/* the number of bytes to offset an address to align it */#define align_offset(A)\ ((((size_t)(A) &amp; CHUNK_ALIGN_MASK) == 0)? 0 :\  ((MALLOC_ALIGNMENT - ((size_t)(A) &amp; CHUNK_ALIGN_MASK)) &amp; CHUNK_ALIGN_MASK))</code></pre><p>最后一步 <code>&amp; CHUNK_ALIGN_MASK</code> 是多余的</p><p><strong>TLSF</strong></p><pre><code class="c">#define BLOCK_ALIGN (sizeof(void *) * 2)#define MEM_ALIGN         ((BLOCK_ALIGN) - 1)#define ROUNDUP_SIZE(_r)          (((_r) + MEM_ALIGN) &amp; ~MEM_ALIGN)#define ROUNDDOWN_SIZE(_r)        ((_r) &amp; ~MEM_ALIGN)size = (size &lt; MIN_BLOCK_SIZE) ? MIN_BLOCK_SIZE : ROUNDUP_SIZE(size);</code></pre><blockquote><p>malloc内存对齐实现</p></blockquote><ul><li>计算申请内存大小：ori_size + 控制块 + alignment</li><li>申请内存</li><li>align down获取内存对齐首地址</li></ul><h2 id="结构体对齐"><a href="#结构体对齐" class="headerlink" title="结构体对齐"></a>结构体对齐</h2><h3 id="不存在-pragma-pack"><a href="#不存在-pragma-pack" class="headerlink" title="不存在 #pragma pack"></a>不存在 <code>#pragma pack</code></h3><ol><li>第一个成员的首地址为0</li><li>每个成员的首地址是自身大小的整数倍</li><li>结构体的总大小，为其成员中所含最大类型的整数倍</li></ol><pre><code class="c">struct test{  char a;   //1 + p1  short b;  //2  char c;   //1 + p1};struct test{  char a;   //1 + p3  int  b;   //4  short c;  //2 + p2};</code></pre><h3 id="存在-pragma-pack"><a href="#存在-pragma-pack" class="headerlink" title="存在 #pragma pack"></a>存在 <code>#pragma pack</code></h3><blockquote><p>按照这个宏声明的和实际数据类型中最大值较小的那个来决定</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嵌入式内存对齐及位运算解析&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Memory" scheme="http://yoursite.com/categories/C/Memory/"/>
    
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="memory" scheme="http://yoursite.com/tags/memory/"/>
    
      <category term="tlsf" scheme="http://yoursite.com/tags/tlsf/"/>
    
      <category term="align" scheme="http://yoursite.com/tags/align/"/>
    
      <category term="dlmalloc" scheme="http://yoursite.com/tags/dlmalloc/"/>
    
  </entry>
  
  <entry>
    <title>优化 c 程序可执行文件大小</title>
    <link href="http://yoursite.com/2021/07/13/how-to-make-smaller-c-binaries/"/>
    <id>http://yoursite.com/2021/07/13/how-to-make-smaller-c-binaries/</id>
    <published>2021-07-13T07:31:03.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>优化 elf 大小的各种方式</p><a id="more"></a><h2 id="编译优化等级"><a href="#编译优化等级" class="headerlink" title="编译优化等级"></a>编译优化等级</h2><ul><li><code>-O0</code> 默认</li><li><code>-O1</code></li><li><code>-O2</code></li><li><code>-O3</code></li><li><code>-Ofast</code></li><li><code>Os</code></li></ul><p>应该使用 <code>-Os</code> 来保证编译的 elf 最小，禁用了类似 <code>inline</code> 之类的编译优化选项，同时对性能敏感的代码使用 <code>#pragma</code> 来保证</p><pre><code class="c">#pragma GCC push_options#pragma GCC optimize (&quot;O2&quot;)/* * Code that needs optimizing O2 */#pragma GCC pop_options</code></pre><h2 id="Linker-Garbage-Collection"><a href="#Linker-Garbage-Collection" class="headerlink" title="Linker Garbage Collection"></a>Linker Garbage Collection</h2><p>将不使用的 <code>function</code>、<code>data</code> 从 elf 中删除</p><pre><code class="makefile">CFLAGS += -ffunction-sections -fdata-sectionsLDFLAGS += -Wl,--gc-sections</code></pre><p><strong>需要避免某些符号被优化掉，例如中断向量，使用 KEEP</strong></p><pre><code class="ld">    .text :    {        KEEP(*(.vectors .vectors.*))            [...]    } &gt; rom</code></pre><h2 id="strip-elf"><a href="#strip-elf" class="headerlink" title="strip elf"></a>strip elf</h2><p>去除非必要段</p><pre><code class="shell">$ objcopy -S -g out.elf$ strip -S --strip-unneeded --remove-section=.note.gnu.gold-version --remove-section=.comment --remove-section=.note --remove-section=.note.gnu.build-id --remove-section=.note.ABI-tag</code></pre><ul><li>Remove all symbol and relocation information</li><li>Remove all debugging symbols &amp; sections</li><li>Remove all symbols not needed by relocations</li></ul><h2 id="m32"><a href="#m32" class="headerlink" title="-m32"></a><code>-m32</code></h2><p>Use <code>-m32</code> to compile a 32-bit binary. 32-bit binaries are smaller than 64-bit binaries because pointers are shorter.</p><h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><ul><li><code>-fno-stack-protector</code></li><li><code>-fomit-frame-pointer</code></li><li><code>-fno-math-errno</code>, and don’t check the errno after calling math functions.</li><li>Try <code>-fno-unroll-loops</code>, sometimes it makes the file smaller.</li><li><code>-fmerge-all-constants</code></li><li><code>-fno-ident</code>, this will prevent the generation of the .ident assembler directive, which adds an identification of the compiler to the binary.</li><li><code>-mfpmath=387</code> <code>-mfancy-math-387</code> to make floating point computations shorter.</li><li>If you don’t need double precision, but float preecision is enough, use -fshort-double -fsingle-precision-constant .</li><li>If you don’t need IEEE-conformat floating point calculations, use -ffast-math .</li><li>Use -Wl,-z,norelro for linking, which is equivalent to ld -z norelro .</li><li>Use -Wl,–hash-style=gnu for linking, which is equivalent to ld –hash-style=gnu . You may also try =sysv instead of =gnu, sometimes it’s smaller by a couple of bytes. The goal here is to avoid =both, which is the default on some systems.</li><li>Use -Wl,–build-id=none for linking, which is equivalent to ld –build-id=none .</li><li>Get more flags from the Os list in diet.c of diet libc, for about 15 architectures.</li><li>Don’t use these flags: -pie, -fpie, -fPIE, -fpic, -fPIC. Some of these are useful in shared libraries, so enable them only when compiling shared libraries.</li></ul><h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><ul><li>use <code>-fno-exceptions</code> if your code doesn’t use exceptions.</li><li>use <code>-fno-rtti</code> if your code doesn’t use RTTI (run-time type identification) or dynamic_cast.</li><li>use <code>-fvtable-gc</code> to let the linker know about and remove unused virtual method tables.</li></ul><h2 id="i386"><a href="#i386" class="headerlink" title="i386"></a>i386</h2><ul><li>use -mpreferred-stack-boundary=2 .</li><li>use -falign-functions=1 -falign-jumps=1 -falign-loops=1 .</li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://ptspts.blogspot.com/2013/12/how-to-make-smaller-c-and-c-binaries.html" target="_blank" rel="noopener"><strong>How to make smaller C and C++ binaries</strong></a></li><li><a href="https://interrupt.memfault.com/blog/code-size-optimization-gcc-flags" target="_blank" rel="noopener">Code Size Optimization: GCC Compiler Flags</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;优化 elf 大小的各种方式&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="GCC" scheme="http://yoursite.com/categories/C/GCC/"/>
    
    
      <category term="gcc" scheme="http://yoursite.com/tags/gcc/"/>
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="elf" scheme="http://yoursite.com/tags/elf/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu20.04 ssl 导致 svn update失败</title>
    <link href="http://yoursite.com/2021/06/07/ubuntu-20-04-svn-update-error/"/>
    <id>http://yoursite.com/2021/06/07/ubuntu-20-04-svn-update-error/</id>
    <published>2021-06-07T05:57:57.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>升级 <code>ubuntu 20.04</code> 后 <code>svn update</code> 失败</p><pre><code>svn: E170013: Unable to connect to a repository at URL &#39;https://svn.xxx.comsvn: E120171: Error running context: An error occurred during SSL communication</code></pre><a id="more"></a><p>使用 <code>curl -v</code> 检查如下</p><pre><code class="shell">curl -v https://svn.xxx.com*   Trying 192.168.0.254:443...* TCP_NODELAY set* Connected to svn.xxx.com (192.168.0.254) port 443 (#0)* ALPN, offering h2* ALPN, offering http/1.1* successfully set certificate verify locations:*   CAfile: /etc/ssl/certs/ca-certificates.crt  CApath: /etc/ssl/certs* TLSv1.3 (OUT), TLS handshake, Client hello (1):* TLSv1.3 (IN), TLS handshake, Server hello (2):* TLSv1.2 (IN), TLS handshake, Certificate (11):* TLSv1.2 (OUT), TLS alert, bad certificate (554):* SSL certificate problem: EE certificate key too weak* Closing connection 0curl: (60) SSL certificate problem: EE certificate key too weakMore details here: https://curl.haxx.se/docs/sslcerts.html</code></pre><p><a href="https://www.cnblogs.com/milton/p/12831113.html" target="_blank" rel="noopener">Ubuntu 20.04 出现 SSL_connect: error:1425F102 .. unsupported protocol问题的解决</a></p><p><code>ubuntu 20.04</code> 将 <code>TLS</code> 最低版本设置为 <code>1.2</code>，从而导致认证失败<br>修改<code>/etc/ssl/openssl.cnf</code>，在 <code>oid_section = new_oids</code>下增加</p><pre><code>openssl_conf = default_conf[default_conf]ssl_conf = ssl_sect[ssl_sect]system_default = system_default_sect[system_default_sect]MinProtocol = TLSv1.1CipherString = DEFAULT@SECLEVEL=1</code></pre><p>重新测试如下</p><pre><code class="shell">$ curl -v https://svn.xxx.com*   Trying 192.168.0.254:443...* TCP_NODELAY set* Connected to svn.xxx.com (192.168.0.254) port 443 (#0)* ALPN, offering h2* ALPN, offering http/1.1* successfully set certificate verify locations:*   CAfile: /etc/ssl/certs/ca-certificates.crt  CApath: /etc/ssl/certs* TLSv1.3 (OUT), TLS handshake, Client hello (1):* TLSv1.3 (IN), TLS handshake, Server hello (2):* TLSv1.2 (IN), TLS handshake, Certificate (11):* TLSv1.2 (OUT), TLS alert, unknown CA (560):* SSL certificate problem: self signed certificate* Closing connection 0curl: (60) SSL certificate problem: self signed certificateMore details here: https://curl.haxx.se/docs/sslcerts.html</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;升级 &lt;code&gt;ubuntu 20.04&lt;/code&gt; 后 &lt;code&gt;svn update&lt;/code&gt; 失败&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;svn: E170013: Unable to connect to a repository at URL &amp;#39;https://svn.xxx.com
svn: E120171: Error running context: An error occurred during SSL communication&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="ubuntu" scheme="http://yoursite.com/categories/ubuntu/"/>
    
    
      <category term="ssl" scheme="http://yoursite.com/tags/ssl/"/>
    
      <category term="svn" scheme="http://yoursite.com/tags/svn/"/>
    
  </entry>
  
  <entry>
    <title>DVB PSI/SI 组成</title>
    <link href="http://yoursite.com/2021/06/03/dvb-psi-si/"/>
    <id>http://yoursite.com/2021/06/03/dvb-psi-si/</id>
    <published>2021-06-03T06:44:29.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>DVB PSI 基础知识</p><a id="more"></a><h2 id="PSI-SI关键词"><a href="#PSI-SI关键词" class="headerlink" title="PSI/SI关键词"></a>PSI/SI关键词</h2><table><thead><tr><th align="center">序号</th><th align="center">关键字</th><th align="center">全拼</th><th align="center">翻译</th><th align="left">备注</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">PSI</td><td align="center">Program Specific Information</td><td align="center">节目引导信息</td><td align="left">对单一码流的描述</td></tr><tr><td align="center">2</td><td align="center">SI</td><td align="center">Service Information</td><td align="center">业务信息</td><td align="left">对系统中所有码流的描述，包含了PSI（PSI+9张表）</td></tr><tr><td align="center">3</td><td align="center">TS包</td><td align="center">Transport Packet</td><td align="center">传输包</td><td align="left">数字视音频、图文数据打包成TS包</td></tr><tr><td align="center">4</td><td align="center">TS</td><td align="center">Transport Stream</td><td align="center">传输流（TS流）</td><td align="left">一个频道（多个节目及业务）的TS包复用后称TS流</td></tr><tr><td align="center">5</td><td align="center">PAT</td><td align="center">Program Association Table</td><td align="center">节目关联表</td><td align="left">将节目号码和节目映射表PID相关联，获取数据的开始</td></tr><tr><td align="center">6</td><td align="center">PMT</td><td align="center">Program Map Table</td><td align="center">节目映射表</td><td align="left">指定一个或多个节目的PID</td></tr><tr><td align="center">7</td><td align="center">CAT</td><td align="center">Conditional Access Table</td><td align="center">条件接收表</td><td align="left">将一个或多个专用EMM流分别与唯一的PID相关联</td></tr><tr><td align="center">8</td><td align="center">NIT</td><td align="center">Network Information Table</td><td align="center">网络信息表</td><td align="left">描述整个网络，如多少TS流、频点和调制方式等信息</td></tr><tr><td align="center">9</td><td align="center">SDT</td><td align="center">Service Description Table</td><td align="center"><strong>业务</strong>描述表</td><td align="left">包含业务数据（如业务名称、起始时间、持续时间等）</td></tr><tr><td align="center">10</td><td align="center">BAT</td><td align="center">Bouquet Association Table</td><td align="center">业务群关联表</td><td align="left">给出业务群的名称及其业务列表等信息</td></tr><tr><td align="center">11</td><td align="center">EIT</td><td align="center">Event Information Table</td><td align="center"><strong>事件</strong>信息表</td><td align="left">包含事件或节目相关数据，是生成EPG的主要表</td></tr><tr><td align="center">12</td><td align="center">RST</td><td align="center">Running Status Table</td><td align="center">运行状态表</td><td align="left">给出事件的状态（运行/非运行）</td></tr><tr><td align="center">13</td><td align="center">TDT</td><td align="center">Time&amp;Date Table</td><td align="center">时间和日期表</td><td align="left">给出当前事件和日期相关信息，更新频繁</td></tr><tr><td align="center">14</td><td align="center">TOT</td><td align="center">Time Offset Table</td><td align="center">时间偏移表</td><td align="left">给出了当前时间日期与本地时间偏移的信息</td></tr><tr><td align="center">15</td><td align="center">ST</td><td align="center">Stuffing Table</td><td align="center">填充表</td><td align="left">用于使现有的段无效，如在一个传输系统的边界</td></tr><tr><td align="center">16</td><td align="center">SIT</td><td align="center">Stuffing Information Table</td><td align="center">选择信息表</td><td align="left">仅用于码流片段中，如记录的一段码流，包含描述该码流片段业务信息段的地方</td></tr><tr><td align="center">17</td><td align="center">DIT</td><td align="center">Discontinuity Information Table</td><td align="center">间断信息表</td><td align="left">仅用于码流片段，如记录的一段码流中，它将插入到码流片段业务信息间断的地方</td></tr></tbody></table><blockquote><ul><li><code>PAT</code>,<code>PMT</code>,<code>CAT</code>,<code>NIT</code>为<strong>PSI信息</strong>,由<strong>MPEG2标准</strong>定义,NIT是由<strong>SI标准</strong>规定</li><li><code>SDT</code>,<code>BAT</code>,<code>EIT</code>,<code>RST</code>,<code>TDT</code>,<code>TOT</code>,<code>ST</code>,<code>SIT</code>,<code>DIT</code>为<strong>SI信息</strong></li></ul></blockquote><h2 id="业务-Service-与事件-Event"><a href="#业务-Service-与事件-Event" class="headerlink" title="业务(Service)与事件(Event)"></a>业务(Service)与事件(Event)</h2><p><code>业务</code>就是指“频道”，<code>事件</code>就是“节目”.</p><blockquote><p>举个例子：CCTV1是一个频道，也就是我们所说的“业务（Service）”；《新闻联播》是一个节目，也就是我们所说的“事件(Event)”。</p></blockquote><h2 id="SI信息的构成"><a href="#SI信息的构成" class="headerlink" title="SI信息的构成"></a>SI信息的构成</h2><blockquote><p>SI信息内容是按照 <code>network(网络)</code> -&gt; <code>transport strem（传输流）</code> -&gt; <code>service（业务）</code> -&gt; <code>event（事件）</code>的分层顺序描述</p></blockquote><p><img src="/images/dvb/psisi.png" alt=""></p><p>为了能有效地从众多的数据包中组织起SI信息，而使用了很多的标识。有Network_id(网络标识)、 Original_network_id(原始网络标识)、Transport_stream_id(传输流标识)、Service id(业务标识)、eventid_id(事件标识)、Bouquet_id(业务群组标识)。</p><ul><li>一个网络信息由network_id来定位。</li><li>一个TS由network_id、Original_network_id、Transport_stream_id来定位，标明这个流在那个网络播发，它原属那个网络，并给它加上标识。</li><li>一个业务由network_id、Original_network_id、Transport_stream_id、service_id来定位，标明这个业务在那个网络播发，它原属那个网络和那个流，并给它加上标识。这体现在SDT表中。</li><li>一个事件由network_id、Original_network_id、Transport_stream_id、service_id、event_id来定位，标明这个事件在那个网络播发，它原属那个网络和那个流及那个业务，并给它加上标识。这体现在EIT表中。</li></ul><h3 id="SI和SI信息的各种表的PID"><a href="#SI和SI信息的各种表的PID" class="headerlink" title="SI和SI信息的各种表的PID"></a>SI和SI信息的各种表的PID</h3><table><thead><tr><th align="center">Table</th><th align="center">PID</th></tr></thead><tbody><tr><td align="center">PAT</td><td align="center">0x0000</td></tr><tr><td align="center">CAT</td><td align="center">0x0001</td></tr><tr><td align="center">TSDT</td><td align="center">0x0002</td></tr><tr><td align="center">NIT,ST</td><td align="center">0x0010</td></tr><tr><td align="center">SDT,BAT,ST</td><td align="center">0x0011</td></tr><tr><td align="center">EIT,ST</td><td align="center">0x0012</td></tr><tr><td align="center">RST,ST</td><td align="center">0x0013</td></tr><tr><td align="center">TDT,TOT,ST</td><td align="center">0x0014</td></tr><tr><td align="center">DIT</td><td align="center">0x001E</td></tr><tr><td align="center">SIT</td><td align="center">0x001F</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;DVB PSI 基础知识&lt;/p&gt;
    
    </summary>
    
      <category term="DVB" scheme="http://yoursite.com/categories/DVB/"/>
    
    
      <category term="dvb" scheme="http://yoursite.com/tags/dvb/"/>
    
      <category term="psi" scheme="http://yoursite.com/tags/psi/"/>
    
      <category term="si" scheme="http://yoursite.com/tags/si/"/>
    
  </entry>
  
  <entry>
    <title>jenkins-shell-echo-off</title>
    <link href="http://yoursite.com/2021/04/19/jenkins-shell-echo-off/"/>
    <id>http://yoursite.com/2021/04/19/jenkins-shell-echo-off/</id>
    <published>2021-04-19T02:24:11.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>Problem:</p><pre><code class="shell"># jenkins shell08:06:57 + export KEYPWD=secretPwd08:06:57 + KEYPWD=secretPwd</code></pre><p>原因：</p><blockquote><p>By default, Jenkins launches Execute Shell script with set -x. This causes all commands to be echoed</p></blockquote><pre><code class="shell">$ man bash    -x        Print commands and their arguments as they are executed.</code></pre><p>解决方案：</p><pre><code class="shell">#!/bin/bash +x</code></pre><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Problem:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt;# jenkins shell
08:06:57 + export KEYPWD=secretPwd
08:06:57 + KEYPWD=secretPwd&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;原因：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By default, Jenkins launches Execute Shell script with set -x. This causes all commands to be echoed&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt;$ man bash
    -x        Print commands and their arguments as they are executed.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;解决方案：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt;#!/bin/bash +x&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="CI" scheme="http://yoursite.com/categories/Tools/CI/"/>
    
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="jenkins" scheme="http://yoursite.com/tags/jenkins/"/>
    
      <category term="ci" scheme="http://yoursite.com/tags/ci/"/>
    
  </entry>
  
  <entry>
    <title>ssh 升级导致 git clone 失败</title>
    <link href="http://yoursite.com/2021/03/18/ssh-unable-to-negotiate/"/>
    <id>http://yoursite.com/2021/03/18/ssh-unable-to-negotiate/</id>
    <published>2021-03-18T06:23:28.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>错误信息</p><pre><code>Unable to negotiate with 192.168.110.254 port 29418: no matching key exchange method found. Their offer: diffie-hellman-group14-sha1,diffie-hellman-group1-sha1</code></pre><a id="more"></a><p><a href="https://unix.stackexchange.com/questions/402746/ssh-unable-to-negotiate-no-matching-key-exchange-method-found" target="_blank" rel="noopener">ssh unable to negotiate - no matching key exchange method found</a><br><a href="https://mycyberuniverse.com/error/no-matching-key-exchange-method-found-openssh7.html" target="_blank" rel="noopener">How to fix: No matching key exchange method found by OpenSSH 7.0</a></p><p>新老版本兼容性问题，需要增加对老旧算法支持</p><ul><li><code>~/.ssh/config</code><pre><code class="config">Host somehost.example.org  KexAlgorithms +diffie-hellman-group1-sha1</code></pre></li><li><code>/etc/ssh/ssh_config</code><pre><code class="config">Host somehost.example.org  KexAlgorithms +diffie-hellman-group1-sha1</code></pre></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;错误信息&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Unable to negotiate with 192.168.110.254 port 29418: no matching key exchange method found. Their offer: diffie-hellman-group14-sha1,diffie-hellman-group1-sha1&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="ubuntu" scheme="http://yoursite.com/categories/ubuntu/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
      <category term="ubuntu" scheme="http://yoursite.com/tags/ubuntu/"/>
    
      <category term="ssh" scheme="http://yoursite.com/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>fork safety 以及多线程环境下注意事项</title>
    <link href="http://yoursite.com/2021/01/15/fork-safe/"/>
    <id>http://yoursite.com/2021/01/15/fork-safe/</id>
    <published>2021-01-15T02:07:57.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>多线程下进程安全及 fork 使用注意事项</p><blockquote><p>非进程安全容易导致死锁<br>未考虑 fork 时文件的处理 <code>fcntl(fd, F_SETFD, FD_CLOEXEC)</code></p></blockquote><a id="more"></a><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul><li>Reentrant Function 可重入函数</li><li>Thread-Safe Function 线程安全函数</li><li>signal-safety - async-signal-safe functions 异步信号安全函数</li></ul><h2 id="fork-amp-fork-safety-amp-signal-safety"><a href="#fork-amp-fork-safety-amp-signal-safety" class="headerlink" title="fork &amp; fork safety &amp; signal-safety"></a>fork &amp; fork safety &amp; signal-safety</h2><pre><code class="shell">$ man fork    Note the following further points:    *  The child process is created with a single thread—the one that called fork().  The entire virtual address space of the  parent  is  repli‐        cated  in the child, including the states of mutexes, condition variables, and other pthreads objects; the use of pthread_atfork(3) may be        helpful for dealing with problems that this can cause.    *  After a fork() in a multithreaded program, the child can safely call only async-signal-safe functions (see  signal-safety(7))  until  such        time as it calls execve(2).</code></pre><ul><li><strong>只复制了父进程中当前线程到子进程</strong>，如果父进程是多线程，那个其他线程在子进程中消失</li><li>子进程得到父进程拷贝，包括互斥锁、条件变量…，这会导致死锁，是问题的根源</li><li><strong>互斥锁，就是多线程fork大部分问题的关键部分</strong></li><li>可以使用 <code>pthread_atfork</code> 处理部分问题，例外如<strong>库函数不受控制</strong>，还需要考虑锁的顺序，在大型程序中无实用价值</li><li><code>fork</code> 后，在执行 <code>execve</code> 前，只能调用 <code>async-signal-safe functions</code>，其他函数都有风险</li></ul><p>死锁模型如下：<br><img src="/images/linux/fork-deadlock.png" alt=""></p><ul><li>T1 持有锁</li><li>T2 <code>fork</code> 后，子进程中只存在 T2 线程，获取不到锁导致死锁</li><li><code>pthread_atfork</code> 只能解决简单模型</li><li><code>fork</code> 之后，<code>execve</code> 之前，只能调用 <code>async-signal-safe functions</code></li><li><code>libc</code> 中很多函数都使用锁，而且不是 <code>async-signal-safe functions</code>，例如 <code>malloc/free</code></li><li><code>fork</code> 之后，<code>execve</code>之前，使用内存分配函数存在风险</li><li><code>execve</code> 后会重置所有进程状态，之前线程获取的锁会直接被销毁</li></ul><p>查看 <code>async-signal-safe functions</code> 列表：</p><pre><code class="shell">$ man signal-safety</code></pre><h2 id="uclibc-amp-glibc"><a href="#uclibc-amp-glibc" class="headerlink" title="uclibc &amp; glibc"></a>uclibc &amp; glibc</h2><ul><li><a href="https://wiki.strongswan.org/issues/990" target="_blank" rel="noopener">unsafe use of malloc after fork</a></li><li><code>glibc</code> 中 <code>malloc</code> 不存在问题<blockquote><p>malloc/malloc.c (malloc_atfork, free_atfork): Remove<br>Remove malloc hooks from fork handler.  They are no longer needed because malloc runs right before fork, and no malloc calls from other fork handlers are not possible anymore.</p></blockquote></li><li><code>uclibc</code> 中 <code>malloc</code> 存在问题</li></ul><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ul><li><code>fork</code> 后立即调用 <code>execve</code>，两者之间只允许调用 <code>async-signal-safe functions</code></li><li>在程序启动其他线程前 <code>fork</code> 子进程，需要考虑 <code>C++</code> 静态构造函数</li><li>在多线程中避免使用 <code>fork</code>，使用 <code>pthread_create</code> 代替</li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="http://timd.cn/fork-safety-and-thread-safety/" target="_blank" rel="noopener">fork-safe和thread-safe简介</a></li><li><a href="https://blog.kghost.info/2013/04/27/fork-multi-thread/" target="_blank" rel="noopener">多线程程序中使用 Fork/Exec</a></li><li><a href="https://www.cnblogs.com/liyuan989/p/4279210.html" target="_blank" rel="noopener">谨慎使用多线程中的fork</a></li><li><a href="https://www.evanjones.ca/fork-is-dangerous.html" target="_blank" rel="noopener">fork() without exec() is dangerous in large programs</a></li><li><a href="https://my.oschina.net/lowkey2046/blog/672450" target="_blank" rel="noopener">多线程程序里不准使用fork</a></li><li><a href="https://docs.oracle.com/cd/E19253-01/819-7051/6n919hpaq/index.html" target="_blank" rel="noopener">进程创建中的 fork 问题</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;多线程下进程安全及 fork 使用注意事项&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;非进程安全容易导致死锁&lt;br&gt;未考虑 fork 时文件的处理 &lt;code&gt;fcntl(fd, F_SETFD, FD_CLOEXEC)&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
      <category term="Fork" scheme="http://yoursite.com/categories/Linux/Fork/"/>
    
    
      <category term="malloc" scheme="http://yoursite.com/tags/malloc/"/>
    
      <category term="fork" scheme="http://yoursite.com/tags/fork/"/>
    
      <category term="multithread" scheme="http://yoursite.com/tags/multithread/"/>
    
      <category term="fork safety" scheme="http://yoursite.com/tags/fork-safety/"/>
    
  </entry>
  
  <entry>
    <title>Using Git with Multiple Email Addresses</title>
    <link href="http://yoursite.com/2020/11/24/config-git-with-multi-email-address/"/>
    <id>http://yoursite.com/2020/11/24/config-git-with-multi-email-address/</id>
    <published>2020-11-24T02:48:08.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>配置不同项目组下不同用户名</p><a id="more"></a><h2 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a><code>git config</code></h2><p>使用 <code>git config</code> 配置不同项目下用户名和地址</p><ul><li>设置全局默认值<pre><code class="shell">  $ git config --global user.name &quot;userA&quot;  $ git config --global user.email userA@email.com</code></pre></li><li>设置当前工程<pre><code class="shell">  $ git config user.name &quot;userA&quot;  $ git config user.email userA@email.com</code></pre></li></ul><p>繁琐而且新开工程容易遗漏</p><h2 id="gitconfig"><a href="#gitconfig" class="headerlink" title=".gitconfig"></a><code>.gitconfig</code></h2><p><a href="https://git-scm.com/docs/git-config#_conditional_includes" target="_blank" rel="noopener">git-config Conditional includes</a></p><p>按照工程路径配置不同的用户名，规划好根目录之后可以方便管理</p><pre><code class=".gitconfig">[user]    name = John Doe    email = john@doe.tld[includeIf &quot;gitdir:~/work/&quot;]    path = ~/work/.gitconfig</code></pre><p>在目录 <code>~/work</code> 下新建 <code>.gitconfig</code></p><pre><code class=".gitconfig">[user]    name = John DoeA    email = john.doe@company.tld</code></pre><p>也可以放在当前目录</p><pre><code class=".gitconfig">[includeIf &quot;gitdir:github/&quot;]    path = .gitconfig-github[includeIf &quot;gitdir:work/&quot;]    path = .gitconfig-work</code></pre><p>在 <code>~/.gitconfig-github</code> 和 <code>.gitconfig-work</code> 中分配配置 <code>GitHub</code> 和 <code>work</code> 用户名和邮件</p><blockquote><p>文件 <code>~/.gitconfig</code> 里面的 includeIf 后面的 path 最后需要 <code>/</code> 结尾<br>文件 <code>~/.gitconfig</code> 里面原有的 user 部分需要删除，注释的话开头用 <code>#</code><br>工程目录不能是包含关系</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;配置不同项目组下不同用户名&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Git" scheme="http://yoursite.com/categories/Tools/Git/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>time() 与 gettimeofday()</title>
    <link href="http://yoursite.com/2020/11/16/time-and-gettimeofday/"/>
    <id>http://yoursite.com/2020/11/16/time-and-gettimeofday/</id>
    <published>2020-11-16T06:40:44.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>eCos 系统下发现 <code>pthread_cond_timedwait</code> 超时失败，会立刻返回</p><a id="more"></a><h2 id="pthread-cond-timedwait"><a href="#pthread-cond-timedwait" class="headerlink" title="pthread_cond_timedwait"></a>pthread_cond_timedwait</h2><p>根据 <code>timeout</code> 和 <code>condition</code> 阻塞线程</p><ul><li>0: 正常情况，获取 <code>condition</code></li><li>ETIMEDOUT: 超时</li></ul><p>异常时设置超时会直接退出</p><h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><blockquote><p>This function returns the time since 00:00:00 UTC, January 1, 1970 (Unix timestamp) in seconds.</p></blockquote><p><code>time()</code> 在 eCos 下最终是调用栈如下</p><ul><li><code>Cyg_WallClock::wallclock-&gt;get_current_time()</code></li><li><code>get_hw_seconds()</code></li><li><code>get_ds_hwclock()</code></li><li><code>gx_rtc_time_read()</code></li></ul><p>在此函数中强制转换出现问题，解决之后 <code>pthread_cond_timedwait</code> 正常</p><h2 id="gettimeofday"><a href="#gettimeofday" class="headerlink" title="gettimeofday"></a>gettimeofday</h2><p>可以得到更加精确的时间，精确到毫秒</p><p><code>gettimeofday()</code> 定义在 <code>ecos3.0/packages/compat/posix/v3_0/src/time.cxx</code>，调用栈</p><ul><li><code>cyg_current_time()</code></li><li><code>Cyg_Clock::real_time_clock-&gt;current_value()</code></li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://stackoverflow.com/questions/46018295/pthread-cond-timedwait-returns-etimedout-immediately" target="_blank" rel="noopener">pthread_cond_timedwait returns ETIMEDOUT immediately</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;eCos 系统下发现 &lt;code&gt;pthread_cond_timedwait&lt;/code&gt; 超时失败，会立刻返回&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="eCos" scheme="http://yoursite.com/categories/eCos/"/>
    
      <category term="Functions" scheme="http://yoursite.com/categories/C/Functions/"/>
    
    
      <category term="time" scheme="http://yoursite.com/tags/time/"/>
    
      <category term="eCos" scheme="http://yoursite.com/tags/eCos/"/>
    
      <category term="gettimeofday" scheme="http://yoursite.com/tags/gettimeofday/"/>
    
  </entry>
  
  <entry>
    <title>x96maxplus</title>
    <link href="http://yoursite.com/2020/11/05/x96maxplus/"/>
    <id>http://yoursite.com/2020/11/05/x96maxplus/</id>
    <published>2020-11-05T05:11:44.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>X96MAX+ 折腾记录</p><ul><li>ATV + CoreELEC</li><li>OpenWrt</li></ul><a id="more"></a><h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><ul><li>ATV + CoreELEC<ul><li><a href="http://www.tvboxfactory.com/index.php?m=home&c=View&a=index&aid=108" target="_blank" rel="noopener">ATV固件，S905X2,和S905X3芯片通用的-X96 MAX机器固件</a></li><li><a href="https://chinagadgetsreviews.com/download-android-pie-9-0-firmware-for-x96-max-plus2-tv-box-2.html" target="_blank" rel="noopener">Download Android Pie 9.0 firmware for X96 Max Plus2 TV Box</a></li><li><a href="https://post.smzdm.com/p/a99v2q35/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（一）：红外遥控开关机与VFD屏幕显示</a></li><li><a href="https://post.smzdm.com/p/alpw279e/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（二）：emmc双系统+ 流光溢彩</a></li><li><a href="https://post.smzdm.com/p/aeke4xm4/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（三）AndroidTV刷机记录</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=972364" target="_blank" rel="noopener">4PDA X96max+</a></li><li><a href="https://www.getdroidtips.com/stock-firmware-x96-max-plus-tv-box/#Instructions-to-Install" target="_blank" rel="noopener">How to Install Stock Firmware on X96 Max Plus TV Box [Android 9.0]</a></li><li><a href="https://gitee.com/s0xff/CoreELEC_Test/tree/master" target="_blank" rel="noopener">CoreELEC_Test</a></li><li><a href="https://www.rosnas.com/1645.html" target="_blank" rel="noopener">x96 max+外贸盒子改散热,刷ATV,CoreELEC系统</a></li><li><a href="https://www.znds.com/tv-1182718-1-4.html" target="_blank" rel="noopener">聊一聊最近一周折腾刷机，几个固件的一点使用感受</a></li><li><a href="https://forum.freaktab.com/forum/tv-player-support/amlogic-based-tv-players/s905x3/firmware-roms-tools-ds" target="_blank" rel="noopener">FIRMWARE - ROMS - TOOLS</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=1002233&st=40" target="_blank" rel="noopener">固件</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=1002233&st=2880#entry100655364" target="_blank" rel="noopener">Turbo 固件系列</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=993324" target="_blank" rel="noopener">SLIMBOX</a></li><li><a href="https://www.bilibili.com/read/cv9065539/" target="_blank" rel="noopener">X96 Max+ 卡刷 SlimBOX，使用原生的ATV</a></li></ul></li><li>EmuELEC<ul><li><a href="https://club.tgfcer.com/thread-8299561-1-1.html" target="_blank" rel="noopener">X96max+盒子 EmuELEC 加装CoreELEC系统</a></li><li><a href="https://www.jianshu.com/p/67ac50a28c6b" target="_blank" rel="noopener">x96max+ 电视盒子刷入EmuELEC 变身游戏机</a></li><li><a href="https://post.smzdm.com/p/andlwdgv/" target="_blank" rel="noopener">S905X3盒子x96 air，安装CoreELEC+EmuELEC二合一系统</a></li><li><a href="https://zhuanlan.zhihu.com/p/79783441" target="_blank" rel="noopener">2XX元如何把N1打造成高效能的多平台游戏机</a></li></ul></li><li>OpenWrt<ul><li><a href="https://www.right.com.cn/forum/thread-4055451-1-1.html" target="_blank" rel="noopener">[2020-10-29] 47+O S905x3(含x2)、N1、贝壳云、我家云等OP固件</a></li><li><a href="https://www.right.com.cn/forum/thread-981406-1-1.html" target="_blank" rel="noopener">[N1盒子] [2020-10-18]★46+o版， S905x3、N1、贝壳云、我家云等op固件</a></li></ul></li><li>Recovery<ul><li><a href="https://zhuanlan.zhihu.com/p/293943099" target="_blank" rel="noopener">X96MAX+ S905x3 盒子 刷机救砖教程</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;X96MAX+ 折腾记录&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ATV + CoreELEC&lt;/li&gt;
&lt;li&gt;OpenWrt&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Hacker" scheme="http://yoursite.com/categories/Hacker/"/>
    
      <category term="S905X3" scheme="http://yoursite.com/categories/Hacker/S905X3/"/>
    
    
      <category term="ATV" scheme="http://yoursite.com/tags/ATV/"/>
    
      <category term="CoreELEC" scheme="http://yoursite.com/tags/CoreELEC/"/>
    
  </entry>
  
  <entry>
    <title>ld 选项 -warn-common</title>
    <link href="http://yoursite.com/2020/11/04/ld-warn-common/"/>
    <id>http://yoursite.com/2020/11/04/ld-warn-common/</id>
    <published>2020-11-04T08:28:58.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p><code>-warn-common</code> 选项分析</p><a id="more"></a><h2 id="编译警告"><a href="#编译警告" class="headerlink" title="编译警告"></a>编译警告</h2><pre><code>libtest.a(rmdec.c.o): warning: definition of `sipr_subpk_size&#39; overriding commonlibtest.a(matroskadec.c.o): warning: common is herelibtest.a(rdt.c.o): warning: common of `sipr_subpk_size&#39; overridden by definitionlibtest.a(rmdec.c.o): warning: defined here</code></pre><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul><li><a href="https://stackoverflow.com/questions/2331584/global-variable-implementation" target="_blank" rel="noopener">Global variable implementation</a></li><li><a href="https://stackoverflow.com/questions/11958626/make-file-warning-overriding-commands-for-target" target="_blank" rel="noopener">Make file warning, overriding commands for target</a></li></ul><p>代码编写存在风险</p><ul><li>修改源码，去除编译警告</li><li>去除 <code>-warn-common</code> 不生成编译警告</li></ul><p><a href="https://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html" target="_blank" rel="noopener">Ld Command Line Options</a></p><blockquote><p>Warn when a common symbol is combined with another common symbol or with a symbol definition. Unix linkers allow this somewhat sloppy practice, but linkers on some other operating systems do not. This option allows you to find potential problems from combining global symbols. Unfortunately, some C libraries use this practice, so you may get some warnings about symbols in the libraries as well as in your programs. There are three kinds of global symbols, illustrated here by C examples:</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;-warn-common&lt;/code&gt; 选项分析&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Linker" scheme="http://yoursite.com/categories/C/Linker/"/>
    
    
      <category term="ld" scheme="http://yoursite.com/tags/ld/"/>
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="linker" scheme="http://yoursite.com/tags/linker/"/>
    
  </entry>
  
  <entry>
    <title>Pandoc 定制模板转换 Markdown 为 PDF</title>
    <link href="http://yoursite.com/2020/11/02/customizing-pandoc/"/>
    <id>http://yoursite.com/2020/11/02/customizing-pandoc/</id>
    <published>2020-11-02T06:35:43.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>定制模板控制 <code>Markdown</code> 转换细节</p><a id="more"></a><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p><a href="https://github.com/Wandmalfarbe/pandoc-latex-template.git" target="_blank" rel="noopener">Eisvogel</a></p><p>使用 Metadata 控制</p><h2 id="Pandoc-Filter"><a href="#Pandoc-Filter" class="headerlink" title="Pandoc Filter"></a>Pandoc Filter</h2><p>扩展 <code>Markdown</code></p><ol><li><a href="https://github.com/timofurrer/pandoc-mermaid-filter" target="_blank" rel="noopener">pandoc-mermaid-filter</a></li><li><a href="https://github.com/raghur/mermaid-filter" target="_blank" rel="noopener">mermaid-filter</a></li><li><a href="https://github.com/taqenoqo/pandoc-ditaa-filter" target="_blank" rel="noopener">Pandoc Ditaa Filter</a></li><li><a href="https://github.com/hertogp/imagine" target="_blank" rel="noopener"><strong>Imagine</strong></a></li></ol><p>其中 <code>Imagine</code> 支持如下代码块</p><ul><li>asy</li><li>blockdiag</li><li>boxes</li><li>chartdirector</li><li>ctioga2</li><li>ditaa</li><li>figlet</li><li>flydraw</li><li>gle</li><li>gnuplot</li><li>graphviz</li><li>gri</li><li>inline</li><li>matplotlib</li><li>mermaid</li><li>mscgen</li><li>octave</li><li>plantuml</li><li>ploticus</li><li>plotutils</li><li>protocol</li><li>pygal</li><li>pyxplot</li><li>random</li><li>sample</li><li>wolfram</li></ul><h2 id="Pandoc-控制"><a href="#Pandoc-控制" class="headerlink" title="Pandoc 控制"></a>Pandoc 控制</h2><ul><li>模板即为一组语法集合</li><li>转换为 PDF <code>--pdf-engine=xelatex</code></li><li>使用模板 <code>--template &quot;eisvogel.latex&quot;</code></li></ul><h3 id="支持中文"><a href="#支持中文" class="headerlink" title="支持中文"></a>支持中文</h3><p><code>-V CJKmainfont=&quot;Microsoft YaHei&quot;</code></p><h3 id="高亮"><a href="#高亮" class="headerlink" title="高亮"></a>高亮</h3><ul><li><code>--list-highlight-styles</code></li><li><code>--list-highlight-languages</code></li><li><code>--highlight-style zenburn</code></li></ul><p>定制语法高亮，输出默认并编辑</p><pre><code class="shell">$ pandoc --print-highlight-style=pygments &gt; pygments.theme</code></pre><h3 id="章节编号"><a href="#章节编号" class="headerlink" title="章节编号"></a>章节编号</h3><p><code>--number-sections</code></p><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul><li><code>--toc</code></li><li><code>--toc-depth</code></li><li><code>-V toc-title</code></li></ul><h3 id="链接颜色"><a href="#链接颜色" class="headerlink" title="链接颜色"></a>链接颜色</h3><p><code>-V colorlinks -V urlcolor=NavyBlue</code></p><h3 id="PDF-margin"><a href="#PDF-margin" class="headerlink" title="PDF margin"></a>PDF margin</h3><p><code>-V geometry:&quot;top=2cm, bottom=1.5cm, left=2cm, right=2cm&quot;</code></p><h3 id="设置放入-head-tex"><a href="#设置放入-head-tex" class="headerlink" title="设置放入 head.tex"></a>设置放入 head.tex</h3><p><code>-H --include-in-header=FILE</code></p><h3 id="Chapter-breaks"><a href="#Chapter-breaks" class="headerlink" title="Chapter breaks"></a>Chapter breaks</h3><pre><code class="latex">\usepackage{sectsty}\sectionfont{\clearpage}</code></pre><pre><code class="shell">$ $ pandoc sample_1.md -f gfm -H chapter_break.tex -o sample_1_chapter_break.pdf</code></pre><h3 id="Changing-settings-via-V-option"><a href="#Changing-settings-via-V-option" class="headerlink" title="Changing settings via -V option"></a>Changing settings via -V option</h3><pre><code class="shell">pandoc &quot;$1&quot; \    -f gfm \    --include-in-header chapter_break.tex \    -V linkcolor:blue \    -V geometry:a4paper \    -V geometry:margin=2cm \    -V mainfont=&quot;DejaVu Serif&quot; \    -V monofont=&quot;DejaVu Sans Mono&quot; \    --pdf-engine=xelatex \    -o &quot;$2&quot;</code></pre><ul><li><code>mainfont</code> is for normal text</li><li><code>monofont</code> is for code snippets</li><li><code>geometry</code> for page size and margins</li><li><code>linkcolor</code> to set hyperlink color</li></ul><h3 id="Inline-code"><a href="#Inline-code" class="headerlink" title="Inline code"></a>Inline code</h3><pre><code class="latex">\usepackage{fancyvrb,newverbs,xcolor}\definecolor{Light}{HTML}{F4F4F4}\let\oldtexttt\texttt\renewcommand{\texttt}[1]{  \colorbox{Light}{\oldtexttt{#1}}}</code></pre><p>使用方式<code>--include-in-header inline_code.tex</code></p><h3 id="PDF-properties"><a href="#PDF-properties" class="headerlink" title="PDF properties"></a>PDF properties</h3><pre><code class="latex">\usepackage{hyperref}\hypersetup{  pdftitle={My awesome book},  pdfauthor={learnbyexample},  pdfsubject={pandoc},  pdfkeywords={pandoc,pdf,xelatex}}</code></pre><h3 id="cover-image"><a href="#cover-image" class="headerlink" title="cover image"></a>cover image</h3><pre><code class="latex">\includegraphics{cover.png}\thispagestyle{empty}</code></pre><h3 id="blockquote"><a href="#blockquote" class="headerlink" title="blockquote"></a>blockquote</h3><pre><code class="latex">\usepackage{tcolorbox}\newtcolorbox{myquote}{colback=red!5!white, colframe=red!75!black}\renewenvironment{quote}{\begin{myquote}}{\end{myquote}}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;定制模板控制 &lt;code&gt;Markdown&lt;/code&gt; 转换细节&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="pandoc filter" scheme="http://yoursite.com/tags/pandoc-filter/"/>
    
  </entry>
  
  <entry>
    <title>Markdown 转换为 PDF 文档</title>
    <link href="http://yoursite.com/2020/10/30/convert-markdown-to-pdf/"/>
    <id>http://yoursite.com/2020/10/30/convert-markdown-to-pdf/</id>
    <published>2020-10-30T02:27:58.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>记录将 <code>Markdown</code> 转换为 <code>PDF</code> 过程</p><ul><li>GitBook 整体/部分/单章导出</li><li>Pandoc 导出 </li><li>Typora 导出</li><li>VSCode MPE 导出</li></ul><a id="more"></a><h2 id="GitBook"><a href="#GitBook" class="headerlink" title="GitBook"></a>GitBook</h2><p>支持安装插件以扩展功能，例如：</p><ul><li>flowchart.js</li><li>mermaid.js</li><li>UML绘图</li></ul><p>使用上述插件后，<code>Markdown</code> 在原生基础上做出了扩展，是超集</p><p><code>GitBook</code> 使用命令 <code>gitbook pdf</code> 导出电子书，其目录及内容依赖于比选项 <code>SUMMARY.md</code>。因此导出部分/单章内容时需要修改 <code>SUMMARY.md</code> 以满足需求。导出转换流程 <code>Markdown源码</code> -&gt; <code>HTML资源</code> -&gt; <code>PDF</code>，因此影响 <code>HTML</code> 的相关插件对最终输出效果均有影响。</p><p><code>README.md</code> 为比选项，因此导出单章时需要将内容重命名为 <code>README.md</code> 以避免引入 <code>introduction</code> 章节。</p><h2 id="Pandoc"><a href="#Pandoc" class="headerlink" title="Pandoc"></a>Pandoc</h2><p>使用模板 <a href="https://github.com/Wandmalfarbe/pandoc-latex-template.git" target="_blank" rel="noopener">Eisvogel</a></p><p>在文档中增加元数据</p><pre><code class="markdown">---title: &quot;DSM-CC&quot;author: Breezedate: &quot;2020-02-20&quot;subject: &quot;Markdown&quot;keywords: [Markdown, Example]table-use-row-colors: falsetoc-own-page: trueheader-left: &quot;National&quot;titlepage: true,titlepage-text-color: &quot;000000&quot;titlepage-rule-color: &quot;360049&quot;titlepage-rule-height: 0titlepage-background: &quot;titlepage-background/backgrounds/background1.pdf&quot;logo-width: 120...</code></pre><pre><code class="shell">$ pandoc &quot;index.md&quot; -o &quot;chinese.pdf&quot; --from markdown --template &quot;../eisvogel.latex&quot; --listings --pdf-engine=xelatex -V CJKmainfont=&quot;Microsoft YaHei&quot; --number-sections --toc</code></pre><blockquote><p>如果 Markdown 源码存在扩展会导致这部分输出异常，例如 GitBook 中插件部分扩展。优点是可以方便定制 LaTeX 模板</p></blockquote><p>扩展：</p><ul><li><a href="http://pages.tzengyuxio.me/pandoc/" target="_blank" rel="noopener">Pandoc’s Markdown 語法中文翻譯</a></li><li><a href="https://texblog.org/2011/01/27/add-your-logo-to-the-title-page/" target="_blank" rel="noopener">Title Page 增加 Logo</a></li><li><a href="https://zhuanlan.zhihu.com/p/81704534" target="_blank" rel="noopener">如何使用 Pandoc 和 LaTeX 制作漂亮的 pdf</a></li><li><a href="https://pandoc.org/MANUAL.html#general-options" target="_blank" rel="noopener">Pandoc General options</a></li><li><a href="https://learnbyexample.github.io/customizing-pandoc/" target="_blank" rel="noopener">Customizing pandoc to generate beautiful pdf and epub from markdown</a></li><li><a href="https://gowa.club/macOS/%E4%BD%BF%E7%94%A8pandoc%E8%BD%AC%E6%8D%A2pdf%E4%B8%8Edocx%E5%8A%A0%E4%B8%8A%E4%B9%A6%E7%AD%BE%E7%9B%AE%E5%BD%95.html" target="_blank" rel="noopener">使用pandoc转换pdf与docx加上书签目录</a></li><li><a href="https://yijiebuyi.com/blog/17e31502e8a6229a18971a2499f0e72b.html" target="_blank" rel="noopener">pandoc markdown 生成pdf文档</a></li><li><a href="https://jdhao.github.io/2017/12/10/pandoc-markdown-with-chinese/" target="_blank" rel="noopener">使用 Pandoc 把 Markdown 转为 PDF 文件</a></li><li><a href="http://www.biexiaoyu1994.com/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/2019/10/21/latex_summary/" target="_blank" rel="noopener">LaTex 语法总结</a></li><li><a href="https://www.latextemplates.com/" target="_blank" rel="noopener">LaTeX Templates</a></li><li><a href="https://uoftcoders.github.io/studyGroup/lessons/misc/pandoc-intro/lesson/" target="_blank" rel="noopener">How to use Pandoc and Markdown for writing scientific manuscripts</a></li><li><a href="https://afoo.me/posts/2013-07-10-how-to-transform-chinese-pdf-with-pandoc.html" target="_blank" rel="noopener">pandoc中文pdf转换攻略</a></li></ul><h2 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h2><p>所见即所得，方便本地编辑导出 PDF</p><h2 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h2><p>基于插件 <a href="https://shd101wyy.github.io/markdown-preview-enhanced/#/zh-cn/pandoc-pdf" target="_blank" rel="noopener">MPE Pandoc</a> 本地编辑导出 PDF</p><p>TODOs</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录将 &lt;code&gt;Markdown&lt;/code&gt; 转换为 &lt;code&gt;PDF&lt;/code&gt; 过程&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitBook 整体/部分/单章导出&lt;/li&gt;
&lt;li&gt;Pandoc 导出 &lt;/li&gt;
&lt;li&gt;Typora 导出&lt;/li&gt;
&lt;li&gt;VSCode MPE 导出&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="gitbook" scheme="http://yoursite.com/tags/gitbook/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="texlive" scheme="http://yoursite.com/tags/texlive/"/>
    
  </entry>
  
  <entry>
    <title>BookStack 填坑指南</title>
    <link href="http://yoursite.com/2020/09/29/how-to-install-bookstack/"/>
    <id>http://yoursite.com/2020/09/29/how-to-install-bookstack/</id>
    <published>2020-09-29T02:36:42.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>安装 BookStack 过程中遇到的问题及解决方案</p><a id="more"></a><h2 id="安装指南"><a href="#安装指南" class="headerlink" title="安装指南"></a>安装指南</h2><ol><li><a href="https://www.howtoforge.com/how-to-install-bookstack-on-ubuntu-1804/" target="_blank" rel="noopener">How to Install BookStack on Ubuntu 18.04 LTS</a><ul><li>MariaDB</li></ul></li><li><a href="https://www.bookstackapp.com/docs/admin/installation/#ubuntu-1804" target="_blank" rel="noopener">Ubuntu 18.04 Installation Script</a><ul><li>MySQL</li></ul></li></ol><p>采用 <code>MySQL</code> 管理数据</p><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>执行如下命令失败：</p><pre><code class="shell">mysql -u root --execute=&quot;CREATE DATABASE bookstack;&quot;mysql -u root --execute=&quot;CREATE USER &#39;bookstack&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;$DB_PASS&#39;;&quot;mysql -u root --execute=&quot;GRANT ALL ON bookstack.* TO &#39;bookstack&#39;@&#39;localhost&#39;;FLUSH PRIVILEGES;&quot;</code></pre><p><a href="https://stackoverflow.com/questions/37879448/mysql-fails-on-mysql-error-1524-hy000-plugin-auth-socket-is-not-loaded" target="_blank" rel="noopener">MySQL fails on: mysql “ERROR 1524 (HY000): Plugin ‘auth_socket’ is not loaded”</a></p><ul><li><p>I</p><pre><code class="shell">  $ sudo /etc/init.d/mysql stop # stop mysql service  $ sudo mysqld_safe --skip-grant-tables &amp; # start mysql without password  # enter -&gt; go  $ mysql -uroot # connect to mysql</code></pre></li><li><p>Socket issue: ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘/var/run/mysqld/mysqld.sock’</p><pre><code class="shell">  $ sudo mkdir -p /var/run/mysqld; sudo chown mysql /var/run/mysqld  $ sudo mysqld_safe --skip-grant-tables &amp;</code></pre></li><li><p>run mysql commands =&gt; copy paste this to cli manually</p><pre><code class="mysql">  use mysql; # use mysql table  update user set authentication_string=PASSWORD(&quot;&quot;) where User=&#39;root&#39;; # update password to nothing  update user set plugin=&quot;mysql_native_password&quot; where User=&#39;root&#39;; # set password resolving to default mechanism for root user  flush privileges;  quit;</code></pre></li><li><p>F</p><pre><code class="shell">  $ sudo /etc/init.d/mysql stop  $ sudo /etc/init.d/mysql start # reset mysql  # try login to database, just press enter at password prompt because your password is now blank  $ mysql -u root -p</code></pre></li></ul><p><a href="https://stackoverflow.com/questions/44096710/error-1728-hy000-cannot-load-from-mysql-user-the-table-is-probably-corrupted" target="_blank" rel="noopener">ERROR 1728 (HY000): Cannot load from mysql.user. The table is probably corrupted</a></p><pre><code class="shell">$ mysql_upgrade -uroot -p --force</code></pre><p><a href="https://stackoverflow.com/questions/43846950/column-count-of-mysql-user-is-wrong-expected-42-found-44-the-table-is-probabl" target="_blank" rel="noopener">Column count of mysql.user is wrong. Expected 42, found 44. The table is probably corrupted</a></p><pre><code class="shell">$ mysql -u root -pmysql&gt; use mysql;mysql&gt; alter table mysql.user drop column default_role;mysql&gt; alter table mysql.user drop column max_statement_time;mysql&gt; alter table mysql.user drop column password_expired;mysql&gt; quit;</code></pre><p>手动执行上述三条语句，创建成功</p><h2 id="composer"><a href="#composer" class="headerlink" title="composer"></a>composer</h2><p>部分需要访问 <code>github.com</code> 导致安装失败</p><pre><code class="shell">$ sudo composer config repo.packagist composer https://mirrors.aliyun.com/composer/$ sudo composer install</code></pre><h2 id="Apache2"><a href="#Apache2" class="headerlink" title="Apache2"></a>Apache2</h2><p>启动失败，原因是 <code>80</code> 端口被占用</p><pre><code class="shell">$ sudo netstat -ltnp | grep &#39;:80&#39;$ sudo lsof -i :80$ sudo systemctl stop nginx.service</code></pre><h2 id="wkhtmltopdf"><a href="#wkhtmltopdf" class="headerlink" title="wkhtmltopdf"></a>wkhtmltopdf</h2><ul><li><a href="https://www.bookstackapp.com/docs/admin/pdf-rendering/" target="_blank" rel="noopener">PDF Rendering</a></li><li><a href="https://gist.github.com/lobermann/ca0e7bb2558b3b08923c6ae2c37a26ce" target="_blank" rel="noopener">Install wkhtmltopdf on headless ubuntu 18 vps</a></li></ul><p>手动安装最新版本</p><pre><code class="shell">$ wget https://downloads.wkhtmltopdf.org/0.12/0.12.5/wkhtmltox_0.12.5-1.bionic_amd64.deb$ apt-get install fontconfig libxrender1 xfonts-75dpi xfonts-base$ dpkg -i wkhtmltox_0.12.5-1.bionic_amd64.deb</code></pre><p>测试</p><pre><code class="shell">$ wkhtmltopdf http://www.baidu.com baidu.pdf</code></pre><p><a href="https://github.com/BookStackApp/BookStack/issues/885" target="_blank" rel="noopener">ProcessTimedOutException when exporting with wkhtmltopdf</a><br><code>BookStack</code> 导出携带不存在图片文章时出错，修改 <code>BookStack/config/snappy.php</code> 中超时 <code>timeout</code> 为 3600</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;安装 BookStack 过程中遇到的问题及解决方案&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="CI" scheme="http://yoursite.com/categories/Tools/CI/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
      <category term="bookstack" scheme="http://yoursite.com/tags/bookstack/"/>
    
      <category term="wkhtmltopdf" scheme="http://yoursite.com/tags/wkhtmltopdf/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 安装 Pandoc 和 TeX Live</title>
    <link href="http://yoursite.com/2020/09/27/pandoc-with-texlive/"/>
    <id>http://yoursite.com/2020/09/27/pandoc-with-texlive/</id>
    <published>2020-09-27T09:35:18.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>ubuntu18.04 下 <code>pandoc</code> + <code>LaTeX</code> 将 <code>markdown</code> 转为 <code>pdf</code></p><a id="more"></a><h2 id="Pandoc"><a href="#Pandoc" class="headerlink" title="Pandoc"></a>Pandoc</h2><pre><code class="shell">$ sudo dpkg -r pandoc$ sudo apt purge pandoc$ wget https://github.com/jgm/pandoc/releases/download/2.10.1/pandoc-2.10.1-1-amd64.deb$ sudo dpkg -i pandoc-2.10.1-1-amd64.deb$ sudo apt install xzdec</code></pre><h2 id="TeX-Live"><a href="#TeX-Live" class="headerlink" title="TeX Live"></a>TeX Live</h2><p><code>TeX Live</code> 是 <code>LaTeX</code> 的发行版，<code>tlmgr</code> 用于管理安装后的程序，包管理器</p><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><pre><code class="shell">$ sudo apt purge texlive*$ sudo rm -rf /usr/local/texlive/* and rm -rf ~/.texlive*$ sudo rm -rf /usr/local/share/texmf$ sudo rm -rf /var/lib/texmf$ sudo rm -rf /etc/texmf$ sudo apt remove tex-common --purge$ rm -rf ~/.texlive$ find -L /usr/local/bin/ -lname /usr/local/texlive/*/bin/* | sudo xargs rm</code></pre><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h4><pre><code class="shell">$ sudo apt install texlive-full</code></pre><h4 id="sh"><a href="#sh" class="headerlink" title="sh"></a>sh</h4><ol><li>安装<pre><code>$ wget https://mirrors.nju.edu.cn/CTAN/systems/texlive/tlnet/install-tl.zip$ sudo perl install-tl</code></pre></li><li>配置环境 <code>~/.zshrc</code><pre><code>export PATH=$PATH:/usr/local/texlive/2020/bin/x86_64-linuxexport MANPATH=/usr/local/texlive/2020/texmf-dist/doc/manexport INFOPATH=/usr/local/texlive/2020/texmf-dist/doc/info</code></pre></li><li>-设置字体- 导致乱码<pre><code class="shell">$ sudo cp /usr/local/texlive/2020/texmf-var/fonts/conf/texlive-fontconfig.conf /etc/fonts/conf.d/09-texlive.conf$ sudo fc-cache -fv</code></pre></li></ol><p>$ sudo rm sudo fc-cache -fv<br>$ sudo fc-cache -fv</p><pre><code>4. 更新为国内源，可选```shell$ sudo visudo# add /usr/local/texlive/2020/bin/x86_64-linux to secure_path$ sudo tlmgr option repository https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/tlnet</code></pre><ol start="5"><li>更新<pre><code class="shell">$ sudo tlmgr update --list$ sudo tlmgr update --self --all</code></pre></li></ol><h2 id="Editor"><a href="#Editor" class="headerlink" title="Editor"></a>Editor</h2><p>vscode <code>LaTeX Workshop</code></p><h2 id="Eisvogel"><a href="#Eisvogel" class="headerlink" title="Eisvogel"></a>Eisvogel</h2><p><a href="https://github.com/Wandmalfarbe/pandoc-latex-template" target="_blank" rel="noopener">Eisvogel</a></p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://matnoble.me/tech/ubuntu/install-texlive/" target="_blank" rel="noopener">Windows + Ubuntu 安装配置更新卸载 TeXLive 指南</a></li><li><a href="https://tug.org/texlive/quickinstall.html" target="_blank" rel="noopener">TeX Live - Quick install</a></li><li><a href="https://zhuanlan.zhihu.com/p/136931926" target="_blank" rel="noopener">TeX Live 2020 安装指南</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ubuntu18.04 下 &lt;code&gt;pandoc&lt;/code&gt; + &lt;code&gt;LaTeX&lt;/code&gt; 将 &lt;code&gt;markdown&lt;/code&gt; 转为 &lt;code&gt;pdf&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="texlive" scheme="http://yoursite.com/tags/texlive/"/>
    
  </entry>
  
  <entry>
    <title>更新最新版本 USB ID List</title>
    <link href="http://yoursite.com/2020/09/24/ubuntu-update-usbids/"/>
    <id>http://yoursite.com/2020/09/24/ubuntu-update-usbids/</id>
    <published>2020-09-24T07:19:39.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>同步最新版本 USB ID List，用于识别设备</p><pre><code class="shell">$ sudo update-usbids$ lsusb</code></pre><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;同步最新版本 USB ID List，用于识别设备&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt;$ sudo update-usbids
$ lsusb&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="ubuntu" scheme="http://yoursite.com/categories/ubuntu/"/>
    
    
      <category term="ubuntu" scheme="http://yoursite.com/tags/ubuntu/"/>
    
      <category term="usb" scheme="http://yoursite.com/tags/usb/"/>
    
  </entry>
  
  <entry>
    <title>Gerrit 配置权限禁止直接 push</title>
    <link href="http://yoursite.com/2020/09/23/gerrit-disable-direct-push-and-allow-gerrit-push/"/>
    <id>http://yoursite.com/2020/09/23/gerrit-disable-direct-push-and-allow-gerrit-push/</id>
    <published>2020-09-23T06:58:29.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>配置 Gerrit 权限禁止直接 push 代码到仓库</p><a id="more"></a><p>关于 Gerrit Push 权限描述如下：</p><blockquote><p>This category controls how users are allowed to upload new commits to projects in Gerrit. It can either give permission to push directly into a branch, bypassing any code review process that would otherwise be used. Or it may give permission to upload new changes for code review, this depends on which namespace the permission is granted to.</p></blockquote><p>具体权限配置与 namespace 有关</p><ul><li><code>refs/for/*</code> 代码评审</li><li><code>refs/head/*</code> 直接提交</li><li><code>refs/tags/*</code> tag</li></ul><p>配置如下：</p><ul><li>Reference: <code>refs/for/*</code><ul><li>Read: ALLOW</li><li>Push: ALLOW</li><li>Push Merge Commit: ALLOW</li></ul></li><li>Reference: <code>refs/heads/*</code><ul><li>Read: ALLOW</li><li>Push: BLOCK</li><li>Label Code-Review: -1 +1</li></ul></li><li>Reference: <code>refs/tags/*</code><ul><li>Push: ALLOW</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;配置 Gerrit 权限禁止直接 push 代码到仓库&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Gerrit" scheme="http://yoursite.com/categories/Tools/Gerrit/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
      <category term="gerrit" scheme="http://yoursite.com/tags/gerrit/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins中安装Node.js</title>
    <link href="http://yoursite.com/2020/09/17/jenkins-nodejs/"/>
    <id>http://yoursite.com/2020/09/17/jenkins-nodejs/</id>
    <published>2020-09-17T02:51:05.000Z</published>
    <updated>2021-07-28T06:00:46.614Z</updated>
    
    <content type="html"><![CDATA[<p>Jenkins中安装指定版本Node.js</p><a id="more"></a><h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><ul><li><code>Manage Jenkins</code></li><li><code>Manage Plugins</code></li><li>Install <code>NodeJS</code></li></ul><h2 id="插件配置"><a href="#插件配置" class="headerlink" title="插件配置"></a>插件配置</h2><ul><li><code>Manage Jenkins</code></li><li><code>Global Tool Configuration</code></li><li><code>NodeJS</code><ul><li>别名</li><li>版本</li></ul></li></ul><h2 id="Job使用"><a href="#Job使用" class="headerlink" title="Job使用"></a>Job使用</h2><ul><li>新建Job</li><li>构建环境</li><li>Provide Node &amp; npm bin/ folder to PATH</li><li>选择别名</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jenkins中安装指定版本Node.js&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="CI" scheme="http://yoursite.com/categories/Tools/CI/"/>
    
    
      <category term="jenkins" scheme="http://yoursite.com/tags/jenkins/"/>
    
      <category term="nodejs" scheme="http://yoursite.com/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>字符集与字符编码</title>
    <link href="http://yoursite.com/2020/08/24/character-sets-and-character-encoding/"/>
    <id>http://yoursite.com/2020/08/24/character-sets-and-character-encoding/</id>
    <published>2020-08-24T02:40:50.000Z</published>
    <updated>2021-07-28T06:00:46.610Z</updated>
    
    <content type="html"><![CDATA[<p>介绍如下几种概念</p><ul><li>字符集<ul><li>Unicode</li><li>GB2312</li><li>GB18030</li></ul></li><li>字符编码<ul><li>UTF-8</li><li>UTF-16LE</li><li>UTF-16BE</li></ul></li><li>字库<ul><li>cmap — Character to Glyph Index Mapping Table</li><li>GSUB — Glyph Substitution Table</li></ul></li></ul><a id="more"></a><h2 id="Character-Sets"><a href="#Character-Sets" class="headerlink" title="Character Sets"></a>Character Sets</h2><p>字符集是标准，是一个系统支持字符的集合，包括通用和地区性标准，例如</p><ul><li><a href="https://zh.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener">Unicode</a></li><li><a href="https://zh.wikipedia.org/wiki/GB_2312" target="_blank" rel="noopener">GB2312</a></li><li>iso8859</li><li><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E9%A1%B5" target="_blank" rel="noopener">Code Page</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E4%BA%94%E7%A2%BC" target="_blank" rel="noopener">Big5</a></li><li><a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCII</a></li></ul><h2 id="Character-Encoding"><a href="#Character-Encoding" class="headerlink" title="Character Encoding"></a>Character Encoding</h2><p>字符集是字符的集合，字符编码用于定于字符集中的字符如何编码为特定的二进制数据，以便于在计算机中存储，<strong>是定义在字符集上的映射规则</strong></p><ul><li><a href="https://zh.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a></li><li><a href="https://zh.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener">UTF-16</a></li><li><a href="https://zh.wikipedia.org/wiki/GB_2312" target="_blank" rel="noopener">GB2312</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E4%BA%94%E7%A2%BC" target="_blank" rel="noopener">Big5</a></li><li><a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCII</a></li></ul><blockquote><p>术语字符编码（character encoding），字符映射（character map），字符集（character set）或者代码页，在历史上往往是同义概念，即字符表（repertoire）中的字符如何编码为码元的流（stream of code units）–通常每个字符对应单个码元。</p></blockquote><h2 id="字库"><a href="#字库" class="headerlink" title="字库"></a>字库</h2><p>所有可读或可显示字符的数据库，是信息的集合</p><h3 id="cmap"><a href="#cmap" class="headerlink" title="cmap"></a>cmap</h3><p><code>cmap</code>表是用于将字符编码映射到字形索引的表，可以使用工具导出</p><pre><code class="shell">$ ttx -t cmap Font.ttf</code></pre><p>例如，编码到字形的映射</p><pre><code class="xml">&lt;map code=&quot;0x405&quot; name=&quot;afii10054&quot;/&gt;&lt;!-- CYRILLIC CAPITAL LETTER DZE --&gt;&lt;map code=&quot;0xfedf&quot; name=&quot;afii62817&quot;/&gt;&lt;!-- ARABIC LETTER LAM INITIAL FORM --&gt;&lt;map code=&quot;0xfe82&quot; name=&quot;afii62753&quot;/&gt;&lt;!-- ARABIC LETTER ALEF WITH MADDA ABOVE FINAL FORM --&gt;</code></pre><h3 id="GSUB"><a href="#GSUB" class="headerlink" title="GSUB"></a>GSUB</h3><p><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub" target="_blank" rel="noopener">GSUB — Glyph Substitution Table</a></p><p><code>GSUB</code>表用于提供替换规则</p><pre><code class="shell">$ ttx -t GSUB Font.ttf</code></pre><p>包含多种替换规则，如下</p><ul><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#SS" target="_blank" rel="noopener">Single</a></li><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#MS" target="_blank" rel="noopener">Multiple</a></li><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#LS" target="_blank" rel="noopener">Litigation</a> – 连写</li></ul><p>以阿拉伯语举例 Litigation</p><pre><code class="xml">&lt;LigatureSubst index=&quot;0&quot; Format=&quot;1&quot;&gt;  &lt;LigatureSet glyph=&quot;afii62817&quot;&gt;    &lt;Ligature components=&quot;afii62818,afii62828&quot; glyph=&quot;afii64184&quot;/&gt;    &lt;Ligature components=&quot;afii62818,uni06C1&quot; glyph=&quot;afii64184&quot;/&gt;    &lt;Ligature components=&quot;afii62753&quot; glyph=&quot;afii62834&quot;/&gt;    &lt;Ligature components=&quot;afii62754&quot; glyph=&quot;afii62836&quot;/&gt;    &lt;Ligature components=&quot;afii62756&quot; glyph=&quot;afii62838&quot;/&gt;    &lt;Ligature components=&quot;afii62760&quot; glyph=&quot;afii62840&quot;/&gt;    &lt;Ligature components=&quot;glyph1343&quot; glyph=&quot;glyph1656&quot;/&gt;    &lt;Ligature components=&quot;glyph1345&quot; glyph=&quot;glyph1658&quot;/&gt;    &lt;Ligature components=&quot;glyph47&quot; glyph=&quot;glyph1660&quot;/&gt;    &lt;Ligature components=&quot;uniFB51&quot; glyph=&quot;glyph1672&quot;/&gt;  &lt;/LigatureSet&gt;&lt;/LigatureSubst&gt;</code></pre><p>上述连写规则中 <code>afii62817</code> + <code>afii62753</code> 输出为 <code>afii62834</code>，即 <code>ﻟ</code> + <code>ﺂ</code> 输出 <code>ﻟﺂ</code></p><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><ul><li>字库，决定了整个字符集能够展现表示的所有字符的范围</li><li>字符集，用一个编码值<code>code point</code>来表示一个字符，这个值称为字符对应于编码字符集（如：Unicode、ASCII）的序号</li><li>字符编码，是字符集和实际存储数值之间的转换关系。字符，是根据字符编码方案转换为一个二进制数值存储在计算机中</li><li>编码字符集Unicode，有UTF-8、UTF-16、UTF-32、UCS-2、UCS-4等多种字符编码</li><li>编码字符集ASCII，本身就是编码字符集，又是字符编码</li><li><strong>不同的字符集转换，需要各自的码表才能进行转换</strong></li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" target="_blank" rel="noopener">字符编码笔记：ASCII，Unicode 和 UTF-8</a></li><li><a href="http://cenalulu.github.io/linux/character-encoding/" target="_blank" rel="noopener">十分钟搞清字符集和字符编码</a></li><li><a href="https://my.oschina.net/u/4407987/blog/3319285/print" target="_blank" rel="noopener">Unicode</a></li><li><a href="https://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html#_2.2._GBXXXX%E5%AD%97%E7%AC%A6%E9%9B%86&%E7%BC%96%E7%A0%81" target="_blank" rel="noopener">字符集和字符编码</a></li><li><a href="https://dailc.github.io/2017/05/03/char_charset_charEncoding.html" target="_blank" rel="noopener">字符，字符集，字符编码解惑</a></li><li><a href="https://www.cnblogs.com/malecrab/p/5300503.html" target="_blank" rel="noopener">细说：Unicode, UTF-8, UTF-16, UTF-32, UCS-2, UCS-4</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81" target="_blank" rel="noopener">字符编码</a></li><li><a href="https://darknode.in/font/cmap-modify-tutorial/" target="_blank" rel="noopener">CMap 表相关修改技术简要指南</a></li><li><a href="https://simoncozens.github.io/fonts-and-layout/opentype.html" target="_blank" rel="noopener">How OpenType Works</a></li><li><a href="https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers" target="_blank" rel="noopener">Code Page Identifiers</a></li><li><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E9%A1%B5" target="_blank" rel="noopener">代码页</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;介绍如下几种概念&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;字符集&lt;ul&gt;
&lt;li&gt;Unicode&lt;/li&gt;
&lt;li&gt;GB2312&lt;/li&gt;
&lt;li&gt;GB18030&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字符编码&lt;ul&gt;
&lt;li&gt;UTF-8&lt;/li&gt;
&lt;li&gt;UTF-16LE&lt;/li&gt;
&lt;li&gt;UTF-16BE&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字库&lt;ul&gt;
&lt;li&gt;cmap — Character to Glyph Index Mapping Table&lt;/li&gt;
&lt;li&gt;GSUB — Glyph Substitution Table&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Character Encoding/Fonts" scheme="http://yoursite.com/categories/Tools/Character-Encoding-Fonts/"/>
    
    
      <category term="character set" scheme="http://yoursite.com/tags/character-set/"/>
    
      <category term="gb18030" scheme="http://yoursite.com/tags/gb18030/"/>
    
      <category term="character encoding" scheme="http://yoursite.com/tags/character-encoding/"/>
    
      <category term="unicode" scheme="http://yoursite.com/tags/unicode/"/>
    
      <category term="gdb2312" scheme="http://yoursite.com/tags/gdb2312/"/>
    
      <category term="utf-8" scheme="http://yoursite.com/tags/utf-8/"/>
    
      <category term="utf-16" scheme="http://yoursite.com/tags/utf-16/"/>
    
  </entry>
  
  <entry>
    <title>如何检查嵌入式系统内存占用</title>
    <link href="http://yoursite.com/2020/08/11/how-to-check-heap-size/"/>
    <id>http://yoursite.com/2020/08/11/how-to-check-heap-size/</id>
    <published>2020-08-11T07:30:37.000Z</published>
    <updated>2021-07-28T06:00:46.610Z</updated>
    
    <content type="html"><![CDATA[<p>使用 <code>size</code> 和 <code>nm</code> 分析系统内存开销</p><a id="more"></a><h2 id="I"><a href="#I" class="headerlink" title="I"></a>I</h2><p>应用总内存 = text + data + bss + heap</p><h2 id="size"><a href="#size" class="headerlink" title="size"></a>size</h2><pre><code class="shell">$ size src/out.elf   text       data        bss        dec        hex    filename6148556       3428    3137272    9289256     8dbe28    src/out.elf</code></pre><ul><li>text 代码段</li><li>data 数据段</li><li>bss 未初始化全局变量</li><li>heap 堆内存</li></ul><p>前三部分为静态内存分配</p><h2 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h2><p>使用 <code>nm</code> 分析符号表，找出占用大内存的符号</p><pre><code class="shell">$ nm --print-size --size-sort src/out.elf</code></pre><ul><li><code>b</code> 为局部bss变量</li><li><code>B</code> 为全局bss变量</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用 &lt;code&gt;size&lt;/code&gt; 和 &lt;code&gt;nm&lt;/code&gt; 分析系统内存开销&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Prof" scheme="http://yoursite.com/categories/Tools/Prof/"/>
    
      <category term="GCC" scheme="http://yoursite.com/categories/C/GCC/"/>
    
    
      <category term="nm" scheme="http://yoursite.com/tags/nm/"/>
    
      <category term="size" scheme="http://yoursite.com/tags/size/"/>
    
      <category term="bss" scheme="http://yoursite.com/tags/bss/"/>
    
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>IT日记</title>
  
  <subtitle>Life is Now.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-01-29T05:31:06.535Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Breeze.Temple</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>fork safety 以及多线程环境下注意事项</title>
    <link href="http://yoursite.com/2021/01/15/fork-safe/"/>
    <id>http://yoursite.com/2021/01/15/fork-safe/</id>
    <published>2021-01-15T02:07:57.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>多线程下进程安全及 fork 使用注意事项</p><blockquote><p>非进程安全容易导致死锁<br>未考虑 fork 时文件的处理 <code>fcntl(fd, F_SETFD, FD_CLOEXEC)</code></p></blockquote><a id="more"></a><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul><li>Reentrant Function 可重入函数</li><li>Thread-Safe Function 线程安全函数</li><li>signal-safety - async-signal-safe functions 异步信号安全函数</li></ul><h2 id="fork-amp-fork-safety-amp-signal-safety"><a href="#fork-amp-fork-safety-amp-signal-safety" class="headerlink" title="fork &amp; fork safety &amp; signal-safety"></a>fork &amp; fork safety &amp; signal-safety</h2><pre><code class="shell">$ man fork    Note the following further points:    *  The child process is created with a single thread—the one that called fork().  The entire virtual address space of the  parent  is  repli‐        cated  in the child, including the states of mutexes, condition variables, and other pthreads objects; the use of pthread_atfork(3) may be        helpful for dealing with problems that this can cause.    *  After a fork() in a multithreaded program, the child can safely call only async-signal-safe functions (see  signal-safety(7))  until  such        time as it calls execve(2).</code></pre><ul><li><strong>只复制了父进程中当前线程到子进程</strong>，如果父进程是多线程，那个其他线程在子进程中消失</li><li>子进程得到父进程拷贝，包括互斥锁、条件变量…，这会导致死锁，是问题的根源</li><li><strong>互斥锁，就是多线程fork大部分问题的关键部分</strong></li><li>可以使用 <code>pthread_atfork</code> 处理部分问题，例外如<strong>库函数不受控制</strong>，还需要考虑锁的顺序，在大型程序中无实用价值</li><li><code>fork</code> 后，在执行 <code>execve</code> 前，只能调用 <code>async-signal-safe functions</code>，其他函数都有风险</li></ul><p>死锁模型如下：<br><img src="/images/linux/fork-deadlock.png" alt=""></p><ul><li>T1 持有锁</li><li>T2 <code>fork</code> 后，子进程中只存在 T2 线程，获取不到锁导致死锁</li><li><code>pthread_atfork</code> 只能解决简单模型</li><li><code>fork</code> 之后，<code>execve</code> 之前，只能调用 <code>async-signal-safe functions</code></li><li><code>libc</code> 中很多函数都使用锁，而且不是 <code>async-signal-safe functions</code>，例如 <code>malloc/free</code></li><li><code>fork</code> 之后，<code>execve</code>之前，使用内存分配函数存在风险</li><li><code>execve</code> 后会重置所有进程状态，之前线程获取的锁会直接被销毁</li></ul><p>查看 <code>async-signal-safe functions</code> 列表：</p><pre><code class="shell">$ man signal-safety</code></pre><h2 id="uclibc-amp-glibc"><a href="#uclibc-amp-glibc" class="headerlink" title="uclibc &amp; glibc"></a>uclibc &amp; glibc</h2><ul><li><a href="https://wiki.strongswan.org/issues/990" target="_blank" rel="noopener">unsafe use of malloc after fork</a></li><li><code>glibc</code> 中 <code>malloc</code> 不存在问题<blockquote><p>malloc/malloc.c (malloc_atfork, free_atfork): Remove<br>Remove malloc hooks from fork handler.  They are no longer needed because malloc runs right before fork, and no malloc calls from other fork handlers are not possible anymore.</p></blockquote></li><li><code>uclibc</code> 中 <code>malloc</code> 存在问题</li></ul><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ul><li><code>fork</code> 后立即调用 <code>execve</code>，两者之间只允许调用 <code>async-signal-safe functions</code></li><li>在程序启动其他线程前 <code>fork</code> 子进程，需要考虑 <code>C++</code> 静态构造函数</li><li>在多线程中避免使用 <code>fork</code>，使用 <code>pthread_create</code> 代替</li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="http://timd.cn/fork-safety-and-thread-safety/" target="_blank" rel="noopener">fork-safe和thread-safe简介</a></li><li><a href="https://blog.kghost.info/2013/04/27/fork-multi-thread/" target="_blank" rel="noopener">多线程程序中使用 Fork/Exec</a></li><li><a href="https://www.cnblogs.com/liyuan989/p/4279210.html" target="_blank" rel="noopener">谨慎使用多线程中的fork</a></li><li><a href="https://www.evanjones.ca/fork-is-dangerous.html" target="_blank" rel="noopener">fork() without exec() is dangerous in large programs</a></li><li><a href="https://my.oschina.net/lowkey2046/blog/672450" target="_blank" rel="noopener">多线程程序里不准使用fork</a></li><li><a href="https://docs.oracle.com/cd/E19253-01/819-7051/6n919hpaq/index.html" target="_blank" rel="noopener">进程创建中的 fork 问题</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;多线程下进程安全及 fork 使用注意事项&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;非进程安全容易导致死锁&lt;br&gt;未考虑 fork 时文件的处理 &lt;code&gt;fcntl(fd, F_SETFD, FD_CLOEXEC)&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
      <category term="Fork" scheme="http://yoursite.com/categories/Linux/Fork/"/>
    
    
      <category term="malloc" scheme="http://yoursite.com/tags/malloc/"/>
    
      <category term="fork" scheme="http://yoursite.com/tags/fork/"/>
    
      <category term="multithread" scheme="http://yoursite.com/tags/multithread/"/>
    
      <category term="fork safety" scheme="http://yoursite.com/tags/fork-safety/"/>
    
  </entry>
  
  <entry>
    <title>Using Git with Multiple Email Addresses</title>
    <link href="http://yoursite.com/2020/11/24/config-git-with-multi-email-address/"/>
    <id>http://yoursite.com/2020/11/24/config-git-with-multi-email-address/</id>
    <published>2020-11-24T02:48:08.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>配置不同项目组下不同用户名</p><a id="more"></a><h2 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a><code>git config</code></h2><p>使用 <code>git config</code> 配置不同项目下用户名和地址</p><ul><li>设置全局默认值<pre><code class="shell">  $ git config --global user.name &quot;userA&quot;  $ git config --global user.email userA@email.com</code></pre></li><li>设置当前工程<pre><code class="shell">  $ git config user.name &quot;userA&quot;  $ git config user.email userA@email.com</code></pre></li></ul><p>繁琐而且新开工程容易遗漏</p><h2 id="gitconfig"><a href="#gitconfig" class="headerlink" title=".gitconfig"></a><code>.gitconfig</code></h2><p><a href="https://git-scm.com/docs/git-config#_conditional_includes" target="_blank" rel="noopener">git-config Conditional includes</a></p><p>按照工程路径配置不同的用户名，规划好根目录之后可以方便管理</p><pre><code class=".gitconfig">[user]    name = John Doe    email = john@doe.tld[includeIf &quot;gitdir:~/work/&quot;]    path = ~/work/.gitconfig</code></pre><p>在目录 <code>~/work</code> 下新建 <code>.gitconfig</code></p><pre><code class=".gitconfig">[user]    name = John DoeA    email = john.doe@company.tld</code></pre><p>也可以放在当前目录</p><pre><code class=".gitconfig">[includeIf &quot;gitdir:github/&quot;]    path = .gitconfig-github[includeIf &quot;gitdir:work/&quot;]    path = .gitconfig-work</code></pre><p>在 <code>~/.gitconfig-github</code> 和 <code>.gitconfig-work</code> 中分配配置 <code>GitHub</code> 和 <code>work</code> 用户名和邮件</p><blockquote><p>文件 <code>~/.gitconfig</code> 里面的 includeIf 后面的 path 最后需要 <code>/</code> 结尾<br>文件 <code>~/.gitconfig</code> 里面原有的 user 部分需要删除，注释的话开头用 <code>#</code><br>工程目录不能是包含关系</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;配置不同项目组下不同用户名&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Git" scheme="http://yoursite.com/categories/Tools/Git/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>time() 与 gettimeofday()</title>
    <link href="http://yoursite.com/2020/11/16/time-and-gettimeofday/"/>
    <id>http://yoursite.com/2020/11/16/time-and-gettimeofday/</id>
    <published>2020-11-16T06:40:44.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>eCos 系统下发现 <code>pthread_cond_timedwait</code> 超时失败，会立刻返回</p><a id="more"></a><h2 id="pthread-cond-timedwait"><a href="#pthread-cond-timedwait" class="headerlink" title="pthread_cond_timedwait"></a>pthread_cond_timedwait</h2><p>根据 <code>timeout</code> 和 <code>condition</code> 阻塞线程</p><ul><li>0: 正常情况，获取 <code>condition</code></li><li>ETIMEDOUT: 超时</li></ul><p>异常时设置超时会直接退出</p><h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><blockquote><p>This function returns the time since 00:00:00 UTC, January 1, 1970 (Unix timestamp) in seconds.</p></blockquote><p><code>time()</code> 在 eCos 下最终是调用栈如下</p><ul><li><code>Cyg_WallClock::wallclock-&gt;get_current_time()</code></li><li><code>get_hw_seconds()</code></li><li><code>get_ds_hwclock()</code></li><li><code>gx_rtc_time_read()</code></li></ul><p>在此函数中强制转换出现问题，解决之后 <code>pthread_cond_timedwait</code> 正常</p><h2 id="gettimeofday"><a href="#gettimeofday" class="headerlink" title="gettimeofday"></a>gettimeofday</h2><p>可以得到更加精确的时间，精确到毫秒</p><p><code>gettimeofday()</code> 定义在 <code>ecos3.0/packages/compat/posix/v3_0/src/time.cxx</code>，调用栈</p><ul><li><code>cyg_current_time()</code></li><li><code>Cyg_Clock::real_time_clock-&gt;current_value()</code></li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://stackoverflow.com/questions/46018295/pthread-cond-timedwait-returns-etimedout-immediately" target="_blank" rel="noopener">pthread_cond_timedwait returns ETIMEDOUT immediately</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;eCos 系统下发现 &lt;code&gt;pthread_cond_timedwait&lt;/code&gt; 超时失败，会立刻返回&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="eCos" scheme="http://yoursite.com/categories/eCos/"/>
    
      <category term="Functions" scheme="http://yoursite.com/categories/C/Functions/"/>
    
    
      <category term="time" scheme="http://yoursite.com/tags/time/"/>
    
      <category term="eCos" scheme="http://yoursite.com/tags/eCos/"/>
    
      <category term="gettimeofday" scheme="http://yoursite.com/tags/gettimeofday/"/>
    
  </entry>
  
  <entry>
    <title>x96maxplus</title>
    <link href="http://yoursite.com/2020/11/05/x96maxplus/"/>
    <id>http://yoursite.com/2020/11/05/x96maxplus/</id>
    <published>2020-11-05T05:11:44.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>X96MAX+ 折腾记录</p><ul><li>ATV + CoreELEC</li><li>OpenWrt</li></ul><a id="more"></a><h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><ul><li>ATV + CoreELEC<ul><li><a href="http://www.tvboxfactory.com/index.php?m=home&c=View&a=index&aid=108" target="_blank" rel="noopener">ATV固件，S905X2,和S905X3芯片通用的-X96 MAX机器固件</a></li><li><a href="https://chinagadgetsreviews.com/download-android-pie-9-0-firmware-for-x96-max-plus2-tv-box-2.html" target="_blank" rel="noopener">Download Android Pie 9.0 firmware for X96 Max Plus2 TV Box</a></li><li><a href="https://post.smzdm.com/p/a99v2q35/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（一）：红外遥控开关机与VFD屏幕显示</a></li><li><a href="https://post.smzdm.com/p/alpw279e/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（二）：emmc双系统+ 流光溢彩</a></li><li><a href="https://post.smzdm.com/p/aeke4xm4/" target="_blank" rel="noopener">x96max+ 盒子 与 CoreELEC系统配置（三）AndroidTV刷机记录</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=972364" target="_blank" rel="noopener">4PDA X96max+</a></li><li><a href="https://www.getdroidtips.com/stock-firmware-x96-max-plus-tv-box/#Instructions-to-Install" target="_blank" rel="noopener">How to Install Stock Firmware on X96 Max Plus TV Box [Android 9.0]</a></li><li><a href="https://gitee.com/s0xff/CoreELEC_Test/tree/master" target="_blank" rel="noopener">CoreELEC_Test</a></li><li><a href="https://www.rosnas.com/1645.html" target="_blank" rel="noopener">x96 max+外贸盒子改散热,刷ATV,CoreELEC系统</a></li><li><a href="https://www.znds.com/tv-1182718-1-4.html" target="_blank" rel="noopener">聊一聊最近一周折腾刷机，几个固件的一点使用感受</a></li><li><a href="https://forum.freaktab.com/forum/tv-player-support/amlogic-based-tv-players/s905x3/firmware-roms-tools-ds" target="_blank" rel="noopener">FIRMWARE - ROMS - TOOLS</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=1002233&st=40" target="_blank" rel="noopener">固件</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=1002233&st=2880#entry100655364" target="_blank" rel="noopener">Turbo 固件系列</a></li><li><a href="https://4pda.ru/forum/index.php?showtopic=993324" target="_blank" rel="noopener">SLIMBOX</a></li><li><a href="https://www.bilibili.com/read/cv9065539/" target="_blank" rel="noopener">X96 Max+ 卡刷 SlimBOX，使用原生的ATV</a></li></ul></li><li>EmuELEC<ul><li><a href="https://club.tgfcer.com/thread-8299561-1-1.html" target="_blank" rel="noopener">X96max+盒子 EmuELEC 加装CoreELEC系统</a></li><li><a href="https://www.jianshu.com/p/67ac50a28c6b" target="_blank" rel="noopener">x96max+ 电视盒子刷入EmuELEC 变身游戏机</a></li><li><a href="https://post.smzdm.com/p/andlwdgv/" target="_blank" rel="noopener">S905X3盒子x96 air，安装CoreELEC+EmuELEC二合一系统</a></li><li><a href="https://zhuanlan.zhihu.com/p/79783441" target="_blank" rel="noopener">2XX元如何把N1打造成高效能的多平台游戏机</a></li></ul></li><li>OpenWrt<ul><li><a href="https://www.right.com.cn/forum/thread-4055451-1-1.html" target="_blank" rel="noopener">[2020-10-29] 47+O S905x3(含x2)、N1、贝壳云、我家云等OP固件</a></li><li><a href="https://www.right.com.cn/forum/thread-981406-1-1.html" target="_blank" rel="noopener">[N1盒子] [2020-10-18]★46+o版， S905x3、N1、贝壳云、我家云等op固件</a></li></ul></li><li>Recovery<ul><li><a href="https://zhuanlan.zhihu.com/p/293943099" target="_blank" rel="noopener">X96MAX+ S905x3 盒子 刷机救砖教程</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;X96MAX+ 折腾记录&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ATV + CoreELEC&lt;/li&gt;
&lt;li&gt;OpenWrt&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Hacker" scheme="http://yoursite.com/categories/Hacker/"/>
    
      <category term="S905X3" scheme="http://yoursite.com/categories/Hacker/S905X3/"/>
    
    
      <category term="ATV" scheme="http://yoursite.com/tags/ATV/"/>
    
      <category term="CoreELEC" scheme="http://yoursite.com/tags/CoreELEC/"/>
    
  </entry>
  
  <entry>
    <title>ld 选项 -warn-common</title>
    <link href="http://yoursite.com/2020/11/04/ld-warn-common/"/>
    <id>http://yoursite.com/2020/11/04/ld-warn-common/</id>
    <published>2020-11-04T08:28:58.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p><code>-warn-common</code> 选项分析</p><a id="more"></a><h2 id="编译警告"><a href="#编译警告" class="headerlink" title="编译警告"></a>编译警告</h2><pre><code>libtest.a(rmdec.c.o): warning: definition of `sipr_subpk_size&#39; overriding commonlibtest.a(matroskadec.c.o): warning: common is herelibtest.a(rdt.c.o): warning: common of `sipr_subpk_size&#39; overridden by definitionlibtest.a(rmdec.c.o): warning: defined here</code></pre><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul><li><a href="https://stackoverflow.com/questions/2331584/global-variable-implementation" target="_blank" rel="noopener">Global variable implementation</a></li><li><a href="https://stackoverflow.com/questions/11958626/make-file-warning-overriding-commands-for-target" target="_blank" rel="noopener">Make file warning, overriding commands for target</a></li></ul><p>代码编写存在风险</p><ul><li>修改源码，去除编译警告</li><li>去除 <code>-warn-common</code> 不生成编译警告</li></ul><p><a href="https://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_3.html" target="_blank" rel="noopener">Ld Command Line Options</a></p><blockquote><p>Warn when a common symbol is combined with another common symbol or with a symbol definition. Unix linkers allow this somewhat sloppy practice, but linkers on some other operating systems do not. This option allows you to find potential problems from combining global symbols. Unfortunately, some C libraries use this practice, so you may get some warnings about symbols in the libraries as well as in your programs. There are three kinds of global symbols, illustrated here by C examples:</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;-warn-common&lt;/code&gt; 选项分析&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Linker" scheme="http://yoursite.com/categories/C/Linker/"/>
    
    
      <category term="ld" scheme="http://yoursite.com/tags/ld/"/>
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="linker" scheme="http://yoursite.com/tags/linker/"/>
    
  </entry>
  
  <entry>
    <title>Pandoc 定制模板转换 Markdown 为 PDF</title>
    <link href="http://yoursite.com/2020/11/02/customizing-pandoc/"/>
    <id>http://yoursite.com/2020/11/02/customizing-pandoc/</id>
    <published>2020-11-02T06:35:43.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>定制模板控制 <code>Markdown</code> 转换细节</p><a id="more"></a><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p><a href="https://github.com/Wandmalfarbe/pandoc-latex-template.git" target="_blank" rel="noopener">Eisvogel</a></p><p>使用 Metadata 控制</p><h2 id="Pandoc-Filter"><a href="#Pandoc-Filter" class="headerlink" title="Pandoc Filter"></a>Pandoc Filter</h2><p>扩展 <code>Markdown</code></p><ol><li><a href="https://github.com/timofurrer/pandoc-mermaid-filter" target="_blank" rel="noopener">pandoc-mermaid-filter</a></li><li><a href="https://github.com/raghur/mermaid-filter" target="_blank" rel="noopener">mermaid-filter</a></li><li><a href="https://github.com/taqenoqo/pandoc-ditaa-filter" target="_blank" rel="noopener">Pandoc Ditaa Filter</a></li><li><a href="https://github.com/hertogp/imagine" target="_blank" rel="noopener"><strong>Imagine</strong></a></li></ol><p>其中 <code>Imagine</code> 支持如下代码块</p><ul><li>asy</li><li>blockdiag</li><li>boxes</li><li>chartdirector</li><li>ctioga2</li><li>ditaa</li><li>figlet</li><li>flydraw</li><li>gle</li><li>gnuplot</li><li>graphviz</li><li>gri</li><li>inline</li><li>matplotlib</li><li>mermaid</li><li>mscgen</li><li>octave</li><li>plantuml</li><li>ploticus</li><li>plotutils</li><li>protocol</li><li>pygal</li><li>pyxplot</li><li>random</li><li>sample</li><li>wolfram</li></ul><h2 id="Pandoc-控制"><a href="#Pandoc-控制" class="headerlink" title="Pandoc 控制"></a>Pandoc 控制</h2><ul><li>模板即为一组语法集合</li><li>转换为 PDF <code>--pdf-engine=xelatex</code></li><li>使用模板 <code>--template &quot;eisvogel.latex&quot;</code></li></ul><h3 id="支持中文"><a href="#支持中文" class="headerlink" title="支持中文"></a>支持中文</h3><p><code>-V CJKmainfont=&quot;Microsoft YaHei&quot;</code></p><h3 id="高亮"><a href="#高亮" class="headerlink" title="高亮"></a>高亮</h3><ul><li><code>--list-highlight-styles</code></li><li><code>--list-highlight-languages</code></li><li><code>--highlight-style zenburn</code></li></ul><p>定制语法高亮，输出默认并编辑</p><pre><code class="shell">$ pandoc --print-highlight-style=pygments &gt; pygments.theme</code></pre><h3 id="章节编号"><a href="#章节编号" class="headerlink" title="章节编号"></a>章节编号</h3><p><code>--number-sections</code></p><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul><li><code>--toc</code></li><li><code>--toc-depth</code></li><li><code>-V toc-title</code></li></ul><h3 id="链接颜色"><a href="#链接颜色" class="headerlink" title="链接颜色"></a>链接颜色</h3><p><code>-V colorlinks -V urlcolor=NavyBlue</code></p><h3 id="PDF-margin"><a href="#PDF-margin" class="headerlink" title="PDF margin"></a>PDF margin</h3><p><code>-V geometry:&quot;top=2cm, bottom=1.5cm, left=2cm, right=2cm&quot;</code></p><h3 id="设置放入-head-tex"><a href="#设置放入-head-tex" class="headerlink" title="设置放入 head.tex"></a>设置放入 head.tex</h3><p><code>-H --include-in-header=FILE</code></p><h3 id="Chapter-breaks"><a href="#Chapter-breaks" class="headerlink" title="Chapter breaks"></a>Chapter breaks</h3><pre><code class="latex">\usepackage{sectsty}\sectionfont{\clearpage}</code></pre><pre><code class="shell">$ $ pandoc sample_1.md -f gfm -H chapter_break.tex -o sample_1_chapter_break.pdf</code></pre><h3 id="Changing-settings-via-V-option"><a href="#Changing-settings-via-V-option" class="headerlink" title="Changing settings via -V option"></a>Changing settings via -V option</h3><pre><code class="shell">pandoc &quot;$1&quot; \    -f gfm \    --include-in-header chapter_break.tex \    -V linkcolor:blue \    -V geometry:a4paper \    -V geometry:margin=2cm \    -V mainfont=&quot;DejaVu Serif&quot; \    -V monofont=&quot;DejaVu Sans Mono&quot; \    --pdf-engine=xelatex \    -o &quot;$2&quot;</code></pre><ul><li><code>mainfont</code> is for normal text</li><li><code>monofont</code> is for code snippets</li><li><code>geometry</code> for page size and margins</li><li><code>linkcolor</code> to set hyperlink color</li></ul><h3 id="Inline-code"><a href="#Inline-code" class="headerlink" title="Inline code"></a>Inline code</h3><pre><code class="latex">\usepackage{fancyvrb,newverbs,xcolor}\definecolor{Light}{HTML}{F4F4F4}\let\oldtexttt\texttt\renewcommand{\texttt}[1]{  \colorbox{Light}{\oldtexttt{#1}}}</code></pre><p>使用方式<code>--include-in-header inline_code.tex</code></p><h3 id="PDF-properties"><a href="#PDF-properties" class="headerlink" title="PDF properties"></a>PDF properties</h3><pre><code class="latex">\usepackage{hyperref}\hypersetup{  pdftitle={My awesome book},  pdfauthor={learnbyexample},  pdfsubject={pandoc},  pdfkeywords={pandoc,pdf,xelatex}}</code></pre><h3 id="cover-image"><a href="#cover-image" class="headerlink" title="cover image"></a>cover image</h3><pre><code class="latex">\includegraphics{cover.png}\thispagestyle{empty}</code></pre><h3 id="blockquote"><a href="#blockquote" class="headerlink" title="blockquote"></a>blockquote</h3><pre><code class="latex">\usepackage{tcolorbox}\newtcolorbox{myquote}{colback=red!5!white, colframe=red!75!black}\renewenvironment{quote}{\begin{myquote}}{\end{myquote}}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;定制模板控制 &lt;code&gt;Markdown&lt;/code&gt; 转换细节&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="pandoc filter" scheme="http://yoursite.com/tags/pandoc-filter/"/>
    
  </entry>
  
  <entry>
    <title>Markdown 转换为 PDF 文档</title>
    <link href="http://yoursite.com/2020/10/30/convert-markdown-to-pdf/"/>
    <id>http://yoursite.com/2020/10/30/convert-markdown-to-pdf/</id>
    <published>2020-10-30T02:27:58.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>记录将 <code>Markdown</code> 转换为 <code>PDF</code> 过程</p><ul><li>GitBook 整体/部分/单章导出</li><li>Pandoc 导出 </li><li>Typora 导出</li><li>VSCode MPE 导出</li></ul><a id="more"></a><h2 id="GitBook"><a href="#GitBook" class="headerlink" title="GitBook"></a>GitBook</h2><p>支持安装插件以扩展功能，例如：</p><ul><li>flowchart.js</li><li>mermaid.js</li><li>UML绘图</li></ul><p>使用上述插件后，<code>Markdown</code> 在原生基础上做出了扩展，是超集</p><p><code>GitBook</code> 使用命令 <code>gitbook pdf</code> 导出电子书，其目录及内容依赖于比选项 <code>SUMMARY.md</code>。因此导出部分/单章内容时需要修改 <code>SUMMARY.md</code> 以满足需求。导出转换流程 <code>Markdown源码</code> -&gt; <code>HTML资源</code> -&gt; <code>PDF</code>，因此影响 <code>HTML</code> 的相关插件对最终输出效果均有影响。</p><p><code>README.md</code> 为比选项，因此导出单章时需要将内容重命名为 <code>README.md</code> 以避免引入 <code>introduction</code> 章节。</p><h2 id="Pandoc"><a href="#Pandoc" class="headerlink" title="Pandoc"></a>Pandoc</h2><p>使用模板 <a href="https://github.com/Wandmalfarbe/pandoc-latex-template.git" target="_blank" rel="noopener">Eisvogel</a></p><p>在文档中增加元数据</p><pre><code class="markdown">---title: &quot;DSM-CC&quot;author: Breezedate: &quot;2020-02-20&quot;subject: &quot;Markdown&quot;keywords: [Markdown, Example]table-use-row-colors: falsetoc-own-page: trueheader-left: &quot;National&quot;titlepage: true,titlepage-text-color: &quot;000000&quot;titlepage-rule-color: &quot;360049&quot;titlepage-rule-height: 0titlepage-background: &quot;titlepage-background/backgrounds/background1.pdf&quot;logo-width: 120...</code></pre><pre><code class="shell">$ pandoc &quot;index.md&quot; -o &quot;chinese.pdf&quot; --from markdown --template &quot;../eisvogel.latex&quot; --listings --pdf-engine=xelatex -V CJKmainfont=&quot;Microsoft YaHei&quot; --number-sections --toc</code></pre><blockquote><p>如果 Markdown 源码存在扩展会导致这部分输出异常，例如 GitBook 中插件部分扩展。优点是可以方便定制 LaTeX 模板</p></blockquote><p>扩展：</p><ul><li><a href="http://pages.tzengyuxio.me/pandoc/" target="_blank" rel="noopener">Pandoc’s Markdown 語法中文翻譯</a></li><li><a href="https://texblog.org/2011/01/27/add-your-logo-to-the-title-page/" target="_blank" rel="noopener">Title Page 增加 Logo</a></li><li><a href="https://zhuanlan.zhihu.com/p/81704534" target="_blank" rel="noopener">如何使用 Pandoc 和 LaTeX 制作漂亮的 pdf</a></li><li><a href="https://pandoc.org/MANUAL.html#general-options" target="_blank" rel="noopener">Pandoc General options</a></li><li><a href="https://learnbyexample.github.io/customizing-pandoc/" target="_blank" rel="noopener">Customizing pandoc to generate beautiful pdf and epub from markdown</a></li><li><a href="https://gowa.club/macOS/%E4%BD%BF%E7%94%A8pandoc%E8%BD%AC%E6%8D%A2pdf%E4%B8%8Edocx%E5%8A%A0%E4%B8%8A%E4%B9%A6%E7%AD%BE%E7%9B%AE%E5%BD%95.html" target="_blank" rel="noopener">使用pandoc转换pdf与docx加上书签目录</a></li><li><a href="https://yijiebuyi.com/blog/17e31502e8a6229a18971a2499f0e72b.html" target="_blank" rel="noopener">pandoc markdown 生成pdf文档</a></li><li><a href="https://jdhao.github.io/2017/12/10/pandoc-markdown-with-chinese/" target="_blank" rel="noopener">使用 Pandoc 把 Markdown 转为 PDF 文件</a></li><li><a href="http://www.biexiaoyu1994.com/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/2019/10/21/latex_summary/" target="_blank" rel="noopener">LaTex 语法总结</a></li><li><a href="https://www.latextemplates.com/" target="_blank" rel="noopener">LaTeX Templates</a></li><li><a href="https://uoftcoders.github.io/studyGroup/lessons/misc/pandoc-intro/lesson/" target="_blank" rel="noopener">How to use Pandoc and Markdown for writing scientific manuscripts</a></li><li><a href="https://afoo.me/posts/2013-07-10-how-to-transform-chinese-pdf-with-pandoc.html" target="_blank" rel="noopener">pandoc中文pdf转换攻略</a></li></ul><h2 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h2><p>所见即所得，方便本地编辑导出 PDF</p><h2 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h2><p>基于插件 <a href="https://shd101wyy.github.io/markdown-preview-enhanced/#/zh-cn/pandoc-pdf" target="_blank" rel="noopener">MPE Pandoc</a> 本地编辑导出 PDF</p><p>TODOs</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录将 &lt;code&gt;Markdown&lt;/code&gt; 转换为 &lt;code&gt;PDF&lt;/code&gt; 过程&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitBook 整体/部分/单章导出&lt;/li&gt;
&lt;li&gt;Pandoc 导出 &lt;/li&gt;
&lt;li&gt;Typora 导出&lt;/li&gt;
&lt;li&gt;VSCode MPE 导出&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="gitbook" scheme="http://yoursite.com/tags/gitbook/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="texlive" scheme="http://yoursite.com/tags/texlive/"/>
    
  </entry>
  
  <entry>
    <title>BookStack 填坑指南</title>
    <link href="http://yoursite.com/2020/09/29/how-to-install-bookstack/"/>
    <id>http://yoursite.com/2020/09/29/how-to-install-bookstack/</id>
    <published>2020-09-29T02:36:42.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>安装 BookStack 过程中遇到的问题及解决方案</p><a id="more"></a><h2 id="安装指南"><a href="#安装指南" class="headerlink" title="安装指南"></a>安装指南</h2><ol><li><a href="https://www.howtoforge.com/how-to-install-bookstack-on-ubuntu-1804/" target="_blank" rel="noopener">How to Install BookStack on Ubuntu 18.04 LTS</a><ul><li>MariaDB</li></ul></li><li><a href="https://www.bookstackapp.com/docs/admin/installation/#ubuntu-1804" target="_blank" rel="noopener">Ubuntu 18.04 Installation Script</a><ul><li>MySQL</li></ul></li></ol><p>采用 <code>MySQL</code> 管理数据</p><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>执行如下命令失败：</p><pre><code class="shell">mysql -u root --execute=&quot;CREATE DATABASE bookstack;&quot;mysql -u root --execute=&quot;CREATE USER &#39;bookstack&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;$DB_PASS&#39;;&quot;mysql -u root --execute=&quot;GRANT ALL ON bookstack.* TO &#39;bookstack&#39;@&#39;localhost&#39;;FLUSH PRIVILEGES;&quot;</code></pre><p><a href="https://stackoverflow.com/questions/37879448/mysql-fails-on-mysql-error-1524-hy000-plugin-auth-socket-is-not-loaded" target="_blank" rel="noopener">MySQL fails on: mysql “ERROR 1524 (HY000): Plugin ‘auth_socket’ is not loaded”</a></p><ul><li><p>I</p><pre><code class="shell">  $ sudo /etc/init.d/mysql stop # stop mysql service  $ sudo mysqld_safe --skip-grant-tables &amp; # start mysql without password  # enter -&gt; go  $ mysql -uroot # connect to mysql</code></pre></li><li><p>Socket issue: ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘/var/run/mysqld/mysqld.sock’</p><pre><code class="shell">  $ sudo mkdir -p /var/run/mysqld; sudo chown mysql /var/run/mysqld  $ sudo mysqld_safe --skip-grant-tables &amp;</code></pre></li><li><p>run mysql commands =&gt; copy paste this to cli manually</p><pre><code class="mysql">  use mysql; # use mysql table  update user set authentication_string=PASSWORD(&quot;&quot;) where User=&#39;root&#39;; # update password to nothing  update user set plugin=&quot;mysql_native_password&quot; where User=&#39;root&#39;; # set password resolving to default mechanism for root user  flush privileges;  quit;</code></pre></li><li><p>F</p><pre><code class="shell">  $ sudo /etc/init.d/mysql stop  $ sudo /etc/init.d/mysql start # reset mysql  # try login to database, just press enter at password prompt because your password is now blank  $ mysql -u root -p</code></pre></li></ul><p><a href="https://stackoverflow.com/questions/44096710/error-1728-hy000-cannot-load-from-mysql-user-the-table-is-probably-corrupted" target="_blank" rel="noopener">ERROR 1728 (HY000): Cannot load from mysql.user. The table is probably corrupted</a></p><pre><code class="shell">$ mysql_upgrade -uroot -p --force</code></pre><p><a href="https://stackoverflow.com/questions/43846950/column-count-of-mysql-user-is-wrong-expected-42-found-44-the-table-is-probabl" target="_blank" rel="noopener">Column count of mysql.user is wrong. Expected 42, found 44. The table is probably corrupted</a></p><pre><code class="shell">$ mysql -u root -pmysql&gt; use mysql;mysql&gt; alter table mysql.user drop column default_role;mysql&gt; alter table mysql.user drop column max_statement_time;mysql&gt; alter table mysql.user drop column password_expired;mysql&gt; quit;</code></pre><p>手动执行上述三条语句，创建成功</p><h2 id="composer"><a href="#composer" class="headerlink" title="composer"></a>composer</h2><p>部分需要访问 <code>github.com</code> 导致安装失败</p><pre><code class="shell">$ sudo composer config repo.packagist composer https://mirrors.aliyun.com/composer/$ sudo composer install</code></pre><h2 id="Apache2"><a href="#Apache2" class="headerlink" title="Apache2"></a>Apache2</h2><p>启动失败，原因是 <code>80</code> 端口被占用</p><pre><code class="shell">$ sudo netstat -ltnp | grep &#39;:80&#39;$ sudo lsof -i :80$ sudo systemctl stop nginx.service</code></pre><h2 id="wkhtmltopdf"><a href="#wkhtmltopdf" class="headerlink" title="wkhtmltopdf"></a>wkhtmltopdf</h2><ul><li><a href="https://www.bookstackapp.com/docs/admin/pdf-rendering/" target="_blank" rel="noopener">PDF Rendering</a></li><li><a href="https://gist.github.com/lobermann/ca0e7bb2558b3b08923c6ae2c37a26ce" target="_blank" rel="noopener">Install wkhtmltopdf on headless ubuntu 18 vps</a></li></ul><p>手动安装最新版本</p><pre><code class="shell">$ wget https://downloads.wkhtmltopdf.org/0.12/0.12.5/wkhtmltox_0.12.5-1.bionic_amd64.deb$ apt-get install fontconfig libxrender1 xfonts-75dpi xfonts-base$ dpkg -i wkhtmltox_0.12.5-1.bionic_amd64.deb</code></pre><p>测试</p><pre><code class="shell">$ wkhtmltopdf http://www.baidu.com baidu.pdf</code></pre><p><a href="https://github.com/BookStackApp/BookStack/issues/885" target="_blank" rel="noopener">ProcessTimedOutException when exporting with wkhtmltopdf</a><br><code>BookStack</code> 导出携带不存在图片文章时出错，修改 <code>BookStack/config/snappy.php</code> 中超时 <code>timeout</code> 为 3600</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;安装 BookStack 过程中遇到的问题及解决方案&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="CI" scheme="http://yoursite.com/categories/Tools/CI/"/>
    
    
      <category term="mysql" scheme="http://yoursite.com/tags/mysql/"/>
    
      <category term="bookstack" scheme="http://yoursite.com/tags/bookstack/"/>
    
      <category term="wkhtmltopdf" scheme="http://yoursite.com/tags/wkhtmltopdf/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu 安装 Pandoc 和 TeX Live</title>
    <link href="http://yoursite.com/2020/09/27/pandoc-with-texlive/"/>
    <id>http://yoursite.com/2020/09/27/pandoc-with-texlive/</id>
    <published>2020-09-27T09:35:18.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>ubuntu18.04 下 <code>pandoc</code> + <code>LaTeX</code> 将 <code>markdown</code> 转为 <code>pdf</code></p><a id="more"></a><h2 id="Pandoc"><a href="#Pandoc" class="headerlink" title="Pandoc"></a>Pandoc</h2><pre><code class="shell">$ sudo dpkg -r pandoc$ sudo apt purge pandoc$ wget https://github.com/jgm/pandoc/releases/download/2.10.1/pandoc-2.10.1-1-amd64.deb$ sudo dpkg -i pandoc-2.10.1-1-amd64.deb$ sudo apt install xzdec</code></pre><h2 id="TeX-Live"><a href="#TeX-Live" class="headerlink" title="TeX Live"></a>TeX Live</h2><p><code>TeX Live</code> 是 <code>LaTeX</code> 的发行版，<code>tlmgr</code> 用于管理安装后的程序，包管理器</p><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><pre><code class="shell">$ sudo apt purge texlive*$ sudo rm -rf /usr/local/texlive/* and rm -rf ~/.texlive*$ sudo rm -rf /usr/local/share/texmf$ sudo rm -rf /var/lib/texmf$ sudo rm -rf /etc/texmf$ sudo apt remove tex-common --purge$ rm -rf ~/.texlive$ find -L /usr/local/bin/ -lname /usr/local/texlive/*/bin/* | sudo xargs rm</code></pre><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h4><pre><code class="shell">$ sudo apt install texlive-full</code></pre><h4 id="sh"><a href="#sh" class="headerlink" title="sh"></a>sh</h4><ol><li>安装<pre><code>$ wget https://mirrors.nju.edu.cn/CTAN/systems/texlive/tlnet/install-tl.zip$ sudo perl install-tl</code></pre></li><li>配置环境 <code>~/.zshrc</code><pre><code>export PATH=$PATH:/usr/local/texlive/2020/bin/x86_64-linuxexport MANPATH=/usr/local/texlive/2020/texmf-dist/doc/manexport INFOPATH=/usr/local/texlive/2020/texmf-dist/doc/info</code></pre></li><li>-设置字体- 导致乱码<pre><code class="shell">$ sudo cp /usr/local/texlive/2020/texmf-var/fonts/conf/texlive-fontconfig.conf /etc/fonts/conf.d/09-texlive.conf$ sudo fc-cache -fv</code></pre></li></ol><p>$ sudo rm sudo fc-cache -fv<br>$ sudo fc-cache -fv</p><pre><code>4. 更新为国内源，可选```shell$ sudo visudo# add /usr/local/texlive/2020/bin/x86_64-linux to secure_path$ sudo tlmgr option repository https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/tlnet</code></pre><ol start="5"><li>更新<pre><code class="shell">$ sudo tlmgr update --list$ sudo tlmgr update --self --all</code></pre></li></ol><h2 id="Editor"><a href="#Editor" class="headerlink" title="Editor"></a>Editor</h2><p>vscode <code>LaTeX Workshop</code></p><h2 id="Eisvogel"><a href="#Eisvogel" class="headerlink" title="Eisvogel"></a>Eisvogel</h2><p><a href="https://github.com/Wandmalfarbe/pandoc-latex-template" target="_blank" rel="noopener">Eisvogel</a></p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://matnoble.me/tech/ubuntu/install-texlive/" target="_blank" rel="noopener">Windows + Ubuntu 安装配置更新卸载 TeXLive 指南</a></li><li><a href="https://tug.org/texlive/quickinstall.html" target="_blank" rel="noopener">TeX Live - Quick install</a></li><li><a href="https://zhuanlan.zhihu.com/p/136931926" target="_blank" rel="noopener">TeX Live 2020 安装指南</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ubuntu18.04 下 &lt;code&gt;pandoc&lt;/code&gt; + &lt;code&gt;LaTeX&lt;/code&gt; 将 &lt;code&gt;markdown&lt;/code&gt; 转为 &lt;code&gt;pdf&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Markdown" scheme="http://yoursite.com/categories/Tools/Markdown/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
      <category term="pandoc" scheme="http://yoursite.com/tags/pandoc/"/>
    
      <category term="latex" scheme="http://yoursite.com/tags/latex/"/>
    
      <category term="texlive" scheme="http://yoursite.com/tags/texlive/"/>
    
  </entry>
  
  <entry>
    <title>更新最新版本 USB ID List</title>
    <link href="http://yoursite.com/2020/09/24/ubuntu-update-usbids/"/>
    <id>http://yoursite.com/2020/09/24/ubuntu-update-usbids/</id>
    <published>2020-09-24T07:19:39.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>同步最新版本 USB ID List，用于识别设备</p><pre><code class="shell">$ sudo update-usbids$ lsusb</code></pre><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;同步最新版本 USB ID List，用于识别设备&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;shell&quot;&gt;$ sudo update-usbids
$ lsusb&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="ubuntu" scheme="http://yoursite.com/categories/ubuntu/"/>
    
    
      <category term="ubuntu" scheme="http://yoursite.com/tags/ubuntu/"/>
    
      <category term="usb" scheme="http://yoursite.com/tags/usb/"/>
    
  </entry>
  
  <entry>
    <title>Gerrit 配置权限禁止直接 push</title>
    <link href="http://yoursite.com/2020/09/23/gerrit-disable-direct-push-and-allow-gerrit-push/"/>
    <id>http://yoursite.com/2020/09/23/gerrit-disable-direct-push-and-allow-gerrit-push/</id>
    <published>2020-09-23T06:58:29.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>配置 Gerrit 权限禁止直接 push 代码到仓库</p><a id="more"></a><p>关于 Gerrit Push 权限描述如下：</p><blockquote><p>This category controls how users are allowed to upload new commits to projects in Gerrit. It can either give permission to push directly into a branch, bypassing any code review process that would otherwise be used. Or it may give permission to upload new changes for code review, this depends on which namespace the permission is granted to.</p></blockquote><p>具体权限配置与 namespace 有关</p><ul><li><code>refs/for/*</code> 代码评审</li><li><code>refs/head/*</code> 直接提交</li><li><code>refs/tags/*</code> tag</li></ul><p>配置如下：</p><ul><li>Reference: <code>refs/for/*</code><ul><li>Read: ALLOW</li><li>Push: ALLOW</li><li>Push Merge Commit: ALLOW</li></ul></li><li>Reference: <code>refs/heads/*</code><ul><li>Read: ALLOW</li><li>Push: BLOCK</li><li>Label Code-Review: -1 +1</li></ul></li><li>Reference: <code>refs/tags/*</code><ul><li>Push: ALLOW</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;配置 Gerrit 权限禁止直接 push 代码到仓库&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Gerrit" scheme="http://yoursite.com/categories/Tools/Gerrit/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
      <category term="gerrit" scheme="http://yoursite.com/tags/gerrit/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins中安装Node.js</title>
    <link href="http://yoursite.com/2020/09/17/jenkins-nodejs/"/>
    <id>http://yoursite.com/2020/09/17/jenkins-nodejs/</id>
    <published>2020-09-17T02:51:05.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>Jenkins中安装指定版本Node.js</p><a id="more"></a><h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2><ul><li><code>Manage Jenkins</code></li><li><code>Manage Plugins</code></li><li>Install <code>NodeJS</code></li></ul><h2 id="插件配置"><a href="#插件配置" class="headerlink" title="插件配置"></a>插件配置</h2><ul><li><code>Manage Jenkins</code></li><li><code>Global Tool Configuration</code></li><li><code>NodeJS</code><ul><li>别名</li><li>版本</li></ul></li></ul><h2 id="Job使用"><a href="#Job使用" class="headerlink" title="Job使用"></a>Job使用</h2><ul><li>新建Job</li><li>构建环境</li><li>Provide Node &amp; npm bin/ folder to PATH</li><li>选择别名</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jenkins中安装指定版本Node.js&lt;/p&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="CI" scheme="http://yoursite.com/categories/Tools/CI/"/>
    
    
      <category term="jenkins" scheme="http://yoursite.com/tags/jenkins/"/>
    
      <category term="nodejs" scheme="http://yoursite.com/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>字符集与字符编码</title>
    <link href="http://yoursite.com/2020/08/24/character-sets-and-character-encoding/"/>
    <id>http://yoursite.com/2020/08/24/character-sets-and-character-encoding/</id>
    <published>2020-08-24T02:40:50.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>介绍如下几种概念</p><ul><li>字符集<ul><li>Unicode</li><li>GB2312</li><li>GB18030</li></ul></li><li>字符编码<ul><li>UTF-8</li><li>UTF-16LE</li><li>UTF-16BE</li></ul></li><li>字库<ul><li>cmap — Character to Glyph Index Mapping Table</li><li>GSUB — Glyph Substitution Table</li></ul></li></ul><a id="more"></a><h2 id="Character-Sets"><a href="#Character-Sets" class="headerlink" title="Character Sets"></a>Character Sets</h2><p>字符集是标准，是一个系统支持字符的集合，包括通用和地区性标准，例如</p><ul><li><a href="https://zh.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener">Unicode</a></li><li><a href="https://zh.wikipedia.org/wiki/GB_2312" target="_blank" rel="noopener">GB2312</a></li><li>iso8859</li><li><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E9%A1%B5" target="_blank" rel="noopener">Code Page</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E4%BA%94%E7%A2%BC" target="_blank" rel="noopener">Big5</a></li><li><a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCII</a></li></ul><h2 id="Character-Encoding"><a href="#Character-Encoding" class="headerlink" title="Character Encoding"></a>Character Encoding</h2><p>字符集是字符的集合，字符编码用于定于字符集中的字符如何编码为特定的二进制数据，以便于在计算机中存储，<strong>是定义在字符集上的映射规则</strong></p><ul><li><a href="https://zh.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a></li><li><a href="https://zh.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener">UTF-16</a></li><li><a href="https://zh.wikipedia.org/wiki/GB_2312" target="_blank" rel="noopener">GB2312</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E4%BA%94%E7%A2%BC" target="_blank" rel="noopener">Big5</a></li><li><a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCII</a></li></ul><blockquote><p>术语字符编码（character encoding），字符映射（character map），字符集（character set）或者代码页，在历史上往往是同义概念，即字符表（repertoire）中的字符如何编码为码元的流（stream of code units）–通常每个字符对应单个码元。</p></blockquote><h2 id="字库"><a href="#字库" class="headerlink" title="字库"></a>字库</h2><p>所有可读或可显示字符的数据库，是信息的集合</p><h3 id="cmap"><a href="#cmap" class="headerlink" title="cmap"></a>cmap</h3><p><code>cmap</code>表是用于将字符编码映射到字形索引的表，可以使用工具导出</p><pre><code class="shell">$ ttx -t cmap Font.ttf</code></pre><p>例如，编码到字形的映射</p><pre><code class="xml">&lt;map code=&quot;0x405&quot; name=&quot;afii10054&quot;/&gt;&lt;!-- CYRILLIC CAPITAL LETTER DZE --&gt;&lt;map code=&quot;0xfedf&quot; name=&quot;afii62817&quot;/&gt;&lt;!-- ARABIC LETTER LAM INITIAL FORM --&gt;&lt;map code=&quot;0xfe82&quot; name=&quot;afii62753&quot;/&gt;&lt;!-- ARABIC LETTER ALEF WITH MADDA ABOVE FINAL FORM --&gt;</code></pre><h3 id="GSUB"><a href="#GSUB" class="headerlink" title="GSUB"></a>GSUB</h3><p><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub" target="_blank" rel="noopener">GSUB — Glyph Substitution Table</a></p><p><code>GSUB</code>表用于提供替换规则</p><pre><code class="shell">$ ttx -t GSUB Font.ttf</code></pre><p>包含多种替换规则，如下</p><ul><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#SS" target="_blank" rel="noopener">Single</a></li><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#MS" target="_blank" rel="noopener">Multiple</a></li><li><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gsub#LS" target="_blank" rel="noopener">Litigation</a> – 连写</li></ul><p>以阿拉伯语举例 Litigation</p><pre><code class="xml">&lt;LigatureSubst index=&quot;0&quot; Format=&quot;1&quot;&gt;  &lt;LigatureSet glyph=&quot;afii62817&quot;&gt;    &lt;Ligature components=&quot;afii62818,afii62828&quot; glyph=&quot;afii64184&quot;/&gt;    &lt;Ligature components=&quot;afii62818,uni06C1&quot; glyph=&quot;afii64184&quot;/&gt;    &lt;Ligature components=&quot;afii62753&quot; glyph=&quot;afii62834&quot;/&gt;    &lt;Ligature components=&quot;afii62754&quot; glyph=&quot;afii62836&quot;/&gt;    &lt;Ligature components=&quot;afii62756&quot; glyph=&quot;afii62838&quot;/&gt;    &lt;Ligature components=&quot;afii62760&quot; glyph=&quot;afii62840&quot;/&gt;    &lt;Ligature components=&quot;glyph1343&quot; glyph=&quot;glyph1656&quot;/&gt;    &lt;Ligature components=&quot;glyph1345&quot; glyph=&quot;glyph1658&quot;/&gt;    &lt;Ligature components=&quot;glyph47&quot; glyph=&quot;glyph1660&quot;/&gt;    &lt;Ligature components=&quot;uniFB51&quot; glyph=&quot;glyph1672&quot;/&gt;  &lt;/LigatureSet&gt;&lt;/LigatureSubst&gt;</code></pre><p>上述连写规则中 <code>afii62817</code> + <code>afii62753</code> 输出为 <code>afii62834</code>，即 <code>ﻟ</code> + <code>ﺂ</code> 输出 <code>ﻟﺂ</code></p><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><ul><li>字库，决定了整个字符集能够展现表示的所有字符的范围</li><li>字符集，用一个编码值<code>code point</code>来表示一个字符，这个值称为字符对应于编码字符集（如：Unicode、ASCII）的序号</li><li>字符编码，是字符集和实际存储数值之间的转换关系。字符，是根据字符编码方案转换为一个二进制数值存储在计算机中</li><li>编码字符集Unicode，有UTF-8、UTF-16、UTF-32、UCS-2、UCS-4等多种字符编码</li><li>编码字符集ASCII，本身就是编码字符集，又是字符编码</li><li><strong>不同的字符集转换，需要各自的码表才能进行转换</strong></li></ul><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" target="_blank" rel="noopener">字符编码笔记：ASCII，Unicode 和 UTF-8</a></li><li><a href="http://cenalulu.github.io/linux/character-encoding/" target="_blank" rel="noopener">十分钟搞清字符集和字符编码</a></li><li><a href="https://my.oschina.net/u/4407987/blog/3319285/print" target="_blank" rel="noopener">Unicode</a></li><li><a href="https://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html#_2.2._GBXXXX%E5%AD%97%E7%AC%A6%E9%9B%86&%E7%BC%96%E7%A0%81" target="_blank" rel="noopener">字符集和字符编码</a></li><li><a href="https://dailc.github.io/2017/05/03/char_charset_charEncoding.html" target="_blank" rel="noopener">字符，字符集，字符编码解惑</a></li><li><a href="https://www.cnblogs.com/malecrab/p/5300503.html" target="_blank" rel="noopener">细说：Unicode, UTF-8, UTF-16, UTF-32, UCS-2, UCS-4</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81" target="_blank" rel="noopener">字符编码</a></li><li><a href="https://darknode.in/font/cmap-modify-tutorial/" target="_blank" rel="noopener">CMap 表相关修改技术简要指南</a></li><li><a href="https://simoncozens.github.io/fonts-and-layout/opentype.html" target="_blank" rel="noopener">How OpenType Works</a></li><li><a href="https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers" target="_blank" rel="noopener">Code Page Identifiers</a></li><li><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E9%A1%B5" target="_blank" rel="noopener">代码页</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;介绍如下几种概念&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;字符集&lt;ul&gt;
&lt;li&gt;Unicode&lt;/li&gt;
&lt;li&gt;GB2312&lt;/li&gt;
&lt;li&gt;GB18030&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字符编码&lt;ul&gt;
&lt;li&gt;UTF-8&lt;/li&gt;
&lt;li&gt;UTF-16LE&lt;/li&gt;
&lt;li&gt;UTF-16BE&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字库&lt;ul&gt;
&lt;li&gt;cmap — Character to Glyph Index Mapping Table&lt;/li&gt;
&lt;li&gt;GSUB — Glyph Substitution Table&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Character Encoding/Fonts" scheme="http://yoursite.com/categories/Tools/Character-Encoding-Fonts/"/>
    
    
      <category term="character set" scheme="http://yoursite.com/tags/character-set/"/>
    
      <category term="gb18030" scheme="http://yoursite.com/tags/gb18030/"/>
    
      <category term="character encoding" scheme="http://yoursite.com/tags/character-encoding/"/>
    
      <category term="unicode" scheme="http://yoursite.com/tags/unicode/"/>
    
      <category term="gdb2312" scheme="http://yoursite.com/tags/gdb2312/"/>
    
      <category term="utf-8" scheme="http://yoursite.com/tags/utf-8/"/>
    
      <category term="utf-16" scheme="http://yoursite.com/tags/utf-16/"/>
    
  </entry>
  
  <entry>
    <title>如何检查嵌入式系统内存占用</title>
    <link href="http://yoursite.com/2020/08/11/how-to-check-heap-size/"/>
    <id>http://yoursite.com/2020/08/11/how-to-check-heap-size/</id>
    <published>2020-08-11T07:30:37.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>使用 <code>size</code> 和 <code>nm</code> 分析系统内存开销</p><a id="more"></a><h2 id="I"><a href="#I" class="headerlink" title="I"></a>I</h2><p>应用总内存 = text + data + bss + heap</p><h2 id="size"><a href="#size" class="headerlink" title="size"></a>size</h2><pre><code class="shell">$ size src/out.elf   text       data        bss        dec        hex    filename6148556       3428    3137272    9289256     8dbe28    src/out.elf</code></pre><ul><li>text 代码段</li><li>data 数据段</li><li>bss 未初始化全局变量</li><li>heap 堆内存</li></ul><p>前三部分为静态内存分配</p><h2 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h2><p>使用 <code>nm</code> 分析符号表，找出占用大内存的符号</p><pre><code class="shell">$ nm --print-size --size-sort src/out.elf</code></pre><ul><li><code>b</code> 为局部bss变量</li><li><code>B</code> 为全局bss变量</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用 &lt;code&gt;size&lt;/code&gt; 和 &lt;code&gt;nm&lt;/code&gt; 分析系统内存开销&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="Prof" scheme="http://yoursite.com/categories/Tools/Prof/"/>
    
      <category term="GCC" scheme="http://yoursite.com/categories/C/GCC/"/>
    
    
      <category term="nm" scheme="http://yoursite.com/tags/nm/"/>
    
      <category term="size" scheme="http://yoursite.com/tags/size/"/>
    
      <category term="bss" scheme="http://yoursite.com/tags/bss/"/>
    
  </entry>
  
  <entry>
    <title>分析 ELF 段和符号大小</title>
    <link href="http://yoursite.com/2020/07/31/how-to-analyze-size-of-ELF-sections-and-symbol/"/>
    <id>http://yoursite.com/2020/07/31/how-to-analyze-size-of-ELF-sections-and-symbol/</id>
    <published>2020-07-31T06:55:21.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>使用工具分析 ELF 以了解内存占用</p><ul><li>nm</li><li>size</li><li>readelf</li></ul><a id="more"></a><h2 id="nm"><a href="#nm" class="headerlink" title="nm"></a>nm</h2><pre><code class="shell">$ nm --print-size --size-sort a.out$ nm --print-size --size-sort --radix=d a.out</code></pre><h2 id="size"><a href="#size" class="headerlink" title="size"></a>size</h2><pre><code class="shell">$ size a.out   text       data        bss        dec        hex    filename   1900        628         16       2544        9f0    a.out$ size -A -d a.out</code></pre><h2 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h2><pre><code class="shell">$ readelf -e a.out</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用工具分析 ELF 以了解内存占用&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nm&lt;/li&gt;
&lt;li&gt;size&lt;/li&gt;
&lt;li&gt;readelf&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Linker" scheme="http://yoursite.com/categories/C/Linker/"/>
    
    
      <category term="nm" scheme="http://yoursite.com/tags/nm/"/>
    
      <category term="size" scheme="http://yoursite.com/tags/size/"/>
    
  </entry>
  
  <entry>
    <title>如何调试嵌入式系统</title>
    <link href="http://yoursite.com/2020/07/23/how-to-debug-an-embedded-system/"/>
    <id>http://yoursite.com/2020/07/23/how-to-debug-an-embedded-system/</id>
    <published>2020-07-23T01:50:47.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>嵌入式系统调试的两种方式：</p><ul><li>Software Debugger<ul><li>gdbserver</li><li>redboot</li></ul></li><li>Hardware Debugger<ul><li>jtag</li><li>swd</li><li>jlink</li></ul></li></ul><a id="more"></a><h2 id="Software-Debugger"><a href="#Software-Debugger" class="headerlink" title="Software Debugger"></a>Software Debugger</h2><p><img src="/images/gnu/1595471565914.png" alt="gdbserver典型应用场景"></p><ul><li><code>gdb</code> 运行于宿主机</li><li><code>gdbserver</code> 运行于目标机，核心依赖于 <code>ptrace</code>，是轻量级的GDB调试器，担任着调试代理的角色</li><li>使用网口/串口连接通信</li></ul><p><img src="/images/gnu/1595471933130.png" alt="本地调试与远程调试"></p><h3 id="gdbserver"><a href="#gdbserver" class="headerlink" title="gdbserver"></a>gdbserver</h3><h3 id="redboot"><a href="#redboot" class="headerlink" title="redboot"></a>redboot</h3><p>eCos redboot 包含有 <code>GDB stub</code>，可当作 <code>GDB Server</code> 用</p><h2 id="Hardware-Debugger"><a href="#Hardware-Debugger" class="headerlink" title="Hardware Debugger"></a>Hardware Debugger</h2><p><img src="/images/gnu/1595471003633.png" alt="jtag典型应用场景"></p><ul><li><code>gdb</code> 运行于宿主机</li><li>需要硬件仿真器</li><li>需要芯片支持</li></ul><h2 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h2><p>OpenOCD（Open On-Chip Debugger）开源片上调试器，<strong>是一款开源软件</strong>。旨在提供针对嵌入式设备的调试、系统编程和边界扫描功能。是在仿真器的辅助下完成的，仿真器是能够提供调试目标的电信号的小型硬件单元。<strong>仿真器是必须的</strong>，因为宿主机通常不具备这种电信号的直接解析功能。</p><p><img src="/images/gnu/1595472703759.png" alt="1595472703759"></p><p><img src="/images/gnu/1595473016901.png" alt="1595473016901"></p><p>分为三部分，详见<a href="https://www.slideshare.net/linaroorg/hkg18403-introducing-openocd-status-of-openocd-on-aarch64" target="_blank" rel="noopener">Introducing OpenOCD: Status of OpenOCD on AArch64</a>：</p><ul><li>Development Hardware</li><li>Debug Adapter</li><li>Host Computer</li></ul><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><ol><li>Linux<ul><li>使用 JTAG 仿真器调试 Linux 内核</li><li>使用 gdbserver 调试 Linux 应用</li><li>同时使用</li><li><a href="https://blog.csdn.net/yifeng_1118/article/details/66480266" target="_blank" rel="noopener">JTAG调试内核和gdbserver冲突问题</a></li></ul></li><li>eCos<ul><li>使用 JTAG 仿真器调试，带有硬件断点/watch</li><li>使用 RedBoot 调试</li></ul></li><li>OpenOCD<ul><li>JTAG ?</li><li>SWD ?</li><li>gdbserver ?</li></ul></li></ol><h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><ol><li><a href="https://www.cnblogs.com/ccxikka/p/10519518.html" target="_blank" rel="noopener">gdb调试原理及qemu中的gdbserver</a></li><li><a href="https://stackoverflow.com/questions/13496389/gdb-remote-protocol-how-to-analyse-packets" target="_blank" rel="noopener">GDB remote protocol: how to analyse packets?</a></li><li><a href="https://doc.ecoscentric.com/cdt-guide/ch-debug.html" target="_blank" rel="noopener">Debugging eCos applications</a></li><li><a href="https://en.wikipedia.org/wiki/Gdbserver" target="_blank" rel="noopener">gdbserver</a></li><li><a href="https://blog.csdn.net/LEON1741/article/details/72846434" target="_blank" rel="noopener">浅论各种调试接口的区别</a></li><li><a href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/jtag-debugging/index.html#" target="_blank" rel="noopener">OpenOCD JTAG 调试</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嵌入式系统调试的两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Software Debugger&lt;ul&gt;
&lt;li&gt;gdbserver&lt;/li&gt;
&lt;li&gt;redboot&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Hardware Debugger&lt;ul&gt;
&lt;li&gt;jtag&lt;/li&gt;
&lt;li&gt;swd&lt;/li&gt;
&lt;li&gt;jlink&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://yoursite.com/categories/Tools/"/>
    
      <category term="GDB" scheme="http://yoursite.com/categories/Tools/GDB/"/>
    
    
      <category term="gdb" scheme="http://yoursite.com/tags/gdb/"/>
    
      <category term="jtag" scheme="http://yoursite.com/tags/jtag/"/>
    
      <category term="gdbserver" scheme="http://yoursite.com/tags/gdbserver/"/>
    
      <category term="jlink" scheme="http://yoursite.com/tags/jlink/"/>
    
      <category term="swd" scheme="http://yoursite.com/tags/swd/"/>
    
      <category term="openocd" scheme="http://yoursite.com/tags/openocd/"/>
    
  </entry>
  
  <entry>
    <title>如何正确拷贝字符串</title>
    <link href="http://yoursite.com/2020/07/20/how-to-copy-string-correctly/"/>
    <id>http://yoursite.com/2020/07/20/how-to-copy-string-correctly/</id>
    <published>2020-07-20T02:23:56.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<ul><li>strcpy</li><li>strncpy</li><li>memcpy</li><li>snprintf</li><li>strlen</li><li>sizeof</li></ul><p>正确无隐患拷贝字符串</p><a id="more"></a><h2 id="strlen"><a href="#strlen" class="headerlink" title="strlen"></a>strlen</h2><p><code>strlen</code> 运行时计算字符串长度，当字符数组中不存在 <code>\0</code> 时，计算错误</p><h2 id="sizeof"><a href="#sizeof" class="headerlink" title="sizeof"></a>sizeof</h2><p><code>sizeof</code> 编译时计算分配空间，字符数组大小</p><h2 id="strcpy"><a href="#strcpy" class="headerlink" title="strcpy"></a>strcpy</h2><pre><code class="c">    char *strcpy(char *dest, const char *src);</code></pre><p><code>strcpy</code> 提供字符串的复制，只用于字符串复制，会复制字符串的结束符。不需要指定长度，它遇到被复制字符的串结束符 <code>\0</code> 才结束，所以容易溢出</p><h2 id="strncpy"><a href="#strncpy" class="headerlink" title="strncpy"></a>strncpy</h2><pre><code class="c">    char *strncpy(char *dest, const char *src, size_t n);</code></pre><p><code>strncpy</code> 把src所指由 <code>\0</code> 结束的字符串的前n个字节复制到dest所指的数组中</p><ul><li>如果src的前n个字节不含 <code>\0</code> 字符，则结果不会以 <code>\0</code> 字符结束，<strong>对dest进行字符串运行会导致出错</strong></li><li>如果src的长度小于n个字节，则以 <code>\0</code> 填充dest直到复制完n个字节，<strong>效率低下</strong></li><li>src和dest所指内存区域不可以重叠且dest必须有足够的空间来容纳src的字符串</li></ul><p><code>strncpy</code> 正确用法</p><pre><code class="c">// solution Achar dest[MAX];strncpy(dest, src, sizeof(dest)-1);dest[MAX-1] = &#39;\0&#39;;// solution Bchar dest[MAX];memset(dest, 0, sizeof(dest));strncpy(dest, src, sizeof(dest)-1);</code></pre><h2 id="正确用法"><a href="#正确用法" class="headerlink" title="正确用法"></a>正确用法</h2><ul><li>通用用法：<code>snprintf</code></li><li>性能用法：<code>memcpy</code></li></ul><h3 id="snprintf"><a href="#snprintf" class="headerlink" title="snprintf"></a>snprintf</h3><pre><code class="c">int snprintf(char *str, size_t size, const char *format, ...);</code></pre><p>使用 <code>snprintf</code> 进行字符串拷贝，防止溢出，<code>snprintf</code> 会把buf的最后一个位置保留为 <code>\0</code></p><pre><code class="c">snprintf(dest, sizeof(dest), &quot;%s&quot;, src);</code></pre><blockquote><p>当 src 长度远大于 dest 时，由于 <code>snprintf</code> 要返回 src 的字节数，需要扫描 src，会产生性能损失</p></blockquote><h3 id="memcpy"><a href="#memcpy" class="headerlink" title="memcpy"></a>memcpy</h3><pre><code class="c">void *memcpy(void *dest, const void *src, size_t n);</code></pre><p><code>memcpy</code> 提供了一般内存的复制，对于需要复制的内容没有限制。需要考虑字符串拷贝性能时使用 <code>strlen</code> + <code>memcpy</code></p>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;strcpy&lt;/li&gt;
&lt;li&gt;strncpy&lt;/li&gt;
&lt;li&gt;memcpy&lt;/li&gt;
&lt;li&gt;snprintf&lt;/li&gt;
&lt;li&gt;strlen&lt;/li&gt;
&lt;li&gt;sizeof&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;正确无隐患拷贝字符串&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="Functions" scheme="http://yoursite.com/categories/C/Functions/"/>
    
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>eCos 组件初始化</title>
    <link href="http://yoursite.com/2020/07/11/ecos-component-initialization/"/>
    <id>http://yoursite.com/2020/07/11/ecos-component-initialization/</id>
    <published>2020-07-11T02:57:29.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>eCos 组件注册及初始化</p><a id="more"></a><h2 id="eCos-组件初始化机制"><a href="#eCos-组件初始化机制" class="headerlink" title="eCos 组件初始化机制"></a>eCos 组件初始化机制</h2><blockquote><p>eCos 组件初始化利用了 C++ 静态对象实例初始化的机制</p></blockquote><p>C++ 对象在初始化时将会调用该对象类的构造函数来初始化对象</p><ul><li>对象在函数内声明，那么函数执行到对象的声明处调用类构造函数来初始化对象</li><li>对象在函数外声明，也就是<strong>将对象声明为全局对象或静态对象</strong>，那么编译器会将该对象的初始化代码地址（函数指针）写到名为 <code>.ctors</code> 节，普通程序在进入 main 函数前由操作系统的运行时库调用存储在 <code>.ctors</code> 中的函数指针列表来初始化全局或静态对象</li></ul><p>eCos HAL将调用 <code>cyg_hal_invoke_constructors</code> 函数，该函数调用存储在 <code>.ctors</code> 节中的初始化代码</p><h2 id="组件初始化"><a href="#组件初始化" class="headerlink" title="组件初始化"></a>组件初始化</h2><p>IO 组件</p><pre><code class="cxx">externC void cyg_io_init(void);class cyg_io_init_class {public:    cyg_io_init_class(void) {        cyg_io_init();    }};// And here&#39;s an instance of the class just to make the code runstatic cyg_io_init_class _cyg_io_init CYGBLD_ATTRIB_INIT_PRI(CYG_INIT_IO);</code></pre><h2 id="初始化顺序"><a href="#初始化顺序" class="headerlink" title="初始化顺序"></a>初始化顺序</h2><blockquote><p>初始化过程需要按照一定的次序进行。次序由 <code>CYGBLD_ATTRIB_INIT_PRI</code> 宏指定，该宏带有一个参数，该参数数值越小，那么越早调用该实例的初始化代码</p></blockquote><p>例如 <code>CYGBLD_ATTRIB_INIT_PRI(CYG_INIT_IO)</code> 展开为 <code>__attribute__((init_priority(49000)))</code></p><h2 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a>组件注册</h2><p>组件定义</p><pre><code class="cxx">#define MOD_IRR         cyg_irr_init_class        irr0       CYGBLD_ATTRIB_INIT_PRI( 60100 );</code></pre><h2 id="检查初始化代码"><a href="#检查初始化代码" class="headerlink" title="检查初始化代码"></a>检查初始化代码</h2><p>符号前缀 <code>_GLOBAL__sub_I</code> 表示这是静态对象初始化代码，符号中间部分的数字决定初始化次序</p><pre><code class="shell">$ nm src/out.elf | grep &quot;t _GLOBAL&quot;90039370 t _GLOBAL__D.11000_cyg_scheduler_sched_lock900389a8 t _GLOBAL__D.12000__ZN13Cyg_Interrupt15disable_counterE90070830 t _GLOBAL__D.14000__ZN9Cyg_Clock15real_time_clockE90038704 t _GLOBAL__D.24100__ZN18Cyg_HardwareThread12thread_entryEP10Cyg_Thread904382d8 t _GLOBAL__D.50000_cyg_mtab_extra90045898 t _GLOBAL__D.50000_cyg_nstab_init90044c60 t _GLOBAL__D.50000_cyg_timeval_to_ticks900722b0 t _GLOBAL__D.50000_fdlock90071cc0 t _GLOBAL__D.56000_cyg_libc_stdio_stdin9003c6b0 t _GLOBAL__D.56000_strtok9003ccd8 t _GLOBAL__D.56000__ZN20Cyg_libc_stdio_files5filesE9003d1b8 t _GLOBAL__D.56001_cyg_libc_stdio_stdout90071ba0 t _GLOBAL__D.56002_cyg_libc_stdio_stderr9006b878 t _GLOBAL__D.58000_cyg_timespec_to_ticks9006b5f4 t _GLOBAL__D.58000_pthread_mutex9006bf64 t _GLOBAL__D.58000_signal_mutex90039358 t _GLOBAL__I.11000_cyg_scheduler_sched_lock90038738 t _GLOBAL__I.12000__Z26cyg_null_exception_handlerjij90038998 t _GLOBAL__I.12000__ZN13Cyg_Interrupt15disable_counterE90070818 t _GLOBAL__I.14000__ZN9Cyg_Clock15real_time_clockE900386ec t _GLOBAL__I.24100__ZN18Cyg_HardwareThread12thread_entryEP10Cyg_Thread9006c110 t _GLOBAL__I.32000__ZN12cyg_i2c_initC2Ev90042c38 t _GLOBAL__I.36000__ZN13Cyg_WallClock9wallclockE903e18ec t _GLOBAL__I.48000_char_dev_register90436564 t _GLOBAL__I.49000_ioinit.cxx904382c0 t _GLOBAL__I.50000_cyg_mtab_extra90045880 t _GLOBAL__I.50000_cyg_nstab_init90044c48 t _GLOBAL__I.50000_cyg_timeval_to_ticks90072298 t _GLOBAL__I.50000_fdlock90071ca8 t _GLOBAL__I.56000_cyg_libc_stdio_stdin9003c698 t _GLOBAL__I.56000_strtok9003ccc0 t _GLOBAL__I.56000__ZN20Cyg_libc_stdio_files5filesE9003d1a0 t _GLOBAL__I.56001_cyg_libc_stdio_stdout90071b88 t _GLOBAL__I.56002_cyg_libc_stdio_stderr9006b860 t _GLOBAL__I.58000_cyg_timespec_to_ticks9006b5dc t _GLOBAL__I.58000_pthread_mutex9006bf4c t _GLOBAL__I.58000_signal_mutex903e1100 t _GLOBAL__I.58000_startup.cxx904554ac t _GLOBAL_OFFSET_TABLE_</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;eCos 组件注册及初始化&lt;/p&gt;
    
    </summary>
    
      <category term="eCos" scheme="http://yoursite.com/categories/eCos/"/>
    
    
      <category term="ecos" scheme="http://yoursite.com/tags/ecos/"/>
    
  </entry>
  
  <entry>
    <title>匿名联合体和匿名结构体</title>
    <link href="http://yoursite.com/2020/06/10/anonymous-union-and-anonymous-struct/"/>
    <id>http://yoursite.com/2020/06/10/anonymous-union-and-anonymous-struct/</id>
    <published>2020-06-10T11:52:20.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>编译出错：</p><pre><code>main.c:9:16: error: ‘struct channel::&lt;unnamed union&gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct dvb {                ^~~</code></pre><a id="more"></a><h2 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h2><pre><code class="c">#include &lt;string.h&gt;struct channel {    int id;    unsigned int services_num;    int *services;    unsigned char delivery;    union {        struct dvb {            int onid;            int tsid;            int sid;        } dvb;        struct ott {            int backendid;            int channelid;        } ott;    };} ch;int main(void){    memset(&amp;ch, 0, sizeof(struct channel));}</code></pre><p>编译</p><pre><code class="bash">$ gcc main.c$ g++ main.cmain.c:9:16: error: ‘struct channel::&lt;unnamed union&gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct dvb {                ^~~main.c:15:16: error: ‘struct channel::&lt;unnamed union&gt;::ott’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct ott {                ^~~$ g++ -fpermissive main.cmain.c:9:16: warning: ‘struct channel::&lt;unnamed union&gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct dvb {                ^~~main.c:15:16: warning: ‘struct channel::&lt;unnamed union&gt;::ott’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct ott {                ^~~</code></pre><h2 id="solutions"><a href="#solutions" class="headerlink" title="solutions"></a>solutions</h2><h3 id="I"><a href="#I" class="headerlink" title="I"></a>I</h3><p>增加编译选项 <code>-fpermissive</code></p><pre><code class="bash">$ gcc main.c$ g++ main.cmain.c:10:16: warning: ‘struct channel::&lt;unnamed union&gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct dvb {                ^~~main.c:16:16: warning: ‘struct channel::&lt;unnamed union&gt;::ott’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct ott {                ^~~</code></pre><h3 id="II"><a href="#II" class="headerlink" title="II"></a>II</h3><p>增加 <code>union</code> 成员 <code>u</code></p><pre><code>struct channel {    int id;    unsigned int services_num;    int *services;    unsigned char delivery;    union {        struct dvb {            int onid;            int tsid;            int sid;        } dvb;        struct ott {            int backendid;            int channelid;        } ott;    } u;} ch;</code></pre><pre><code class="bash">$ gcc main.c$ g++ main.c</code></pre><h3 id="III"><a href="#III" class="headerlink" title="III"></a>III</h3><p>修改匿名 <code>union</code> 内部结构体为匿名</p><pre><code>struct channel {    int id;    unsigned int services_num;    int *services;    unsigned char delivery;    union {        struct {            int onid;            int tsid;            int sid;        };        struct {            int backendid;            int channelid;        };    };} ch;</code></pre><p>或者</p><pre><code>struct channel {    int id;    unsigned int services_num;    int *services;    unsigned char delivery;    union {        struct {            int onid;            int tsid;            int sid;        } dvb;        struct {            int backendid;            int channelid;        } ott;    };} ch;</code></pre><pre><code class="bash">$ gcc main.c$ g++ main.c</code></pre><h3 id="IV"><a href="#IV" class="headerlink" title="IV"></a>IV</h3><p>修改为如下同样存在问题，这种方式是一种错误，定义了 <code>struct dvb</code> 类型，但是没有定义属于该类型的任何对象</p><pre><code>struct channel {    int id;    unsigned int services_num;    int *services;    unsigned char delivery;    union {        struct dvb {            int onid;            int tsid;            int sid;        };        struct ott {            int backendid;            int channelid;        };    };} ch;</code></pre><pre><code class="bash">$ gcc main.cmain.c:13:10: warning: declaration does not declare anything         };          ^main.c:18:10: warning: declaration does not declare anything         };          ^$ g++ main.cmain.c:9:16: error: ‘struct channel::&lt;unnamed union&gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct dvb {                ^~~main.c:15:16: error: ‘struct channel::&lt;unnamed union&gt;::ott’ invalid; an anonymous union can only have non-static data members [-fpermissive]         struct ott {                ^~~</code></pre><h2 id="C-union-特点"><a href="#C-union-特点" class="headerlink" title="C++ union 特点"></a>C++ <code>union</code> 特点</h2><blockquote><p>C++ 联合体中不能包含非基本类型成员变量，原因好像是因为非基本类型存在构造函数（包括默认构造函数）为了避免多层嵌套后结构的安全性</p></blockquote><p>C++ 中 <code>union</code> 里面需要的成员需要共享内存，因此<strong>静态</strong>和<strong>引用</strong>都不能用，因为他们不可能共享内存</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol><li><a href="https://www.javatt.com/p/37232" target="_blank" rel="noopener">例解 C 语言中的匿名联合体和匿名结构体</a></li><li><a href="https://en.it1352.com/article/e4fdc90b62f14d0abaf6f46a4f4ea97e.html" target="_blank" rel="noopener">anonymous union can only have non-static data members GCC c</a></li><li><a href="https://stackoverflow.com/questions/17637392/anonymous-union-can-only-have-non-static-data-members-gcc-c" target="_blank" rel="noopener">anonymous union can only have non-static data members GCC c++</a></li><li><a href="https://stackoverflow.com/questions/2253878/why-does-c-disallow-anonymous-structs" target="_blank" rel="noopener">Why does C++ disallow anonymous structs?</a></li><li><a href="https://stackoverflow.com/questions/25542390/anonymous-union-and-struct" target="_blank" rel="noopener">Anonymous union and struct</a></li><li><a href="https://www.cnblogs.com/LubinLew/p/struct_enum_union_in_cpp.html" target="_blank" rel="noopener">C++对C语言的结构、联合、枚举 这3种数据类型进行了扩展</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;编译出错：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;main.c:9:16: error: ‘struct channel::&amp;lt;unnamed union&amp;gt;::dvb’ invalid; an anonymous union can only have non-static data members [-fpermissive]
         struct dvb {
                ^~~&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="C" scheme="http://yoursite.com/categories/C/"/>
    
      <category term="GCC" scheme="http://yoursite.com/categories/C/GCC/"/>
    
    
      <category term="union" scheme="http://yoursite.com/tags/union/"/>
    
      <category term="struct" scheme="http://yoursite.com/tags/struct/"/>
    
  </entry>
  
  <entry>
    <title>Pandas 数据选择</title>
    <link href="http://yoursite.com/2020/06/05/pandas-data-selection/"/>
    <id>http://yoursite.com/2020/06/05/pandas-data-selection/</id>
    <published>2020-06-05T02:17:48.000Z</published>
    <updated>2021-01-29T05:31:06.535Z</updated>
    
    <content type="html"><![CDATA[<p>Pandas 数据选择</p><ul><li><code>.loc</code> <code>.iloc</code></li><li><code>.at</code> <code>.iat</code></li><li><code>[]</code></li><li><code>.attr</code></li></ul><a id="more"></a><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%B8%8D%E5%90%8C%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">索引的不同选择</a></p><blockquote><p>标量：相对于矢量，只有大小没有方向的数值。比如 39.343434<br>向量：矢量，既有方向，也有大小的一组数值。数据表里的一行数据，或者一列数据都可以是向量。比如 DataFrame 中的一行或者一列</p></blockquote><h2 id="loc"><a href="#loc" class="headerlink" title=".loc"></a><code>.loc</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E6%8C%89%E6%A0%87%E7%AD%BE%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">按标签选择</a></p><blockquote><p><code>loc</code> 返回对象降维，<code>dataframe</code> -&gt; <code>series</code> -&gt; <code>标量</code><br>切片端点包含</p></blockquote><p>不同对象类型：</p><ul><li>series: <code>s.loc[indexer]</code></li><li>dataframe: <code>df.loc[row_indexer,column_indexer]</code></li></ul><p>常用方式：</p><ul><li><code>df.loc[&#39;a&#39;]</code><blockquote><p><code>a</code> 为 index label，此处输入不是索引的整数位置</p></blockquote></li><li><code>df.loc[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]]</code></li><li><code>df.loc[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], :]</code></li><li><code>df.loc[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [&#39;A&#39;:]]</code></li><li><code>s.loc[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]]</code></li><li><code>df.loc[&#39;b&#39;:]</code></li><li><code>df.loc[&#39;b&#39;:&#39;d&#39;]</code><blockquote><p>包括行 <code>b</code> 和 <code>d</code></p></blockquote></li><li><code>df.loc[:, &#39;B&#39;:&#39;D&#39;]</code></li><li><code>df.loc[:, [&#39;B&#39;, &#39;D&#39;]]</code></li><li><code>df.loc[df.A &gt; 0]</code></li><li><code>df.loc[df.index.isin([&#39;a&#39;, &#39;b&#39;])]</code></li><li><code>df.loc[df.index == &#39;a&#39;]</code></li><li><code>df.loc[(df[&#39;date&#39;] &gt; &#39;2019-12&#39;) &amp; (df[&#39;date&#39;] &lt; &#39;2020-05&#39;)]</code></li><li><code>df.loc[lambda x: x[&#39;date&#39;] &gt; &#39;2019-12&#39;]</code></li><li><code>df.loc[:, lambda df: [&#39;A&#39;, &#39;B&#39;]]</code></li></ul><h2 id="iloc"><a href="#iloc" class="headerlink" title=".iloc"></a><code>.iloc</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E6%8C%89%E4%BD%8D%E7%BD%AE%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">按位置选择</a></p><blockquote><p><code>iloc</code> 返回对象降维，<code>dataframe</code> -&gt; <code>series</code> -&gt; <code>标量</code><br>切片时，开始包括，而上限是排除<br>纯粹基于整数</p></blockquote><p>不同对象类型：</p><ul><li>series: <code>s.iloc[indexer]</code></li><li>dataframe: <code>df.iloc[row_indexer,column_indexer]</code></li></ul><p>常用方式：</p><ul><li><code>df.iloc[3]</code></li><li><code>df.iloc[1, 1]</code></li><li><code>df.iloc[[3, 4, 5]]</code></li><li><code>df.iloc[[3, 4, 5], :]</code></li><li><code>df.iloc[4:]</code></li><li><code>df.iloc[4:5]</code><blockquote><p>包含行4，不包含行5</p></blockquote></li><li><code>df.iloc[:, 4:5]</code></li><li><code>df.iloc[:, [4, 5]]</code></li><li><code>df.iloc[[1, 3, 5], [1, 3]]</code></li><li><code>df.iloc[[1, 3, 5], [1:3]]</code></li><li><code>df.iloc[list(df.A&lt;0)]</code> 或 <code>df.iloc[np.array(df.A&lt;0)]</code></li><li><code>df.iloc[df.index.isin([&#39;a&#39;, &#39;c&#39;])]</code></li><li><code>df.loc[df.index == &#39;a&#39;]</code></li><li><code>df.iloc[:, lambda df: [0, 1]]</code></li></ul><h2 id="at-和-iat"><a href="#at-和-iat" class="headerlink" title=".at 和 .iat"></a><code>.at</code> 和 <code>.iat</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E5%BF%AB%E9%80%9F%E6%A0%87%E9%87%8F%E5%80%BC%E8%8E%B7%E5%8F%96%E5%92%8C%E8%AE%BE%E7%BD%AE" target="_blank" rel="noopener">快速标量值获取和设置</a></p><p><code>at</code> 提供基于标签的标量查找，同时 <code>iat</code> 提供类似于基于整数的查找 <code>iloc</code></p><ul><li><code>df.at[&#39;b&#39;, &#39;B&#39;]</code></li><li><code>df.iat[1, 1]</code></li></ul><h2 id=""><a href="#" class="headerlink" title="[]"></a><code>[]</code></h2><p><strong>只能输入一个维度，不能用逗号隔开输入两个维度</strong></p><p>切片操作，语法与 ndarray 完全一样，返回值的一部分和相应的标签</p><ul><li><code>s[:5]</code></li><li><code>s[::-1]</code></li><li><code>s[::2]</code></li><li><code>df[:3]</code></li><li><code>df[2:3]</code></li><li><code>df[::-1]</code></li><li><code>df[[&#39;A&#39;, &#39;B&#39;, &#39;D&#39;]]</code></li><li><code>df[&#39;A&#39;]</code></li><li><code>df[df.A&lt;0]</code></li></ul><h2 id="attr"><a href="#attr" class="headerlink" title=".attr"></a><code>.attr</code></h2><p>用于访问列</p><ul><li><code>df.A</code></li></ul><h2 id="布尔运算"><a href="#布尔运算" class="headerlink" title="布尔运算"></a>布尔运算</h2><p><strong>必须使用括号进行分组</strong></p><ul><li><code>|</code></li><li><code>&amp;</code></li><li><code>~</code></li></ul><p>例如：</p><ul><li><code>s[(s &lt; -1) | (s &gt; 0.5)]</code></li><li><code>s[~(s &lt; 0)]</code></li></ul><h2 id="isin"><a href="#isin" class="headerlink" title="isin"></a><code>isin</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E4%BD%BF%E7%94%A8isin%E8%BF%9B%E8%A1%8C%E7%B4%A2%E5%BC%95" target="_blank" rel="noopener">使用isin进行索引</a></p><ul><li><code>s.isin([2, 4, 6])</code></li><li><code>s[s.index.isin([2, 4, 6])]</code></li><li><code>s_mi.iloc[s_mi.index.isin([(1, &#39;a&#39;), (2, &#39;b&#39;), (0, &#39;c&#39;)])]</code></li></ul><h2 id="where"><a href="#where" class="headerlink" title="where"></a><code>where</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E8%AF%A5where-%E6%96%B9%E6%B3%95%E5%92%8C%E5%B1%8F%E8%94%BD" target="_blank" rel="noopener">该where()方法和屏蔽</a></p><p><code>where</code> 保证选择输出与原始数据具有相同的形状</p><pre><code class="python">In [16]: s                                                                                                                                              Out[16]: 4    03    12    21    30    4dtype: int64In [17]: s[s &gt; 2]                                                                                                                                       Out[17]: 1    30    4dtype: int64In [18]: s.where(s &gt; 2)                                                                                                                                 Out[18]: 4    NaN3    NaN2    NaN1    3.00    4.0dtype: float64</code></pre><h2 id="query"><a href="#query" class="headerlink" title="query"></a><code>query</code></h2><p><a href="https://www.pypandas.cn/docs/user_guide/indexing.html#%E8%AF%A5query-%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">该query()方法</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Pandas 数据选择&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.loc&lt;/code&gt; &lt;code&gt;.iloc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.at&lt;/code&gt; &lt;code&gt;.iat&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.attr&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Python" scheme="http://yoursite.com/categories/Python/"/>
    
      <category term="Pandas" scheme="http://yoursite.com/categories/Python/Pandas/"/>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="pandas" scheme="http://yoursite.com/tags/pandas/"/>
    
  </entry>
  
</feed>
